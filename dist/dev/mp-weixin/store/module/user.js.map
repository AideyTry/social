{"version":3,"file":"user.js","sources":["../../../../../src/store/module/user.js"],"sourcesContent":["/*\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-20 17:46:39\r\n * @LastEditTime: 2022-05-15 14:24:42\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n */\r\nimport { getUserInfo } from '../../api/user'\r\nimport { validataGender, validateObjAttr } from '../../utils/validate'\r\nimport { login } from '@/utils/im.js'\r\nimport {\r\n    getStoreUserInfo,\r\n    setStoreUserInfo\r\n  } from \"@/utils/storage.js\";\r\n\r\nexport const user = {\r\n    namespaced: true,\r\n    state: {\r\n        userInfo: null || getStoreUserInfo()\r\n    },\r\n    getters: {\r\n        getUserInfo: (state) => {\r\n            return state.userInfo || getStoreUserInfo()\r\n        }\r\n    },\r\n    mutations: {\r\n        setUserInfo(state, userInfo){\r\n            if(!validataGender(userInfo)){\r\n                console.log('不应该=', userInfo)\r\n                // uni.reLaunch({\r\n                //     url: '/pages/index/index'\r\n                // });\r\n                // console.log('uni.dlbModal===', uni.dlbModal)\r\n                // uni.dlbModal({\r\n                //     title: '提示',\r\n                //     showCancel: false,\r\n                //     content: '还未选性别1',\r\n                //     success: function (res) {\r\n                //         if (res.confirm) {\r\n                //             uni.reLaunch({\r\n                //                 url: '/pages/user/index'\r\n                //             });\r\n                //         }\r\n                //     }\r\n                // })\r\n                uni.redirectTo({\r\n                    url: '/pages/user/gender/index'\r\n                });\r\n                // uni.reLaunch({\r\n                //     url: \"/pages/user/RegGender\",\r\n                //   });\r\n                // uni.showModal({\r\n                //     title: '提示',\r\n                //     showCancel: false,\r\n                //     content: '还未选性别',\r\n                //     success: function (res) {\r\n                //         if (res.confirm) {\r\n                //             uni.reLaunch({\r\n                //                 url: '/pages/user/index'\r\n                //             });\r\n                //         }\r\n                //     }\r\n                // });\r\n            }else if(!validateObjAttr(userInfo)){\r\n                uni.showModal({\r\n                    title: '提示',\r\n                    content: '请完善头像、昵称等个人信息资料',\r\n                    success: function (res) {\r\n                        if (res.confirm) {\r\n                            uni.reLaunch({\r\n                                url: '/pages/user/index'\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            state.userInfo = userInfo\r\n            setStoreUserInfo(userInfo)\r\n        }\r\n    },\r\n    actions: {\r\n        async GetUserInfo({commit}) {\r\n            const { data: {\r\n                code, data\r\n            } } = await getUserInfo()\r\n            console.log('data=', data)\r\n            if(code === 200){\r\n                login()\r\n                commit('setUserInfo', data)\r\n            }\r\n        },\r\n        async IMLogin ({commit}){\r\n            login()\r\n        }\r\n    }\r\n}"],"names":["getStoreUserInfo","validataGender","uni","validateObjAttr","setStoreUserInfo","getUserInfo","login"],"mappings":";;;;;;AAgBY,MAAC,OAAO;AAAA,EAChB,YAAY;AAAA,EACZ,OAAO;AAAA,IACH,UAAkBA;;EAEtB,SAAS;AAAA,IACL,aAAa,CAAC,UAAU;AACpB,aAAO,MAAM,YAAYA;;;EAGjC,WAAW;AAAA,IACP,YAAY,OAAO,UAAS;AACxB,UAAG,CAACC,8BAAe,QAAQ,GAAE;AACzB,gBAAQ,IAAI,uBAAQ,QAAQ;AAiB5BC,4BAAI,WAAW;AAAA,UACX,KAAK;AAAA,SACR;AAAA,iBAgBI,CAACC,+BAAgB,QAAQ,GAAE;AAChCD,4BAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,SAAS;AAAA,UACT,SAAS,SAAU,KAAK;AACpB,gBAAI,IAAI,SAAS;AACbA,kCAAI,SAAS;AAAA,gBACT,KAAK;AAAA,eACR;AAAA;;SAGZ;AAAA;AAEL,YAAM,WAAW;AACjBE,qCAAiB,QAAQ;AAAA;;EAGjC,SAAS;AAAA,IACL,MAAM,YAAY,EAAC,UAAS;AACxB,YAAM,EAAE,MAAM;AAAA,QACV;AAAA,QAAM;AAAA,YACJ,MAAMC;AACZ,cAAQ,IAAI,SAAS,IAAI;AACzB,UAAG,SAAS,KAAI;AACZC;AACA,eAAO,eAAe,IAAI;AAAA;;IAGlC,MAAM,QAAS,EAAC,UAAQ;AACpBA;;;AAGZ;;"}