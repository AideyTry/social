"use strict";var e=require("../../common/vendor.js"),c=require("../../utils/openIM.js");const C=()=>"./ChatContent.js",M={components:{ChatContent:C},onShow:function(u){this.currentDate=new Date+Math.random(),setTimeout(()=>{this.getConver()},1e3)},onLoad:function(u){this.propsOptions=u},setup(u){let a=e.ref(null),l=e.ref("");const s=e.ref([]),p=e.useStore();console.log("store.state.user===========================================================================",p.getters["user/getUserInfo"]),e.computed$1(()=>p.getters["user/getUserInfo"]).value;const v=()=>{c.openIM.on("OnRecvNewMessage",n=>{const t=JSON.parse(n.data);t.contentType===101&&s.value.unshift(t)})},i=()=>{const n={groupID:"",startClientMsgID:"",count:1e4,userID:a.value.userID};c.openIM.getHistoryMessageList(n).then(({data:t})=>{console.log("\u5386\u53F2\u6570\u636E=",JSON.parse(t)),s.value=[...JSON.parse(t).reverse()]}).catch(t=>{console.log("err 000000000000000000000000000000000000000000=",t)})},I=n=>{const{value:t}=n.detail;l.value=t;const g={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};c.openIM.createTextMessage(t).then(r=>{const f={recvID:a.value.userID,groupID:"",offlinePushInfo:g,message:r.data};c.openIM.sendMessage(f).then(({data:o,errCode:S})=>{const h=JSON.parse(o);s.value.unshift(h),l.value=""}).catch(o=>{console.log("err=",o)})}).catch(r=>{console.log("text err=",r)})},d=()=>{c.openIM.on("OnRecvC2CReadReceipt",n=>{JSON.parse(n.data).map(t=>{t.msgIDList.map(g=>{s.value.find(r=>{r.clientMsgID===g&&(r.isRead=!0)})})})})};e.watch(()=>s,(n,t)=>{const r=n.value.filter(o=>o.sendID===a.value.userID).map(o=>o.clientMsgID),f={userID:a.value.userID,msgIDList:r};c.openIM.markC2CMessageAsRead(f).then(({data:o})=>{console.log("\u4F20\u5165\u5DF2\u8BFB=",o),c.openIM.markC2CMessageAsRead({userID:a.value.userID,msgIDList:[]})}).catch(o=>{console.log("err===",o)})},{deep:!0}),e.onMounted(()=>{e.index.setNavigationBarTitle({title:a.value.title}),i(),v(),d()});let m=e.ref("");return{inputString:l,messageInfo:s,onConfirm:I,currentDate:m,getConver:i,propsOptions:a}}};Array||e.resolveComponent("ChatContent")();function D(u,a,l,s,p,v){return{a:s.currentDate,b:e.p({msgList:s.messageInfo}),c:e.o$1((...i)=>s.onConfirm&&s.onConfirm(...i)),d:s.inputString,e:e.o$1(i=>s.inputString=i.detail.value)}}var _=e._export_sfc(M,[["render",D],["__scopeId","data-v-ae0119f8"],["__file","C:/myself/social/social/src/pages/message/Chat.vue"]]);wx.createPage(_);
//# sourceMappingURL=Chat.js.map
