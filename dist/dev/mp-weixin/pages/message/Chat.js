"use strict";var t=require("../../common/vendor.js"),i=require("../../utils/openIM.js");const C=()=>"./ChatContent.js",h={components:{ChatContent:C},onShow:function(n){this.currentDate=new Date+Math.random(),setTimeout(()=>{this.getConver()},1e3)},setup(n){let l=t.ref("");const c=t.ref([]),o=t.useStore();console.log("store.state.user===========================================================================",o.getters["user/getUserInfo"]),t.computed$1(()=>o.getters["user/getUserInfo"]).value;const m=()=>{i.openIM.on("OnRecvNewMessage",a=>{const e=JSON.parse(a.data);e.contentType===101&&c.value.unshift(e)})},f=()=>{const a={groupID:"",startClientMsgID:"",count:1e4,userID:n.userID};i.openIM.getHistoryMessageList(a).then(({data:e})=>{console.log("\u5386\u53F2\u6570\u636E=",JSON.parse(e)),c.value=[...JSON.parse(e).reverse()]}).catch(e=>{console.log("err 000000000000000000000000000000000000000000=",e)})},u=a=>{const{value:e}=a.detail;l.value=e;const g={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};i.openIM.createTextMessage(e).then(r=>{const I={recvID:n.userID,groupID:"",offlinePushInfo:g,message:r.data};i.openIM.sendMessage(I).then(({data:s,errCode:_})=>{const v=JSON.parse(s);c.value.unshift(v),l.value=""}).catch(s=>{console.log("err=",s)})}).catch(r=>{console.log("text err=",r)})},d=()=>{i.openIM.on("OnRecvC2CReadReceipt",a=>{JSON.parse(a.data).map(e=>{e.msgIDList.map(g=>{c.value.find(r=>{r.clientMsgID===g&&(r.isRead=!0)})})})})};t.watch(()=>c,(a,e)=>{const r=a.value.filter(s=>s.sendID===n.userID).map(s=>s.clientMsgID),I={userID:n.userID,msgIDList:r};i.openIM.markC2CMessageAsRead(I).then(({data:s})=>{console.log("\u4F20\u5165\u5DF2\u8BFB=",s),i.openIM.markC2CMessageAsRead({userID:n.userID,msgIDList:[]})}).catch(s=>{console.log("err===",s)})},{deep:!0}),t.onMounted(()=>{t.index.setNavigationBarTitle({title:n.title}),f(),m(),d()});let p=t.ref("");return{inputString:l,messageInfo:c,onConfirm:u,currentDate:p,getConver:f}}};Array||t.resolveComponent("ChatContent")();function M(n,l,c,o,m,f){return{a:o.currentDate,b:t.p({msgList:o.messageInfo}),c:t.o$1((...u)=>o.onConfirm&&o.onConfirm(...u)),d:o.inputString,e:t.o$1(u=>o.inputString=u.detail.value)}}var D=t._export_sfc(h,[["render",M],["__scopeId","data-v-ae0119f8"],["__file","C:/myself/social/social/src/pages/message/Chat.vue"]]);wx.createPage(D);
//# sourceMappingURL=Chat.js.map
