"use strict";var o=require("../../common/vendor.js"),r=require("../../utils/openIM.js"),p=require("../../utils/auth.js");const M=()=>"./ChatContent.js",C={components:{ChatContent:M},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const c="/static/images/default_avatar.png",g=o.useStore(),u=o.computed$1(()=>g.state.user.userInfo).value,n=o.ref([]),i=e=>{console.log("item=",e),o.index.navigateTo({url:`/pages/message/Chat?userID=${e.userID}&title=${e.showName}`})},t=()=>{r.openIM.getAllConversationList().then(({data:e})=>{console.log("\u4F1A\u8BDD\u603B\u6570data====",JSON.parse(e)),n.value=JSON.parse(e),f()}).catch(e=>{console.log("err=",e)})},s=(e,l)=>{console.log("userID, token=====================",e,l);const h={userID:e,token:l,url:"wss://mancao.social:20038",platformID:5};r.openIM.login(h).then(a=>{console.log("login suc...",a),a.errCode===0&&t()}).catch(a=>{console.log("login failed...",a)})},d=e=>JSON.parse(e).content,f=()=>{r.openIM.getTotalUnreadMsgCount().then(({data:e})=>{console.log("data===",e),console.log("Number(data)=",Number(e)),Number(e)>0?o.index.setTabBarBadge({index:2,text:"\xB7\xB7\xB7"}):o.index.removeTabBarBadge({index:2})}).catch(e=>{console.log("err=",e)})},v=()=>{r.openIM.on("OnRecvNewMessage",e=>{JSON.parse(e.data).contentType===101&&t()})};return o.onMounted(()=>{s(u.phone,p.getIMToken()),v()}),{defaultAvatar:c,convers:n,goChat:i,showLastMessage:d,getAllConversationList:t}}};function I(c,g,u,n,i,t){return{a:o.f(n.convers,(s,d,f)=>o.e({a:s.faceURL&&s.faceURL.includes("https://")?s.faceURL:n.defaultAvatar,b:s.unreadCount},s.unreadCount?{c:o.t(s.unreadCount)}:{},{d:o.t(s.showName),e:o.t(n.showLastMessage(s.latestMsg)),f:o.t(c.$filters.formatMsgDate(s.latestMsgSendTime)),g:s.userID,h:o.o$1(v=>n.goChat(s),s.userID)}))}}var _=o._export_sfc(C,[["render",I],["__scopeId","data-v-716a8bf6"],["__file","C:/myself/social/social/src/pages/message/index.vue"]]);wx.createPage(_);
//# sourceMappingURL=index.js.map
