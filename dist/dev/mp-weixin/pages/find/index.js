"use strict";var e=require("../../common/vendor.js"),P=require("../../utils/util.js"),S=require("../../api/file.js"),Q=require("../../utils/storage.js");require("../../utils/request.js");require("../../utils/auth.js");if(!Array){const A=e.resolveComponent("uni-easyinput"),q=e.resolveComponent("uni-forms-item"),m=e.resolveComponent("uni-forms");(A+q+m)()}const W=()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js",X=()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",Y=()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(W+X+Y)();const ee={onShow:function(){Q.getTotalIM()>0?e.index.setTabBarBadge({index:2,text:"\xB7\xB7\xB7"}):e.index.removeTabBarBadge({index:2})}},le=Object.assign(ee,{setup(A){const q=e.useStore(),m=e.computed$1(()=>q.state.user.userInfo).value;let $=e.ref(""),F=e.ref(0),p=e.ref(0),w=e.ref([]),B=e.ref("\u6682\u505C"),b=e.ref(!1),h=e.ref(!1),g=e.ref(!1),i=e.ref(!1),L=e.ref(""),c=e.ref([]),v=e.ref([]);e.ref(0),e.ref(0);const C=()=>{console.log("\u53BB\u8C03\u7528\u63A5\u53E3\u5408\u5E76\u6587\u4EF6");const{avatar:l,username:a}=m,t={hash:L.value,title:u.title,hobby:u.hobby,fileType:u.fileType,content:u.content,avatar:l,username:a};S.mergeFile(t).then(o=>{console.log("data===",o),b.value=!1,i.value=!1})},V=(l,a)=>new Promise((t,o)=>{const s=URL.createObjectURL(l.chunk);console.log("blobUrl===",s),e.index.uploadFile({url:"/prod/files/uploadLargeFile",filePath:s,name:"file",fileType:"video",formData:{filename:l.filename},success:r=>{console.log("uploadFileRes===",r);const{statusCode:n}=r;if(console.log("index================================",a),n===200){let f=c.value;const j=f.splice(0,1);w.value.push(j),c.value=[...f],console.log("partList=",c),console.log("cutPartslength=",w.value.length),console.log("partListLength=",p.value),F.value=(w.value.length/p.value*100).toFixed(2),t(!0)}else t(!1)},fail:r=>{console.log("err=",r)}})}),M=async()=>{b.value=!0,v.value=[],console.log("partList.value=",c.value),c.value.forEach((t,o)=>{const s=()=>V(t,o);v.value.push(s)});let l=0;const a=async()=>{if(!g.value){if(console.log("abort",g.value),console.log("requestList.value===",v.value),l>=v.value.length){C();return}try{const t=await v.value[l]();console.log("isStep=",t),t&&l++,a()}catch{throw new Error("err happened")}}};a()},D=async l=>{console.log("tempFiles===",l),i.value=!0;const a=await P.fileParse(l,"buffer"),t=new e.SparkMD5.ArrayBuffer;let o;t.append(a),L.value=t.end(),o=/\.([0-9a-zA-Z]+)$/i.exec(l.name)[1];const s=524288;let r=0;p.value=Math.ceil(l.size/s),console.log("partListLength=",p.value);for(let n=0;n<p.value;n++){let f={chunk:l.slice(r,r+s),filename:`${L.value}_${n}_.${o}`};r+=s,c.value.push(f)}M()},R=()=>{e.index.chooseVideo({sourceType:["camera","album"],success:function(l){console.log("res===",l),$.value=l.tempFilePath,h.value=!0,D(l.tempFile)}})},U=()=>{h.value?(B.value="\u7EE7\u7EED",h.value=!1,g.value=!0):(B.value="\u6682\u505C",h.value=!0,g.value=!1,M())};e.ref(""),e.ref(0);const z=async l=>{if(console.log("image=",l),!l)return;const{tempFilePaths:a,tempFiles:t}=l;i.value=!0;const o=Object.assign([],t),s=[];for(let d of o){const k=await P.fileParse(d,"base64");s.push({filename:d.name,chunk:k})}const r=await P.fileParse(t[0],"buffer"),n=new e.SparkMD5.ArrayBuffer;n.append(r);const f=n.end(),{avatar:j,username:N}=m;S.uploadImage(e.lib.stringify({fileAll:s,hash:f,title:u.title,hobby:parseInt(u.hobby),fileType:u.fileType,content:u.content,avatar:j,username:N})).then(d=>{console.log("data===",d);const{data:{code:k}}=d;k===200&&(F.value=100,i.value=!1)})},E=async()=>{e.index.chooseImage({count:6,sizeType:["original","compressed"],sourceType:["album"],success:function(l){z(l)}})},y=e.ref(null);let u=e.reactive({title:"",hobby:"",fileType:"",content:""}),O={title:{rules:[{required:!0,errorMessage:"\u8BF7\u8F93\u5165\u6807\u9898"}]},hobby:{rules:[{required:!0,errorMessage:"\u8BF7\u9009\u62E9\u5174\u8DA3"}]},fileType:{rules:[{required:!0,errorMessage:"\u8BF7\u9009\u62E9\u6587\u4EF6\u7C7B\u578B"}]},content:{rules:[{required:!0,errorMessage:"\u8BF7\u8F93\u5165\u6B63\u6587\u5185\u5BB9"}]}},_=e.ref(""),x=e.ref(""),I=e.ref(""),H=e.ref(""),Z=e.reactive([{value:0,text:"\u72FC\u4EBA\u6740",disable:!1},{value:1,text:"\u5267\u672C\u6740",disable:!1},{value:2,text:"\u767B\u5C71",disable:!1},{value:3,text:"\u65C5\u6E38",disable:!1},{value:4,text:"\u89C6\u9891",disable:!1}]),T=e.ref([{value:0,text:"\u56FE\u7247",disable:!1},{value:1,text:"\u89C6\u9891",disable:!1}]);const G=l=>{console.log("e=",l);const{detail:{value:a}}=l;I.value=a,y.value.setValue("hobby",a)},J=l=>{const{detail:{value:a}}=l;H.value=a,y.value.setValue("fileType",a)},K=()=>{y.value.validate().then(l=>{console.log("\u8868\u5355\u6570\u636E\u4FE1\u606F\uFF1A",l);const{fileType:a,title:t,content:o,hobby:s}=l;u.content=o,u.title=t,u.fileType=a,u.hobby=s,a===0?E():R()}).catch(l=>{console.log("\u8868\u5355\u9519\u8BEF\u4FE1\u606F\uFF1A",l)})};return e.watch(()=>I.value,l=>{switch(console.log("state=",l),l){case 0:case 1:T.value=[{value:0,text:"\u56FE\u7247",disable:!1}];break;case 2:case 3:T.value=[{value:0,text:"\u56FE\u7247",disable:!1},{value:1,text:"\u89C6\u9891",disable:!1}];break;case 4:T.value=[{value:1,text:"\u89C6\u9891",disable:!1}];break}},{deep:!0}),(l,a)=>e.e({a:e.o$1(t=>e.isRef(_)?_.value=t:_=t),b:e.p({placeholder:"\u8BF7\u8F93\u5165\u6807\u9898",modelValue:e.unref(_)}),c:e.p({required:!0,label:"\u6807    \u9898\uFF1A",name:"title",["label-width"]:"80"}),d:e.f(e.unref(Z),(t,o,s)=>({a:t.value,b:t.value,c:e.t(t.text),d:t.value,e:o})),e:e.o$1(G),f:e.p({required:!0,label:"\u5174    \u8DA3\uFF1A",name:"hobby",["label-width"]:"80"}),g:e.f(e.unref(T),(t,o,s)=>({a:t.value,b:t.value,c:e.t(t.text),d:t.value,e:t.value})),h:e.o$1(J),i:e.p({required:!0,label:"\u6587\u4EF6\u7C7B\u578B\uFF1A",name:"fileType",["label-width"]:"80"}),j:e.o$1(t=>e.isRef(x)?x.value=t:x=t),k:e.p({type:"textarea",maxlength:-1,autoHeight:!0,placeholder:"\u8BF7\u8F93\u5165\u6B63\u6587\u5185\u5BB9",modelValue:e.unref(x)}),l:e.p({required:!0,label:"\u5185    \u5BB9\uFF1A",name:"content",["label-width"]:"80"}),m:e.sr(y,"73679080-0",{k:"form"}),n:e.p({modelValue:e.unref(u),rules:e.unref(O)}),o:e.o$1(K),p:e.unref(i)},e.unref(i)?{q:e.unref(F)}:{},{r:e.unref(b)},e.unref(b)?{s:e.t(e.unref(B)),t:e.o$1(U)}:{})}});var te=e._export_sfc(le,[["__scopeId","data-v-73679080"],["__file","C:/myself/social/social/src/pages/find/index.vue"]]);wx.createPage(te);
//# sourceMappingURL=index.js.map
