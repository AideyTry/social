{"version":3,"file":"index.js","sources":["../../../../../src/pages/index/index.vue","../../../../../uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-17 17:33:16\r\n * @LastEditTime: 2022-06-22 16:03:14\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"content\">\r\n    <McTabs> </McTabs>\r\n    <!-- <button @click=\"open\">打开弹窗</button> -->\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { onMounted, computed } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { imRegister, imLogin } from \"@/api/im.js\";\r\nimport { setIMToken } from \"../../utils/auth.js\";\r\nimport McTabs from \"./McTabs.vue\";\r\nimport { getTotalIM } from \"@/utils/storage.js\";\r\nexport default {\r\n  onShow: function() {\r\n    if (getTotalIM() > 0) {\r\n      uni.setTabBarBadge({\r\n        index: 2,\r\n        text: \"···\",\r\n      });\r\n    } else {\r\n      //#ifdef APP-PLUS || H5\r\n      uni.removeTabBarBadge({\r\n        index: 2,\r\n      });\r\n      //#endif\r\n    }\r\n  },\r\n  components: {\r\n    McTabs,\r\n  },\r\n  setup() {\r\n    const store = useStore();\r\n    const userInfo = computed(() => store.state.user.userInfo).value;\r\n    const register = () => {\r\n      const params = {\r\n        secret: \"tuoyun\",\r\n        platform: 5,\r\n        operationID: Date.now() + \"\",\r\n      };\r\n      imRegister(params).then((res) => {\r\n        console.log(\"res========\", res);\r\n        if (res.statusCode === 200) {\r\n          console.log(\"res.data.token====\", res.data.token);\r\n          setIMToken(res.data.token);\r\n          // connectIM(res.data.data.userID, res.data.data.token);\r\n        }\r\n      });\r\n    };\r\n    const login = () => {\r\n      const params = {\r\n        userID: userInfo.phone,\r\n        secret: \"tuoyun\",\r\n        platform: 5,\r\n        operationID: Date.now() + \"\",\r\n      };\r\n      imLogin(params).then((res) => {\r\n        console.log(\"res========\", res);\r\n        if (res.statusCode === 200) {\r\n          if (res.data.errCode !== 0) {\r\n            register();\r\n            return;\r\n          }\r\n          if (res.data.data.token) {\r\n            console.log(\"res.data.token=\", res.data.token);\r\n            setIMToken(res.data.data.token);\r\n          }\r\n          // connectIM(res.data.data.userID, res.data.data.token);\r\n        }\r\n      });\r\n    };\r\n    onMounted(() => {\r\n      // connectIM(userID, token);\r\n      // login();\r\n      // resiger()\r\n      // console.log('userInfo=========================', userInfo.phone)\r\n    });\r\n    return {\r\n      title: \"蔓草\",\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.content {\r\n  /* display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center; */\r\n  /* background: #fdfdfd; */\r\n  /* padding: 0 32rpx; */\r\n}\r\n\r\n.logo {\r\n  height: 200rpx;\r\n  width: 200rpx;\r\n  margin-top: 200rpx;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  margin-bottom: 50rpx;\r\n}\r\n\r\n.text-area {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.title {\r\n  font-size: 36rpx;\r\n  color: #8f8f94;\r\n}\r\n.change-gender {\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/myself/social/social/src/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["getTotalIM","uni","useStore","computed","onMounted"],"mappings":";;;AAoBA,eAAe,MAAW;AAE1B;EACE,QAAQ,WAAW;AACjB,QAAIA,6BAAe,GAAG;AACpBC,0BAAI,eAAe;AAAA,QACjB,OAAO;AAAA,QACP,MAAM;AAAA,OACP;AAAA;;EASL,YAAY;AAAA,IACV;AAAA;EAEF,QAAQ;AACN,UAAM,QAAQC;AACGC,6BAAS,MAAM,MAAM,MAAM,KAAK,QAAQ,EAAE;AAsC3DC,4BAAU,MAAM;AAAA,KAKf;AACD,WAAO;AAAA,MACL,OAAO;AAAA;;AAGb;;;;;;;;;ACzFA,GAAG,WAAW,eAAe;"}