"use strict";var e=require("../../../common/vendor.js"),N=require("../../../api/user.js");require("../../../utils/request.js");require("../../../utils/auth.js");if(!Array){const f=e.resolveComponent("uni-forms-item"),i=e.resolveComponent("uni-forms");(f+i)()}const S=()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",x=()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(S+B+x)();const B=()=>"./PickerRegion.js",E={setup(f){const i=e.useStore();let s=e.computed$1(()=>i.state.user.userInfo).value,r=e.reactive({avatar:s.avatar,username:s.username,gender:s.gender,birthday:e.hooks(s.birthday).format("YYYY-MM-DD"),location:{provinceCode:s.location&&s.location.provinceCode,cityCode:s.location&&s.location.cityCode},hometown:{provinceCode:s.hometown&&s.hometown.provinceCode,cityCode:s.hometown&&s.hometown.cityCode},schoolName:s.schoolName,job:s.job,motto:s.motto,photos:s.photos}),C={username:{rules:[{required:!0,errorMessage:"\u8BF7\u8F93\u5165\u6635\u79F0"}]}};e.index.$on("schoolUpdate",function(o){r.schoolName=o.schoolName});const d=e.ref(null),_=o=>{console.log("form=e==",o),d.value.validate().then(n=>{console.log("\u8868\u5355\u6570\u636E\u4FE1\u606F\uFF1A",n);const t={form:{...n,photos:l}};N.editUserInfo(t).then(a=>{console.log("data======",a),i.dispatch("user/GetUserInfo").then(()=>{e.index.navigateTo({url:"/pages/user/info/index"})})})}).catch(n=>{console.log("\u8868\u5355\u9519\u8BEF\u4FE1\u606F\uFF1A",n)})},p="/static/images/default_avatar.png";let l=e.reactive(s.photos);e.watch(l,(o,n)=>{console.log("images",o),r.photos=o});const y=o=>o.filter(t=>t).length;console.log("images===",l);const u=e.ref(s.avatar);e.watch(u,(o,n)=>{r.avatar=o});const b=(o,n)=>{e.index.uploadFile({url:"https://mancao.social/prod/users/uploadFile",filePath:n,name:"file",formData:{user:"test"},success:t=>{console.log("uploadFileRes===",t);const{data:a}=t,c=JSON.parse(a);console.log("imgData=",c),l[o]=c.url,console.log("index===",o),o===0&&(u.value=c.url)}})},h=o=>{e.index.chooseImage({success:n=>{console.log("chooseImageRes===",n);const{tempFilePaths:t,tempFiles:a}=n;console.log("tempFilePaths[0]===",t[0]),b(o,t[0])}})},$=(o,n)=>{if(console.log("item, index===",o,n),o){let t=["\u7F16\u8F91"];n>0&&(t=["\u8BBE\u4E3A\u5934\u50CF","\u7F16\u8F91","\u5220\u9664"]),e.index.showActionSheet({itemList:t,success:function(a){if(console.log("\u9009\u4E2D\u4E86\u7B2C"+(a.tapIndex+1)+"\u4E2A\u6309\u94AE"),a.tapIndex===0){l[n]=l[0],l[0]=o,u.value=o;return}if(a.tapIndex===1){h(n);return}a.tapIndex===2&&l.splice(n,1)},fail:function(a){console.log(a.errMsg)}});return}h(n)},m=o=>{const n=new Date;let t=n.getFullYear(),a=n.getMonth()+1,c=n.getDate();return o==="start"?t=t-60:o==="end"&&(t=t+2),a=a>9?a:"0"+a,c=c>9?c:"0"+c,`${t}-${a}-${c}`},w=m({format:!0});console.log("currentDate===",w);let D=m("start"),I=m("end");const j=o=>{r.birthday=o.detail.value},F=()=>{e.index.showActionSheet({itemList:["\u7537","\u5973"],success:function(o){console.log("\u9009\u4E2D\u4E86\u7B2C"+(o.tapIndex+1)+"\u4E2A\u6309\u94AE")},fail:function(o){console.log(o.errMsg)}})},P=o=>{console.log("obj=====",o);const{provinceCode:n,cityCode:t}=o;r.location.provinceCode=n,r.location.cityCode=t},A=o=>{console.log("obj.home=====",o);const{provinceCode:n,cityCode:t}=o;r.hometown.provinceCode=n,r.hometown.cityCode=t},q=()=>{e.index.navigateTo({url:"/pages/user/info/School"})};let g=e.ref(["IT/\u4E92\u8054\u7F51/\u901A\u4FE1","\u91D1\u878D","\u5DE5\u4E1A\u5236\u9020\u4E1A","\u6559\u80B2/\u79D1\u7814","\u516C\u5171\u4E8B\u4E1A\u5355\u4F4D","\u533B\u836F/\u5065\u5EB7","\u5A92\u4F53/\u516C\u5173","\u5F71\u89C6/\u5A31\u4E50","\u96F6\u552E","\u9910\u996E/\u9152\u5E97","\u5176\u4ED6"]),v=e.ref(0);const M=o=>{const{detail:{value:n}}=o;v.value=n,r.job=g.value[n]};return(o,n)=>({a:u.value?u.value:p,b:e.p({name:"avatar"}),c:e.t(y(e.unref(l))),d:e.t(e.unref(l).length),e:e.f(e.unref(l),(t,a,c)=>e.e({a:t||p,b:!t&&e.unref(l)[a-1]||a===0&&!e.unref(l)[0]},!t&&e.unref(l)[a-1]||a===0&&!e.unref(l)[0]?{}:{},{c:e.o$1(L=>$(t,a)),d:a})),f:e.unref(r).motto,g:e.o$1(t=>e.unref(r).motto=t.detail.value),h:e.p({name:"motto"}),i:e.unref(r).username,j:e.o$1(t=>e.unref(r).username=t.detail.value),k:e.p({label:"\u6635\u79F0",name:"username"}),l:e.t(o.$filters.filterGender(e.unref(s).gender)),m:e.o$1(F),n:e.p({label:"\u6027\u522B",name:"gender"}),o:e.t(e.unref(r).birthday),p:e.unref(r).birthday,q:e.unref(D),r:e.unref(I),s:e.o$1(j),t:e.p({label:"\u51FA\u751F\u65E5\u671F",name:"birthday"}),v:e.o$1(P),w:e.p({propsProvinceCode:e.unref(r).location.provinceCode,propsCityCode:e.unref(r).location.cityCode}),x:e.p({label:"\u6240\u5728\u5730",name:"location"}),y:e.o$1(A),z:e.p({propsProvinceCode:e.unref(r).hometown.provinceCode,propsCityCode:e.unref(r).hometown.cityCode}),A:e.p({label:"\u5BB6\u4E61",name:"hometown"}),B:e.t(e.unref(r).schoolName?e.unref(r).schoolName:"\u8BF7\u9009\u62E9\u5B66\u6821"),C:e.o$1(q),D:e.p({label:"\u5B66\u6821",name:"schoolName"}),E:e.t(e.unref(r).job?e.unref(r).job:"\u8BF7\u9009\u62E9\u804C\u4E1A"),F:e.unref(g),G:e.unref(v),H:e.o$1(M),I:e.p({label:"\u804C\u4E1A",name:"job"}),J:e.sr(d,"53251d4e-0",{k:"form"}),K:e.p({modelValue:e.unref(r),rules:e.unref(C)}),L:e.o$1(_)})}};var U=e._export_sfc(E,[["__scopeId","data-v-53251d4e"],["__file","C:/myself/social/social/src/pages/user/info/Editor.vue"]]);wx.createPage(U);
//# sourceMappingURL=Editor.js.map
