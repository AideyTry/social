"use strict";var o=require("../../../common/vendor.js"),z=require("../../../api/hobby.js"),C=require("../../../api/publish.js"),P=require("../../../utils/util.js");require("../../../utils/request.js");require("../../../utils/auth.js");const A=()=>"../../components/Comment.js",B=()=>"../../components/VideoPlayer.js",E={components:{Comment:A,VideoPlayer:B},onLoad:function(i){console.log("options===",i)},onReady:function(){},setup(i){console.log("props=",i);const h=o.useStore();o.computed$1(()=>h.state.user.userInfo).value;const d=o.reactive({poster:"",src:""});let e=o.ref([{content:"https://social-1308251497.cos.ap-guangzhou.myqcloud.com/images/4.jfif"}]);o.ref(0),o.ref("default");let m=o.ref({});const I=n=>{const{id:t,hobby:c}=n,y={id:t,hobby:c};z.getHobbyDetail(y).then(u=>{u.data.code===200&&(m.value=u.data.data,f.value=P.formatDate(u.data.data.create_time),u.data.data.video_url||(l.value=m.value.photos.map((v,g)=>({path:v}))),d.poster=u.data.data.url,d.src=u.data.data.video_url)})},a=()=>{o.index.switchTab({url:"/pages/user/index"})};let f=o.ref(null),p=o.ref(["\u7F16\u8F91","\u5220\u9664"]),b=o.ref(0);const j=n=>{o.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){const{tempFiles:c}=t;l.value[n]=c[0]}})},k=n=>{if(l.value.length<=1){o.index.showModal({content:"\u81F3\u5C11\u9700\u8981\u53D1\u5E03\u4E00\u5F20\u56FE\u7247",confirmText:"\u77E5\u9053\u4E86",showCancel:!1,success:function(t){t.confirm?console.log("\u7528\u6237\u70B9\u51FB\u786E\u5B9A"):t.cancel&&console.log("\u7528\u6237\u70B9\u51FB\u53D6\u6D88")}});return}l.value.splice(n,1),console.log("photos.value===========",l.value)},w=(n,t)=>{console.log("item, index===",n,t),o.index.showActionSheet({itemList:p,success:function(c){console.log("\u9009\u4E2D\u4E86\u7B2C"+(c.tapIndex+1)+"\u4E2A\u6309\u94AE"),b.value=c.tapIndex,b.value===1?k(t):j(t)},fail:function(c){console.log(c.errMsg)}})},l=o.ref([]),q=()=>{o.index.chooseImage({count:6,sizeType:["original","compressed"],sourceType:["album"],success:function(n){console.log("res===",n);const{tempFiles:t}=n;l.value=l.value.concat(t),console.log("photos.value====",l.value)}})},x=o.ref(null),D=n=>{const{detail:t}=n;m.value.title.value=t},V=n=>{const{detail:t}=n;m.value.content.value=t},M=()=>{x.value.validate().then(async n=>{console.log("\u8868\u5355\u6570\u636E\u4FE1\u606F\uFF1A",n);const{title:t,content:c}=n;if(console.log("photos=====",l.value),l.value.length<=0){const s={title:t,id:parseInt(i.id),hobby:parseInt(i.hobby),content:c};C.updateVideoPublish(s).then(r=>{r.data.code===200&&(o.index.showToast({title:r.data.msg,duration:2e3}),o.index.switchTab({url:"/pages/user/index",success(){let _=getCurrentPages().pop();console.log("page==============",_),_&&_.onLoad()}}))});return}const y=l.value.map((s,r)=>({key:s,index:r})),u=y.filter(s=>s.key.path.includes("social-1308251497")),v=y.filter(s=>s.key.path.includes("blob:")),g=[];for(let s of v){const r=await P.fileParse(s.key,"base64");g.push({index:s.index,filename:s.key.name,chunk:r})}const L=m.value.photos[0].match(/myqcloud.com\/(\S*)/)[1].match(/(\S*)\//)[1],T=u.map(s=>({index:s.index,path:s.key.path})),S={uploadHash:L,uploadFiles:g.length>0?g:[],remotePhotos:T.length>0?T:[],title:t,id:parseInt(i.id),hobby:parseInt(i.hobby),content:c};C.updatePublish(o.lib.stringify(S)).then(s=>{s.data.code===200&&(o.index.showToast({title:s.data.msg,duration:2e3}),o.index.switchTab({url:"/pages/user/index",success(){let r=getCurrentPages().pop();console.log("page==============",r),r&&r.onLoad()}})),console.log("data=",s)})}).catch(n=>{console.log("\u8868\u5355\u9519\u8BEF\u4FE1\u606F\uFF1A",n)})};return o.onMounted(()=>{I({id:i.id,hobby:i.hobby})}),{hobbyInfo:m,photos:l,info:e,publishDate:f,options:d,goBack:a,onEdit:w,operations:p,activeOperationIndex:b,addImage:q,form:x,changeTitle:D,changeContent:V,submit:M}}};if(!Array){const i=o.resolveComponent("VideoPlayer"),h=o.resolveComponent("uni-forms-item"),d=o.resolveComponent("Comment"),e=o.resolveComponent("uni-forms");(i+h+d+e)()}const F=()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js",H=()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js";Math||(F+H)();function U(i,h,d,e,m,I){return o.e({a:o.o$1((...a)=>e.goBack&&e.goBack(...a)),b:e.hobbyInfo.avatar||"",c:o.t(e.hobbyInfo.username||""),d:e.hobbyInfo.fileType===0},e.hobbyInfo.fileType===0?{e:o.f(e.photos,(a,f,p)=>({a:a.path,b:o.o$1(b=>e.onEdit(a,f)),c:f})),f:o.o$1((...a)=>e.addImage&&e.addImage(...a))}:{},{g:e.hobbyInfo.fileType===1},e.hobbyInfo.fileType===1?{h:e.hobbyInfo.id,i:o.p({options:{src:e.hobbyInfo.video_url,poster:e.hobbyInfo.url}})}:{},{j:o.o$1((...a)=>e.changeTitle&&e.changeTitle(...a)),k:e.hobbyInfo.title,l:o.o$1(a=>e.hobbyInfo.title=a.detail.value),m:o.p({name:"title"}),n:o.o$1((...a)=>e.changeContent&&e.changeContent(...a)),o:e.hobbyInfo.content,p:o.o$1(a=>e.hobbyInfo.content=a.detail.value),q:o.p({name:"content"}),r:o.t(e.publishDate),s:e.hobbyInfo.id},e.hobbyInfo.id?{t:e.hobbyInfo.id,v:o.p({hobbyInfo:e.hobbyInfo})}:{},{w:o.sr("form","4278bb5c-0"),x:o.p({modelValue:e.hobbyInfo}),y:o.o$1((...a)=>e.submit&&e.submit(...a))})}var G=o._export_sfc(E,[["render",U],["__scopeId","data-v-4278bb5c"],["__file","C:/myself/social/social/src/pages/user/info/EditDetail.vue"]]);wx.createPage(G);
//# sourceMappingURL=EditDetail.js.map
