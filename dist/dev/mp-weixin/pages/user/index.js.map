{"version":3,"file":"index.js","sources":["../../../../../src/pages/user/index.vue","../../../../../uniPage:/cGFnZXMvdXNlci9pbmRleC52dWU"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-17 17:52:36\r\n * @LastEditTime: 2022-07-05 14:48:57\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"userinfo-wraper\">\r\n    <view class=\"userinfo\">\r\n      <view class=\"avatar-warper\" @click=\"onUserInfo\">\r\n        <image\r\n          :src=\"userInfo.avatar ? userInfo.avatar : defaultAvatar\"\r\n          class=\"avatar\"\r\n        ></image>\r\n        <text class=\"avatar-title\" v-if=\"!userInfo.avatar\">请上传图片</text>\r\n      </view>\r\n      <view class=\"userinfo-detail\">\r\n        <text>用户名：{{ userInfo.username }}</text>\r\n        <view class=\"motto\"\r\n          ><text>签&nbsp;&nbsp;&nbsp;名：</text\r\n          ><text>{{ userInfo.motto }}</text></view\r\n        >\r\n      </view>\r\n    </view>\r\n    <view class=\"fans-wraper\">\r\n      <view class=\"follows\" @click=\"goFollows\"\r\n        ><text>关注</text>&nbsp;<text>{{ follows.length }}</text></view\r\n      >\r\n      <view class=\"fans\" @click=\"goFans\"\r\n        ><text>粉丝</text>&nbsp;<text>{{ fans.length }}</text></view\r\n      >\r\n    </view>\r\n    <view class=\"publish-wraper\">\r\n      <view class=\"my-publishs\" @click=\"changeTab(0)\">\r\n        <text>我发布的</text>\r\n        <view :class=\"{ active: activeIndex === 0 }\"></view>\r\n      </view>\r\n      <view class=\"my-likes\" @click=\"changeTab(1)\">\r\n        <text>我喜欢的</text>\r\n        <view :class=\"{ active: activeIndex === 1 }\"></view>\r\n      </view>\r\n    </view>\r\n    <view>\r\n      <InfoList :list=\"publishs\" :activeIndex=\"activeIndex\" />\r\n    </view>\r\n    <button @click=\"onLogout\" style=\"margin-top: 20rpx\">退出</button>\r\n    <view v-if=\"false\">\r\n      <button @click=\"onOpenIMLogout\">OpenIM logout</button>\r\n      <button @click=\"onDeleteConversation\">Delete Conversicon</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getTotalIM } from \"@/utils/storage.js\";\r\nexport default {\r\n  onShow: function () {\r\n    if (getTotalIM() > 0) {\r\n      uni.setTabBarBadge({\r\n        index: 2,\r\n        text: \"···\",\r\n      });\r\n    } else {\r\n      uni.removeTabBarBadge({\r\n        index: 2,\r\n      });\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, watchEffect } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { removeToken } from \"../../utils/auth\";\r\nimport { getFollows, getFans } from \"@/api/communication.js\";\r\nimport { getPublish, getMylikes } from \"@/api/publish.js\";\r\n\r\nimport InfoList from \"@/pages/components/InfoList.vue\";\r\n\r\nimport openIM from \"@/utils/openIM.js\";\r\n\r\nconst defaultAvatar = \"/static/images/default_avatar.png\";\r\nconst store = useStore();\r\nconst userInfo = computed(() => store.state.user.userInfo).value;\r\n\r\nconst onLogout = () => {\r\n  new Promise((resolve, reject) => {\r\n    removeToken();\r\n    resolve();\r\n  }).then(() => {\r\n    //#ifdef H5\r\n    location.reload();\r\n    //#endif\r\n    //#ifdef APP-PLUS || MP-WEIXIN\r\n    uni.reLaunch({\r\n      url: \"/pages/login/index\",\r\n    });\r\n    //#endif\r\n  });\r\n};\r\n\r\nconst onUserInfo = () => {\r\n  //#ifdef APP-PLUS || H5\r\n  uni.navigateTo({\r\n    url: \"/pages/user/info/index\",\r\n  });\r\n  //#endif\r\n  //#ifdef MP-WEIXIN\r\n  uni.navigateTo({\r\n    url: \"/pages/userInfo/infoIndex/InfoIndex\",\r\n  });\r\n  //#endif\r\n};\r\n\r\n// fans\r\nlet follows = ref([]);\r\nlet fans = ref([]);\r\nlet getFollowsData = () => {\r\n  getFollows().then((data) => {\r\n    console.log(\"getfollows =\", data);\r\n    if (data.data.code === 200) {\r\n      follows.value = data.data.follows;\r\n    }\r\n  });\r\n};\r\nlet getFansData = () => {\r\n  getFans().then((data) => {\r\n    console.log(\"getfans =\", data);\r\n    if (data.data.code === 200) {\r\n      fans.value = data.data.fans;\r\n    }\r\n  });\r\n};\r\n\r\nconst goFollows = () => {\r\n  const userids = [];\r\n  for (let item of follows.value) {\r\n    userids.push(item.follow_id);\r\n  }\r\n  uni.navigateTo({\r\n    url: `/pages/user/info/Follow?type=${0}&userids=${encodeURIComponent(\r\n      JSON.stringify(userids)\r\n    )}`,\r\n  });\r\n};\r\n\r\nconst goFans = () => {\r\n  const userids = [];\r\n  for (let item of fans.value) {\r\n    userids.push(item.user_id);\r\n  }\r\n  uni.navigateTo({\r\n    url: `/pages/user/info/Follow?type=${1}&userids=${encodeURIComponent(\r\n      JSON.stringify(userids)\r\n    )}`,\r\n  });\r\n};\r\n\r\n// publish\r\nlet activeIndex = ref(0);\r\nlet publishs = ref([]);\r\n\r\nconst getPublishData = () => {\r\n  publishs.value = [];\r\n  getPublish().then((data) => {\r\n    console.log(\"data getPublish=\", data);\r\n    if (data.data.code === 200) {\r\n      publishs.value = data.data.data;\r\n    }\r\n  });\r\n};\r\n\r\n// 喜爱\r\nlet likes = ref([]);\r\nconst getMylikesData = () => {\r\n  publishs.value = [];\r\n  getMylikes().then((data) => {\r\n    console.log(\"data likes=\", data);\r\n    if (data.data.code === 200) {\r\n      publishs.value = data.data.data;\r\n    }\r\n  });\r\n};\r\n\r\nconst changeTab = (flag) => {\r\n  activeIndex.value = flag;\r\n};\r\n\r\nconst onOpenIMLogout = () => {\r\n  openIM\r\n    .logout()\r\n    .then(({ data }) => {\r\n      console.log(\"logout=\", data);\r\n    })\r\n    .catch((err) => {\r\n      console.log(\"logout err=\", err);\r\n    });\r\n};\r\n\r\nconst onDeleteConversation = () => {\r\n  openIM\r\n    .getAllConversationList()\r\n    .then((res) => {\r\n      //注意 会话对象中latestMsg（会话最后一条消息）仍为Json字符串格式 若需要使用请自行转换\r\n      console.log(\"res========\", res);\r\n      const conversData = JSON.parse(res.data);\r\n      conversData.forEach((item) => {\r\n        openIM\r\n          .deleteConversation(item.conversationID)\r\n          .then((res) => {\r\n            console.log(\"delete res=\", res);\r\n          })\r\n          .catch((err) => {\r\n            console.log(\"err=========\", err);\r\n          });\r\n      });\r\n      console.log(\"conversData=\", conversData);\r\n    })\r\n    .catch((err) => {});\r\n};\r\n\r\nwatchEffect(() => {\r\n  if (activeIndex.value === 0) {\r\n    getPublishData();\r\n  } else {\r\n    getMylikesData();\r\n  }\r\n}, activeIndex.value);\r\n\r\nonMounted(() => {\r\n  getFollowsData();\r\n  getFansData();\r\n  // getPublishData();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.userinfo-wraper {\r\n  padding: 40rpx;\r\n}\r\n.userinfo {\r\n  display: flex;\r\n  .userinfo-detail {\r\n    padding-left: 20rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    .motto {\r\n      display: flex;\r\n    }\r\n  }\r\n}\r\n.avatar-warper {\r\n  position: relative;\r\n}\r\n.avatar {\r\n  width: 150rpx;\r\n  height: 150rpx;\r\n  border-radius: 50%;\r\n  padding: 12rpx;\r\n}\r\n.avatar-title {\r\n  position: absolute;\r\n  left: 50%;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  transform: translateX(-50%);\r\n  font-size: 12rpx;\r\n}\r\n\r\n.fans-wraper {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n.follows {\r\n}\r\n.fans {\r\n  margin-left: 20rpx;\r\n  padding-left: 20rpx;\r\n  position: relative;\r\n}\r\n.fans:before {\r\n  content: \"\";\r\n  height: 80%;\r\n  position: absolute;\r\n  top: 10%;\r\n  left: 0;\r\n  border-left: 1px solid #ccc;\r\n}\r\n.publish-wraper {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 20rpx 0;\r\n  padding-top: 20rpx;\r\n  border-top: 1rpx solid #ccc;\r\n  // border-bottom: 1rpx solid #ccc;\r\n  .my-publishs,\r\n  .my-likes {\r\n    font-size: 28rpx;\r\n    position: relative;\r\n  }\r\n  .my-likes {\r\n    margin-left: 40rpx;\r\n  }\r\n  .active {\r\n    position: absolute;\r\n    left: 50%;\r\n    transform: translate(-50%, 0);\r\n    bottom: -10rpx;\r\n    width: 100%;\r\n    height: 0.1875rem;\r\n    border-radius: 0.125rem;\r\n    background-color: #ff8200;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/myself/social/social/src/pages/user/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["getTotalIM","uni","useStore","computed","removeToken","ref","getFollows","getFans","getPublish","getMylikes","watchEffect","onMounted"],"mappings":"qRAgFA,KAAM,GAAW,IAAW,8BAvBb,CACb,OAAQ,UAAY,CAClB,AAAIA,eAAe,EACjBC,QAAI,eAAe,CACjB,MAAO,EACP,KAAM,eACP,EAEDA,QAAI,kBAAkB,CACpB,MAAO,EACR,EAGP,8BAcA,KAAM,GAAgB,oCAChB,EAAQC,aACR,EAAWC,aAAS,IAAM,EAAM,MAAM,KAAK,QAAQ,EAAE,MAErD,EAAW,IAAM,CACrB,GAAI,SAAQ,CAAC,EAAS,IAAW,CAC/BC,gBACA,IACD,EAAE,KAAK,IAAM,CAKZH,QAAI,SAAS,CACX,IAAK,qBACN,EAEF,CACH,EAEM,EAAa,IAAM,CAOvBA,QAAI,WAAW,CACb,IAAK,sCACN,CAEH,EAGA,GAAI,GAAUI,MAAI,EAAE,EAChB,EAAOA,MAAI,EAAE,EACb,EAAiB,IAAM,CACzBC,eAAa,KAAK,AAAC,GAAS,CAC1B,QAAQ,IAAI,eAAgB,CAAI,EAC5B,EAAK,KAAK,OAAS,KACrB,GAAQ,MAAQ,EAAK,KAAK,SAE7B,CACH,EACI,EAAc,IAAM,CACtBC,YAAU,KAAK,AAAC,GAAS,CACvB,QAAQ,IAAI,YAAa,CAAI,EACzB,EAAK,KAAK,OAAS,KACrB,GAAK,MAAQ,EAAK,KAAK,MAE1B,CACH,EAEA,KAAM,GAAY,IAAM,CACtB,KAAM,GAAU,GAChB,OAAS,KAAQ,GAAQ,MACvB,EAAQ,KAAK,EAAK,SAAS,EAE7BN,QAAI,WAAW,CACb,IAAK,gCAAgC,aAAa,mBAChD,KAAK,UAAU,CAAO,KAEzB,CACH,EAEM,EAAS,IAAM,CACnB,KAAM,GAAU,GAChB,OAAS,KAAQ,GAAK,MACpB,EAAQ,KAAK,EAAK,OAAO,EAE3BA,QAAI,WAAW,CACb,IAAK,gCAAgC,aAAa,mBAChD,KAAK,UAAU,CAAO,KAEzB,CACH,EAGA,GAAI,GAAcI,MAAI,CAAC,EACnB,EAAWA,MAAI,EAAE,EAErB,KAAM,GAAiB,IAAM,CAC3B,EAAS,MAAQ,GACjBG,eAAa,KAAK,AAAC,GAAS,CAC1B,QAAQ,IAAI,mBAAoB,CAAI,EAChC,EAAK,KAAK,OAAS,KACrB,GAAS,MAAQ,EAAK,KAAK,MAE9B,CACH,EAGYH,MAAI,EAAE,EAClB,KAAM,GAAiB,IAAM,CAC3B,EAAS,MAAQ,GACjBI,eAAa,KAAK,AAAC,GAAS,CAC1B,QAAQ,IAAI,cAAe,CAAI,EAC3B,EAAK,KAAK,OAAS,KACrB,GAAS,MAAQ,EAAK,KAAK,MAE9B,CACH,EAEM,EAAY,AAAC,GAAS,CAC1B,EAAY,MAAQ,CACtB,EAmCAC,qBAAY,IAAM,CAChB,AAAI,EAAY,QAAU,EACxB,IAEA,GAEJ,EAAG,EAAY,KAAK,EAEpBC,YAAU,IAAM,CACd,IACA,GAEF,CAAC,mfC3OD,GAAG,WAAW,CAAe"}