"use strict";var g=require("./validate.js"),d=require("../../../../common/vendor.js");const b={name:"uniForms",components:{},emits:["input","reset","validate","submit"],props:{value:{type:Object,default(){return{}}},modelValue:{type:Object,default(){return{}}},rules:{type:Object,default(){return{}}},validateTrigger:{type:String,default:""},labelPosition:{type:String,default:"left"},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:"left"},errShowType:{type:String,default:"undertext"},border:{type:Boolean,default:!1}},data(){return{formData:{}}},computed:{dataValue(){return JSON.stringify(this.modelValue)==="{}"?this.value:this.modelValue}},watch:{rules(t){this.init(t)},labelPosition(){this.childrens.forEach(t=>{t.init()})}},created(){getApp().$vm.$.appContext.config.globalProperties.binddata||(getApp().$vm.$.appContext.config.globalProperties.binddata=function(e,i,r){if(r)this.$refs[r].setValue(e,i);else{let n;for(let s in this.$refs){const a=this.$refs[s];if(a&&a.$options&&a.$options.name==="uniForms"){n=a;break}}if(!n)return console.error("\u5F53\u524D uni-froms \u7EC4\u4EF6\u7F3A\u5C11 ref \u5C5E\u6027");n.setValue(e,i)}}),this.unwatchs=[],this.childrens=[],this.inputChildrens=[],this.checkboxChildrens=[],this.formRules=[],this.init(this.rules)},methods:{init(t){if(Object.keys(t).length===0){this.formData=this.dataValue;return}this.formRules=t,this.validator=new g.SchemaValidator(t),this.registerWatch()},registerWatch(){this.unwatchs.forEach(t=>t()),this.childrens.forEach(t=>{t.init()}),Object.keys(this.dataValue).forEach(t=>{let e=this.$watch("dataValue."+t,i=>{if(!!i)if(i.toString()==="[object Object]")for(let r in i){let n=`${t}[${r}]`;this.formData[n]=this._getValue(n,i[r])}else this.formData[t]=this._getValue(t,i)},{deep:!0,immediate:!0});this.unwatchs.push(e)})},setRules(t){this.init(t)},setValue(t,e,i){let r=this.childrens.find(n=>n.name===t);return r?(e=this._getValue(r.name,e),this.formData[t]=e,r.val=e,r.triggerCheck(e,i)):null},resetForm(t){this.childrens.forEach(e=>{e.errMsg="";const i=this.inputChildrens.find(r=>r.rename===e.name);i&&(i.errMsg="",i.is_reset=!0,i.$emit("input",i.multiple?[]:""),i.$emit("update:modelValue",i.multiple?[]:""))}),this.childrens.forEach(e=>{e.name&&(this.formData[e.name]=this._getValue(e.name,""))}),this.$emit("reset",t)},validateCheck(t){t===null&&(t=null),this.$emit("validate",t)},async validateAll(t,e,i,r){let n=[];for(let f in t){const o=this.childrens.find(l=>l.name===f);o&&n.push(o)}!r&&typeof i=="function"&&(r=i);let s;!r&&typeof r!="function"&&Promise&&(s=new Promise((f,o)=>{r=function(l,h){l?o(l):f(h)}}));let a=[],u={};if(this.validator)for(let f in n){const o=n[f];let l=o.isArray?o.arrayField:o.name;if(o.isArray){if(o.name.indexOf("[")!==-1&&o.name.indexOf("]")!==-1){const c=o.name.split("["),m=c[0],p=c[1].replace("]","");u[m]||(u[m]={}),u[m][p]=this._getValue(l,t[l])}}else u[l]=this._getValue(l,t[l]);const h=await o.triggerCheck(t[l],!0);if(h&&(a.push(h),this.errShowType==="toast"||this.errShowType==="modal"))break}else u=t;return Array.isArray(a)&&a.length===0&&(a=null),Array.isArray(i)&&i.forEach(f=>{u[f]=this.dataValue[f]}),e==="submit"?this.$emit("submit",{detail:{value:u,errors:a}}):this.$emit("validate",a),r&&typeof r=="function"&&r(a,u),s&&r?s:null},submitForm(){},submit(t,e,i){for(let r in this.dataValue)this.childrens.find(s=>s.name===r)&&this.formData[r]===void 0&&(this.formData[r]=this._getValue(r,this.dataValue[r]));return i||console.warn("submit \u65B9\u6CD5\u5373\u5C06\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528validate\u65B9\u6CD5\u4EE3\u66FF\uFF01"),this.validateAll(this.formData,"submit",t,e)},validate(t,e){return this.submit(t,e,!0)},validateField(t,e){t=[].concat(t);let i={};return this.childrens.forEach(r=>{t.indexOf(r.name)!==-1&&(i=Object.assign({},i,{[r.name]:this.formData[r.name]}))}),this.validateAll(i,"submit",[],e)},resetFields(){this.resetForm()},clearValidate(t){t=[].concat(t),this.childrens.forEach(e=>{const i=this.inputChildrens.find(r=>r.rename===e.name);(t.length===0||t.indexOf(e.name)!==-1)&&(e.errMsg="",i&&(i.errMsg=""))})},_getValue(t,e){const i=this.formRules[t]&&this.formRules[t].rules||[],r=i.find(s=>s.format&&this.type_filter(s.format)),n=i.find(s=>s.format&&s.format==="boolean"||s.format==="bool");return r&&(e=isNaN(e)?e:e===""||e===null?null:Number(e)),n&&(e=!!e),e},type_filter(t){return t==="int"||t==="double"||t==="number"||t==="timestamp"}}};function _(t,e,i,r,n,s){return{a:d.o$1((...a)=>s.submitForm&&s.submitForm(...a)),b:d.o$1((...a)=>s.resetForm&&s.resetForm(...a)),c:i.border?"":1}}var y=d._export_sfc(b,[["render",_],["__file","C:/myself/social/social/src/uni_modules/uni-forms/components/uni-forms/uni-forms.vue"]]);wx.createComponent(y);
//# sourceMappingURL=uni-forms.js.map
