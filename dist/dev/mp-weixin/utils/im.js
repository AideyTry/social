"use strict";var n=require("../api/im.js"),s=require("./auth.js"),r=require("./storage.js"),a=require("./openIM.js");const c=()=>{a.openIM.getTotalUnreadMsgCount().then(({data:e})=>{console.log("data==================================================================================",e),console.log("Number(data)=",Number(e)),r.setTotalIM(Number(e))}).catch(e=>{console.log("err=",e)})},i=()=>{a.openIM.on("OnRecvNewMessage",e=>{JSON.parse(e.data).contentType===101&&c()})},g=(e,o)=>{console.log("userID, token=====================",e,o);const l={userID:e,token:o,url:"wss://mancao.social:20038",platformID:5};a.openIM.login(l).then(t=>{console.log("login suc...",t),t.errCode===0&&(c(),i())}).catch(t=>{console.log("login failed...",t)})},d=()=>{const e={secret:"tuoyun",platform:5,operationID:Date.now()+""};n.imRegister(e).then(o=>{console.log("res========",o),o.statusCode===200&&(console.log("res.data.data.token====",o.data.data.token),s.setIMToken(o.data.data.token))})},u=()=>{const e={secret:"tuoyun",platform:5,operationID:Date.now()+""};n.imLogin(e).then(o=>{if(console.log("res========",o),o.statusCode===200){if(o.data.errCode!==0){d();return}o.data.data.token&&(console.log("res.data.data.token=",o.data),s.setIMToken(o.data.data.token),g(o.data.data.userID,o.data.data.token))}})};exports.login=u;
//# sourceMappingURL=im.js.map
