"use strict";var e=require("../api/im.js"),o=require("./auth.js"),t=require("./storage.js"),a=require("./openIM.js");const n=()=>{a.openIM.getTotalUnreadMsgCount().then((({data:e})=>{console.log("data==================================================================================",e),console.log("Number(data)=",Number(e)),t.setTotalIM(Number(e))})).catch((e=>{console.log("err=",e)}))},s=(e,o)=>{console.log("userID, token=====================",e,o);const t={userID:e,token:o,url:"wss://mancao.social:20038",platformID:5};a.openIM.login(t).then((e=>{console.log("login suc...",e),0===e.errCode&&(n(),a.openIM.on("OnRecvNewMessage",(e=>{101===JSON.parse(e.data).contentType&&n()})))})).catch((e=>{console.log("login failed...",e)}))};exports.login=()=>{const t={secret:"tuoyun",platform:5,operationID:Date.now()+""};e.imLogin(t).then((t=>{if(console.log("res========",t),200===t.statusCode){if(0!==t.data.errCode)return void(()=>{const t={secret:"tuoyun",platform:5,operationID:Date.now()+""};e.imRegister(t).then((e=>{console.log("res========",e),200===e.statusCode&&(console.log("res.data.data.token====",e.data.data.token),o.setIMToken(e.data.data.token))}))})();t.data.data.token&&(console.log("res.data.data.token=",t.data),o.setIMToken(t.data.data.token),s(t.data.data.userID,t.data.data.token))}}))};
//# sourceMappingURL=im.js.map
