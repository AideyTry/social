{"version":3,"file":"index.js","sources":["../../../../../src/pages/login/index.vue","../../../../../uniPage:/cGFnZXMvbG9naW4vaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-wraper\">\r\n    <view class=\"image-wraper\">\r\n      <!-- <image\r\n        style=\"width: 100%; height: 100%\"\r\n        src=\"../../static/images/login-bg.gif\"\r\n        mode=\"\"\r\n      ></image> -->\r\n      <image\r\n      class=\"image\"\r\n      src=\"../../static/logo.png\"></image>\r\n      <text class=\"logo-title\">蔓草兴趣</text>\r\n    </view>\r\n    <view class=\"login\">\r\n      <!-- #ifdef H5 || APP-PLUS || MP-WEIXIN -->\r\n      <form @submit=\"formSubmit\" @reset=\"formReset\" class=\"login-in\">\r\n        <view class=\"row-flex uni-form-item uni-column\">\r\n          <text class=\"title\">手机号：</text>\r\n          <input\r\n            class=\"uni-input\"\r\n            name=\"phone\"\r\n            placeholder=\"请输入手机号\"\r\n            @input=\"onInput\"\r\n          />\r\n        </view>\r\n        <view class=\"row-flex uni-form-item uni-column\">\r\n          <text class=\"title\">验证码：</text>\r\n          <input\r\n            class=\"uni-input\"\r\n            name=\"code\"\r\n            placeholder=\"请输入验证码\"\r\n            @input=\"onInputCode\"\r\n          />\r\n          <button\r\n            class=\"code\"\r\n            :disabled=\"(!sendCaptchaEnabled || codeVisible)\"\r\n            @click=\"sendCaptcha\"\r\n          >\r\n            {{ codeMessage\r\n            }}<text v-if=\"!sendCaptchaEnabled\">({{ counterTimer }}s)</text>\r\n          </button>\r\n        </view>\r\n        <view class=\"uni-btn-v\">\r\n          <button\r\n            form-type=\"submit\"\r\n            type=\"primary\"\r\n            class=\"btn-block\"\r\n            :disabled=\"loginVisible\"\r\n          >\r\n            登录\r\n          </button>\r\n        </view>\r\n      </form>\r\n      <show-modal v-if=\"demoVisible\" :title=\"'请选择账号'\" :content=\"'请任意选择一个账号登录'\" @close=\"onClose\"></show-modal>\r\n      <vuew class=\"demo\"><button class=\"demo-title\" @click=\"openDemo\">点击可使用演示账号登录</button></vuew>\r\n      <!-- #endif -->\r\n      <!-- #ifdef APP-PLUS -->\r\n      <view class=\"cut-off-line row\">\r\n        <view class=\"col-8 line-left\"></view>\r\n        <text>其他登录方式</text>\r\n        <view class=\"col-8 line-right\"></view>\r\n      </view>\r\n      <view class=\"other-login\">\r\n        <button\r\n          @click=\"wechatLogin\"\r\n          withCredentials=\"true\"\r\n          class=\"login-way wechat\"\r\n        >\r\n          <view class=\"m-icon m-icon-weixin\"></view>\r\n        </button>\r\n        <!-- </view> -->\r\n        <button\r\n          @click=\"qqLogin\"\r\n          withCredentials=\"true\"\r\n          class=\"login-way wechat\"\r\n        >\r\n          <view class=\"m-icon m-icon-QQ\"></view>\r\n        </button>\r\n        <button\r\n          @click=\"weiboLogin\"\r\n          withCredentials=\"true\"\r\n          class=\"login-way wechat\"\r\n        >\r\n          <view class=\"m-icon m-icon-weibo\"></view>\r\n        </button>\r\n      </view>\r\n      <!-- #endif -->\r\n    </view>\r\n\r\n    <!-- #ifdef MP-WEIXIN -->\r\n    <button\r\n      type=\"primary\"\r\n      open-type=\"openSetting\"\r\n      @getuserinfo=\"miniProLogin\"\r\n      class=\"auth-btn\"\r\n    >\r\n      登录\r\n    </button>\r\n    <button\r\n      type=\"primary\"\r\n      open-type=\"getUserInfo\"\r\n      @getuserinfo=\"getInfo\"\r\n      class=\"auth-btn\"\r\n    >\r\n      登录授权\r\n    </button>\r\n\r\n    <!-- #endif -->\r\n    <view class=\"gov-wraper\"><uni-link class=\"gov\" :showUnderLine=\"false\" href=\"https://beian.miit.gov.cn/\" text=\"粤ICP备2021179573号\"></uni-link></view>\r\n  </view>\r\n</template>\r\n<script>\r\nimport { sendCode, codePhoneLogin } from \"../../api/user.js\";\r\nimport { setToken } from \"../../utils/auth.js\";\r\nimport ShowModal from '@/pages/components/ShowModal.vue';\r\n\r\n/*  #ifdef  MP-WEIXIN  */\r\nimport { loginWechat } from \"../../api/wechat\";\r\n/*  #endif  */\r\nexport default {\r\n  components: {\r\n    ShowModal: ShowModal\r\n  },\r\n  data() {\r\n    return {\r\n      codeVisible: true,\r\n      loginVisible: true,\r\n      demoVisible: false,\r\n      sendCaptchaEnabled: true,\r\n      codeMessage: \"获取验证码\",\r\n      counterTimer: 60,\r\n      phoneNumber: null,\r\n    };\r\n  },\r\n  methods: {\r\n    onInput: function(e) {\r\n      console.log(\"input e=\", e);\r\n      if (/^1[3456789]\\d{9}$/.test(e.detail.value)) {\r\n        this.codeVisible = false;\r\n        this.phoneNumber = e.detail.value;\r\n      } else {\r\n        this.codeVisible = true;\r\n      }\r\n    },\r\n    onInputCode: function(e) {\r\n      console.log(\"code=\", e);\r\n      if (/^\\d{6}$/.test(e.detail.value)) {\r\n        this.loginVisible = false;\r\n      } else {\r\n        this.loginVisible = true;\r\n      }\r\n    },\r\n    sendCaptcha: function(e) {\r\n      console.log(\"button e=\", e);\r\n      if (!this.sendCaptchaEnabled) {\r\n        return;\r\n      }\r\n      this.sendCaptchaEnabled = false;\r\n      const params = {\r\n        phone: this.phoneNumber,\r\n      };\r\n      console.log(\"params===\", params);\r\n      sendCode(params).then((res) => {\r\n        console.log(\"res=\", res);\r\n      });\r\n      this.codeMessage = \"重新发送\";\r\n      const timer = setInterval(() => {\r\n        if (this.counterTimer <= 0) {\r\n          this.counterTimer = 60;\r\n          this.sendCaptchaEnabled = true;\r\n          clearInterval(timer);\r\n          this.codeMessage = \"获取验证码\";\r\n          return;\r\n        }\r\n        this.counterTimer--;\r\n      }, 1000);\r\n    },\r\n    formSubmit: function(e) {\r\n      console.log(\"e=\", e);\r\n      console.log(\r\n        \"form发生了submit事件，携带数据为：\" + JSON.stringify(e.detail.value)\r\n      );\r\n      const params = e.detail.value;\r\n      const that = this;\r\n      console.log(\"window.navigator=\", window.navigator.userAgent);\r\n      window.navigator.__defineGetter__(\"userAgent\", () => \"myBroser\");\r\n      setTimeout(() => {\r\n        console.log(\"window.navigator1=\", window.navigator.userAgent);\r\n      }, 200);\r\n      codePhoneLogin(params).then((res) => {\r\n        console.log(\"res========\", res);\r\n        const { code, token } = res.data;\r\n        if (code === 200) {\r\n          console.log(\"成功\");\r\n          setToken(token);\r\n          that.$store.dispatch(\"user/GetUserInfo\");\r\n          uni.reLaunch({\r\n            url: \"/pages/index/index\",\r\n          });\r\n        }\r\n      });\r\n    },\r\n    miniProLogin: function(e) {\r\n      console.log(\"e===\", e);\r\n      uni.login({\r\n        provider: \"weixin\",\r\n        success: function(loginRes) {\r\n          console.log(\"loginRes=\", loginRes.authResult);\r\n        },\r\n      });\r\n    },\r\n    wechatLogin: function() {\r\n      uni.showToast({\r\n        title: \"待上线\",\r\n        duration: 2000,\r\n      });\r\n    },\r\n    qqLogin: function() {\r\n      uni.showToast({\r\n        title: \"待上线\",\r\n        duration: 2000,\r\n      });\r\n    },\r\n    weiboLogin: function() {\r\n      uni.showToast({\r\n        title: \"待上线\",\r\n        duration: 2000,\r\n      });\r\n    },\r\n    getInfo: function(e) {\r\n      console.log(\"登录e=\", e);\r\n      uni.login({\r\n        provider: \"weixin\",\r\n        success: function(loginRes) {\r\n          console.log(\"loginRes====\", loginRes);\r\n          const { code } = loginRes;\r\n          loginWechat({\r\n            code,\r\n          }).then(\"res===\", res);\r\n        },\r\n      });\r\n    },\r\n    openDemo: function(){\r\n      this.demoVisible = true\r\n    },\r\n    onClose: function(){\r\n      this.demoVisible = false\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import url(\"../../static/iconfont/iconfont-mc/iconfont.css\");\r\n.login-wraper{\r\n  background-color: #fdfdfd;\r\n  position: relative;\r\n  height: 100vh;\r\n}\r\n.btn-block {\r\n  height: 46px;\r\n  line-height: 46px;\r\n}\r\n.image-wraper{\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 100rpx 0;\r\n.image {\r\n  height: 180rpx;\r\n  width: 180rpx;\r\n  border-radius: 100%;\r\n}\r\n.logo-title{\r\n  margin-top: 6rpx;\r\n  font-size: 56rpx;\r\n  font-family: \"Times New Roman\", Times, serif;\r\n  color: #434343;\r\n  font-weight: 500;\r\n}\r\n}\r\n\r\n.login {\r\n  padding: 20rpx;\r\n}\r\n\r\n.login-in {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n.uni-form-item .title {\r\n  padding: 40rpx 0;\r\n  font-size: 32rpx;\r\n}\r\n\r\n.code {\r\n  width: 208rpx;\r\n  font-size: 24rpx;\r\n  height: 68rpx;\r\n  line-height: 68rpx;\r\n}\r\nuni-button::after{\r\n  border: none!important;\r\n}\r\n\r\n.uni-btn-v {\r\n  margin-top: 40rpx;\r\n}\r\n\r\n.cut-off-line {\r\n  padding: 60upx 0;\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.line-left {\r\n  border: 2upx solid #3f536e;\r\n}\r\n\r\n.line-right {\r\n  border: 2upx solid #3f536e;\r\n}\r\n\r\n.other-login {\r\n  /* padding-top: 40upx; */\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.wechat,\r\n.qq {\r\n  margin-right: 100rpx;\r\n}\r\n\r\n.login-way {\r\n  width: 100rpx;\r\n  height: 100rpx;\r\n  border-radius: 50%;\r\n  padding-left: 0;\r\n  background-color: #ededed;\r\n}\r\n\r\n.login-icon {\r\n  width: 100rpx;\r\n  height: 100rpx;\r\n}\r\n.m-icon {\r\n  width: 50px;\r\n  height: 50px;\r\n}\r\n\r\n.auth-btn {\r\n  margin-top: 60rpx;\r\n}\r\n.gov-wraper{\r\n  position: absolute;\r\n  bottom: 100rpx;\r\n  width: 100%;\r\n}\r\n.gov{\r\n  display: flex;\r\n  justify-content: center;\r\n  width: 100%;\r\n  }\r\n\r\n.demo{\r\n  display: flex;\r\n  justify-content: center;\r\n  .demo-title{\r\n  background-color: #42b983;\r\n  color: #fff;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/myself/social/social/src/pages/login/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["components","ShowModal","data","codeVisible","loginVisible","demoVisible","sendCaptchaEnabled","codeMessage","counterTimer","phoneNumber","methods","onInput","e","log","test","detail","value","onInputCode","sendCaptcha","this","params","phone","then","res2","timer","setInterval","formSubmit","JSON","stringify","that","window","navigator","userAgent","__defineGetter__","code","token","$store","dispatch","reLaunch","url","miniProLogin","login","provider","success","loginRes","authResult","wechatLogin","showToast","title","duration","qqLogin","weiboLogin","getInfo","res","openDemo","onClose","wx","createPage","MiniProgramPage"],"mappings":"wLAkHA,SAMEA,WAAY,CACVC,UAPc,IAAW,8BAS3BC,UACS,CACLC,aAAa,EACbC,cAAc,EACdC,aAAa,EACbC,oBAAoB,EACpBC,YAAa,QACbC,aAAc,GACdC,YAAa,OAGjBC,QAAS,CACPC,QAAS,SAASC,WACRC,IAAI,WAAYD,GACpB,oBAAoBE,KAAKF,EAAEG,OAAOC,aAC/Bb,aAAc,OACdM,YAAcG,EAAEG,OAAOC,YAEvBb,aAAc,GAGvBc,YAAa,SAASL,WACZC,IAAI,QAASD,GACjB,UAAUE,KAAKF,EAAEG,OAAOC,YACrBZ,cAAe,OAEfA,cAAe,GAGxBc,YAAa,SAASN,cACZC,IAAI,YAAaD,IACpBO,KAAKb,+BAGLA,oBAAqB,QACpBc,EAAS,CACbC,MAAOF,KAAKV,qBAENI,IAAI,YAAaO,cAChBA,GAAQE,MAAMC,YACbV,IAAI,OAAQU,WAEjBhB,YAAc,aACbiB,EAAQC,aAAY,QACpBN,KAAKX,cAAgB,cAClBA,aAAe,QACfF,oBAAqB,gBACZkB,aACTjB,YAAc,cAGhBC,iBACJ,MAELkB,WAAY,SAASd,WACXC,IAAI,KAAMD,WACVC,IACN,yBAA2Bc,KAAKC,UAAUhB,EAAEG,OAAOC,cAE/CI,EAASR,EAAEG,OAAOC,MAClBa,EAAOV,aACLN,IAAI,oBAAqBiB,OAAOC,UAAUC,kBAC3CD,UAAUE,iBAAiB,aAAa,IAAM,yBAC1C,aACDpB,IAAI,qBAAsBiB,OAAOC,UAAUC,aAClD,sBACYZ,GAAQE,MAAMC,YACnBV,IAAI,cAAeU,SACrBW,KAAEA,QAAMC,GAAUZ,EAAIrB,KACf,MAATgC,YACMrB,IAAI,iBACHsB,KACJC,OAAOC,SAAS,4BACjBC,SAAS,CACXC,IAAK,4BAKbC,aAAc,SAAS5B,WACbC,IAAI,OAAQD,WAChB6B,MAAM,CACRC,SAAU,SACVC,QAAS,SAASC,WACR/B,IAAI,YAAa+B,EAASC,gBAIxCC,YAAa,mBACPC,UAAU,CACZC,MAAO,MACPC,SAAU,OAGdC,QAAS,mBACHH,UAAU,CACZC,MAAO,MACPC,SAAU,OAGdE,WAAY,mBACNJ,UAAU,CACZC,MAAO,MACPC,SAAU,OAGdG,QAAS,SAASxC,WACRC,IAAI,OAAQD,WAChB6B,MAAM,CACRC,SAAU,SACVC,QAAS,SAASC,WACR/B,IAAI,eAAgB+B,SACtBV,KAAEA,GAASU,gBACL,CACVV,KAAAA,IACCZ,KAAK,SAAU+B,SAIxBC,SAAU,gBACHjD,aAAc,GAErBkD,QAAS,gBACFlD,aAAc,m8BCrPzBmD,GAAGC,WAAWC"}