"use strict";var e=require("../../../common/vendor.js"),o=require("../../../api/hobby.js"),t=require("../../../api/publish.js"),n=require("../../../utils/util.js");require("../../../utils/request.js"),require("../../../utils/auth.js");const a={components:{Comment:()=>"../../components/Comment.js",VideoPlayer:()=>"../../components/VideoPlayer.js"},onLoad:function(e){console.log("options===",e)},onReady:function(){},setup(a){console.log("props=",a);const s=e.useStore();e.computed$1((()=>s.state.user.userInfo)).value;const i=e.reactive({poster:"",src:""});let l=e.ref([{content:"https://social-1308251497.cos.ap-guangzhou.myqcloud.com/images/4.jfif"}]);e.ref(0),e.ref("default");let c=e.ref({});let u=e.ref(null),r=e.ref(["编辑","删除"]),d=e.ref(0);const p=e.ref([]),h=e.ref(null);return e.onMounted((()=>{(e=>{const{id:t,hobby:a}=e,s={id:t,hobby:a};o.getHobbyDetail(s).then((e=>{200===e.data.code&&(c.value=e.data.data,u.value=n.formatDate(e.data.data.create_time),e.data.data.video_url||(p.value=c.value.photos.map(((e,o)=>({path:e})))),i.poster=e.data.data.url,i.src=e.data.data.video_url)}))})({id:a.id,hobby:a.hobby})})),{hobbyInfo:c,photos:p,info:l,publishDate:u,options:i,goBack:()=>{e.index.switchTab({url:"/pages/user/index"})},onEdit:(o,t)=>{console.log("item, index===",o,t),e.index.showActionSheet({itemList:r,success:function(o){console.log("选中了第"+(o.tapIndex+1)+"个按钮"),d.value=o.tapIndex,1===d.value?(o=>{p.value.length<=1?e.index.showModal({content:"至少需要发布一张图片",confirmText:"知道了",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}}):(p.value.splice(o,1),console.log("photos.value===========",p.value))})(t):(o=>{e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(e){const{tempFiles:t}=e;p.value[o]=t[0]}})})(t)},fail:function(e){console.log(e.errMsg)}})},operations:r,activeOperationIndex:d,addImage:()=>{e.index.chooseImage({count:6,sizeType:["original","compressed"],sourceType:["album"],success:function(e){console.log("res===",e);const{tempFiles:o}=e;p.value=p.value.concat(o),console.log("photos.value====",p.value)}})},form:h,changeTitle:e=>{const{detail:o}=e;c.value.title.value=o},changeContent:e=>{const{detail:o}=e;c.value.content.value=o},submit:()=>{h.value.validate().then((async o=>{console.log("表单数据信息：",o);const{title:s,content:i}=o;if(console.log("photos=====",p.value),p.value.length<=0){const o={title:s,id:parseInt(a.id),hobby:parseInt(a.hobby),content:i};return void t.updateVideoPublish(o).then((o=>{200===o.data.code&&(e.index.showToast({title:o.data.msg,duration:2e3}),e.index.switchTab({url:"/pages/user/index",success(){let e=getCurrentPages().pop();console.log("page==============",e),e&&e.onLoad()}}))}))}const l=p.value.map(((e,o)=>({key:e,index:o}))),u=l.filter((e=>e.key.path.includes("social-1308251497"))),r=l.filter((e=>e.key.path.includes("blob:"))),d=[];for(let e of r){const o=await n.fileParse(e.key,"base64");d.push({index:e.index,filename:e.key.name,chunk:o})}const h=c.value.photos[0].match(/myqcloud.com\/(\S*)/)[1].match(/(\S*)\//)[1],b=u.map((e=>({index:e.index,path:e.key.path}))),m={uploadHash:h,uploadFiles:d.length>0?d:[],remotePhotos:b.length>0?b:[],title:s,id:parseInt(a.id),hobby:parseInt(a.hobby),content:i};t.updatePublish(e.lib.stringify(m)).then((o=>{200===o.data.code&&(e.index.showToast({title:o.data.msg,duration:2e3}),e.index.switchTab({url:"/pages/user/index",success(){let e=getCurrentPages().pop();console.log("page==============",e),e&&e.onLoad()}})),console.log("data=",o)}))})).catch((e=>{console.log("表单错误信息：",e)}))}}}};if(!Array){(e.resolveComponent("VideoPlayer")+e.resolveComponent("uni-forms-item")+e.resolveComponent("Comment")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js"))();var s=e._export_sfc(a,[["render",function(o,t,n,a,s,i){return e.e({a:e.o$1(((...e)=>a.goBack&&a.goBack(...e))),b:a.hobbyInfo.avatar||"",c:e.t(a.hobbyInfo.username||""),d:0===a.hobbyInfo.fileType},0===a.hobbyInfo.fileType?{e:e.f(a.photos,((o,t,n)=>({a:o.path,b:e.o$1((e=>a.onEdit(o,t))),c:t}))),f:e.o$1(((...e)=>a.addImage&&a.addImage(...e)))}:{},{g:1===a.hobbyInfo.fileType},1===a.hobbyInfo.fileType?{h:a.hobbyInfo.id,i:e.p({options:{src:a.hobbyInfo.video_url,poster:a.hobbyInfo.url}})}:{},{j:e.o$1(((...e)=>a.changeTitle&&a.changeTitle(...e))),k:a.hobbyInfo.title,l:e.o$1((e=>a.hobbyInfo.title=e.detail.value)),m:e.p({name:"title"}),n:e.o$1(((...e)=>a.changeContent&&a.changeContent(...e))),o:a.hobbyInfo.content,p:e.o$1((e=>a.hobbyInfo.content=e.detail.value)),q:e.p({name:"content"}),r:e.t(a.publishDate),s:a.hobbyInfo.id},a.hobbyInfo.id?{t:a.hobbyInfo.id,v:e.p({hobbyInfo:a.hobbyInfo})}:{},{w:e.sr("form","2828ac05-0"),x:e.p({modelValue:a.hobbyInfo}),y:e.o$1(((...e)=>a.submit&&a.submit(...e)))})}],["__scopeId","data-v-2828ac05"]]);wx.createPage(s);
//# sourceMappingURL=EditDetail.js.map
