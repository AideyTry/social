"use strict";var e=require("../../common/vendor.js"),t=require("../../utils/openIM.js"),o=require("../../utils/auth.js");const a={components:{ChatContent:()=>"./ChatContent.js"},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const a=e.useStore(),s=e.computed$1((()=>a.state.user.userInfo)).value,n=e.ref([]),r=()=>{t.openIM.getAllConversationList().then((({data:e})=>{console.log("会话总数data====",JSON.parse(e)),n.value=JSON.parse(e),l()})).catch((e=>{console.log("err=",e)}))},l=()=>{t.openIM.getTotalUnreadMsgCount().then((({data:t})=>{console.log("data===",t),console.log("Number(data)=",Number(t)),Number(t)>0?e.index.setTabBarBadge({index:2,text:"···"}):e.index.removeTabBarBadge({index:2})})).catch((e=>{console.log("err=",e)}))};return e.onMounted((()=>{((e,o)=>{console.log("userID, token=====================",e,o);const a={userID:e,token:o,url:"wss://mancao.social:20038",platformID:5};t.openIM.login(a).then((e=>{console.log("login suc...",e),0===e.errCode&&r()})).catch((e=>{console.log("login failed...",e)}))})(s.phone,o.getIMToken()),t.openIM.on("OnRecvNewMessage",(e=>{101===JSON.parse(e.data).contentType&&r()}))})),{defaultAvatar:"/static/images/default_avatar.png",convers:n,goChat:t=>{console.log("item=",t),e.index.navigateTo({url:`/pages/message/Chat?userID=${t.userID}&title=${t.showName}`})},showLastMessage:e=>JSON.parse(e).content,getAllConversationList:r}}};var s=e._export_sfc(a,[["render",function(t,o,a,s,n,r){return{a:e.f(s.convers,((o,a,n)=>e.e({a:o.faceURL&&o.faceURL.includes("https://")?o.faceURL:s.defaultAvatar,b:o.unreadCount},o.unreadCount?{c:e.t(o.unreadCount)}:{},{d:e.t(o.showName),e:e.t(s.showLastMessage(o.latestMsg)),f:e.t(t.$filters.formatMsgDate(o.latestMsgSendTime)),g:o.userID,h:e.o$1((e=>s.goChat(o)),o.userID)})))}}],["__scopeId","data-v-64a59283"]]);wx.createPage(s);
//# sourceMappingURL=index.js.map
