"use strict";var e=require("../../common/vendor.js"),t=require("../../utils/openIM.js");const s={components:{ChatContent:()=>"./ChatContent.js"},onShow:function(e){this.currentDate=new Date+Math.random(),setTimeout((()=>{this.getConver()}),1e3)},setup(s){let n=e.ref("");const o=e.ref([]),r=e.useStore();console.log("store.state.user===========================================================================",r.getters["user/getUserInfo"]),e.computed$1((()=>r.getters["user/getUserInfo"])).value;const a=()=>{const e={groupID:"",startClientMsgID:"",count:1e4,userID:s.userID};t.openIM.getHistoryMessageList(e).then((({data:e})=>{console.log("历史数据=",JSON.parse(e)),o.value=[...JSON.parse(e).reverse()]})).catch((e=>{console.log("err 000000000000000000000000000000000000000000=",e)}))};e.watch((()=>o),((e,n)=>{const o=e.value.filter((e=>e.sendID===s.userID)).map((e=>e.clientMsgID)),r={userID:s.userID,msgIDList:o};t.openIM.markC2CMessageAsRead(r).then((({data:e})=>{console.log("传入已读=",e),t.openIM.markC2CMessageAsRead({userID:s.userID,msgIDList:[]})})).catch((e=>{console.log("err===",e)}))}),{deep:!0}),e.onMounted((()=>{e.index.setNavigationBarTitle({title:s.title}),a(),t.openIM.on("OnRecvNewMessage",(e=>{const t=JSON.parse(e.data);101===t.contentType&&o.value.unshift(t)})),t.openIM.on("OnRecvC2CReadReceipt",(e=>{JSON.parse(e.data).map((e=>{e.msgIDList.map((e=>{o.value.find((t=>{t.clientMsgID===e&&(t.isRead=!0)}))}))}))}))}));let u=e.ref("");return{inputString:n,messageInfo:o,onConfirm:e=>{const{value:r}=e.detail;n.value=r;const a={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};t.openIM.createTextMessage(r).then((e=>{const r={recvID:s.userID,groupID:"",offlinePushInfo:a,message:e.data};t.openIM.sendMessage(r).then((({data:e,errCode:t})=>{const s=JSON.parse(e);o.value.unshift(s),n.value=""})).catch((e=>{console.log("err=",e)}))})).catch((e=>{console.log("text err=",e)}))},currentDate:u,getConver:a}}};if(!Array){e.resolveComponent("ChatContent")()}var n=e._export_sfc(s,[["render",function(t,s,n,o,r,a){return{a:o.currentDate,b:e.p({msgList:o.messageInfo}),c:e.o$1(((...e)=>o.onConfirm&&o.onConfirm(...e))),d:o.inputString,e:e.o$1((e=>o.inputString=e.detail.value))}}],["__scopeId","data-v-62f0652a"]]);wx.createPage(n);
//# sourceMappingURL=Chat.js.map
