"use strict";var e=require("../../common/vendor.js"),l=require("../../api/communication.js");require("../../utils/request.js"),require("../../utils/auth.js");const t={name:"waterFall"},i=Object.assign(t,{props:{list:{type:Array,default:[]},activeIndex:{type:Number,default:1}},setup(t){const i=t;let a=e.ref([]),o=e.ref(328),s=e.ref(2),n=e.ref(20),r=e.ref(20),u=e.ref([]);e.ref(null);let c=e.ref(null);const d=()=>{u.value=new Array(s.value);for(let e=0;e<u.value.length;e++)u.value[e]=0;g()},g=async()=>{for(let e=0;e<i.list.length;e++){let l=new Image;l.src=i.list[e].url,console.log("waterfall==",c.value);const t=await new Promise((t=>{l.onload=s=>{console.log("e=",s);let n={};n.height=o.value/l.width*l.height+160,n.id=i.list[e].id,n.src=i.list[e].url,n.title=i.list[e].title,n.avatar=i.list[e].avatar,n.username=i.list[e].username,n.likes=i.list[e].likes,n.fileType=i.list[e].fileType,a.value.push(n),f(n),t(n)}}));p(),console.log("img==",t)}},f=e=>{const l=Math.min.apply(null,u.value);let t=u.value.indexOf(l);e.top=u.value[t],e.left=t*(n.value+o.value),u.value[t]+=e.height+r.value,console.log("imageData==",e)},v=t=>{console.log("item=",t);let a=e.index.getStorageSync("like")||[];if(a.includes(t.id)){console.log("isOK=",a);for(let e=0;e<a.length;e++)a[e]===t.id&&a.splice(e,1);t.likes-=1,t.likeFlag=!1,e.index.setStorageSync("like",a)}else t.likes+=1,t.likeFlag=!0,console.log("likeIds=",a),a.unshift(t.id),e.index.setStorageSync("like",a);const o={hobby:i.activeIndex,hobbyId:t.id};l.setLike(o).then((e=>{console.log("like data=",e)}))},p=()=>{const t={hobby:i.activeIndex};l.getLike(t).then((l=>{if(console.log("getLike=",l),200===l.data.code){const t=l.data.likes.map((e=>e.hobby_id));e.index.setStorageSync("like",t);for(let e=0;e<a.value.length;e++)t.includes(a.value[e].id)?a.value[e].likeFlag=!0:a.value[e].likeFlag=!1;console.log("waterfallList====",a.value)}}))};return e.onMounted((()=>{console.log("list1=",i.list),d()})),e.onUpdated((()=>{console.log("list2=",i.list)})),e.watchEffect((()=>{d()})),(l,t)=>({a:e.f(e.unref(a),((l,t,a)=>e.e({a:l.src,b:l.fileType},(l.fileType,{}),{c:e.t(l.title),d:l.avatar,e:e.t(l.username),f:l.likeFlag},l.likeFlag?{g:e.o$1((e=>v(l)))}:{h:e.o$1((e=>v(l)))},{i:e.t(l.likes),j:l.top+"rpx",k:l.left+"rpx",l:l.id,m:e.o$1((t=>(l=>{console.log("item=",l),console.log("props===",i),e.index.navigateTo({url:`/pages/index/HobbyDetailMountain?id=${l.id}&hobby=${i.activeIndex}`})})(l)),l.id)}))),b:e.unref(o)+"rpx"})}});var a=e._export_sfc(i,[["__scopeId","data-v-2fd3e692"]]);wx.createComponent(a);
//# sourceMappingURL=WaterFall.js.map
