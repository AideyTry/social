{"version":3,"file":"user.js","sources":["../../../../../src/store/module/user.js"],"sourcesContent":["/*\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-20 17:46:39\r\n * @LastEditTime: 2022-05-15 14:24:42\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n */\r\nimport { getUserInfo } from '../../api/user'\r\nimport { validataGender, validateObjAttr } from '../../utils/validate'\r\nimport { login } from '@/utils/im.js'\r\nimport {\r\n    getStoreUserInfo,\r\n    setStoreUserInfo\r\n  } from \"@/utils/storage.js\";\r\n\r\nexport const user = {\r\n    namespaced: true,\r\n    state: {\r\n        userInfo: null || getStoreUserInfo()\r\n    },\r\n    getters: {\r\n        getUserInfo: (state) => {\r\n            return state.userInfo || getStoreUserInfo()\r\n        }\r\n    },\r\n    mutations: {\r\n        setUserInfo(state, userInfo){\r\n            if(!validataGender(userInfo)){\r\n                console.log('不应该=', userInfo)\r\n                // uni.reLaunch({\r\n                //     url: '/pages/index/index'\r\n                // });\r\n                // console.log('uni.dlbModal===', uni.dlbModal)\r\n                // uni.dlbModal({\r\n                //     title: '提示',\r\n                //     showCancel: false,\r\n                //     content: '还未选性别1',\r\n                //     success: function (res) {\r\n                //         if (res.confirm) {\r\n                //             uni.reLaunch({\r\n                //                 url: '/pages/user/index'\r\n                //             });\r\n                //         }\r\n                //     }\r\n                // })\r\n                uni.redirectTo({\r\n                    url: '/pages/user/gender/index'\r\n                });\r\n                // uni.reLaunch({\r\n                //     url: \"/pages/user/RegGender\",\r\n                //   });\r\n                // uni.showModal({\r\n                //     title: '提示',\r\n                //     showCancel: false,\r\n                //     content: '还未选性别',\r\n                //     success: function (res) {\r\n                //         if (res.confirm) {\r\n                //             uni.reLaunch({\r\n                //                 url: '/pages/user/index'\r\n                //             });\r\n                //         }\r\n                //     }\r\n                // });\r\n            }else if(!validateObjAttr(userInfo)){\r\n                uni.showModal({\r\n                    title: '提示',\r\n                    content: '请完善头像、昵称等个人信息资料',\r\n                    success: function (res) {\r\n                        if (res.confirm) {\r\n                            uni.reLaunch({\r\n                                url: '/pages/user/index'\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            state.userInfo = userInfo\r\n            setStoreUserInfo(userInfo)\r\n        }\r\n    },\r\n    actions: {\r\n        async GetUserInfo({commit}) {\r\n            const { data: {\r\n                code, data\r\n            } } = await getUserInfo()\r\n            console.log('data=', data)\r\n            if(code === 200){\r\n                login()\r\n                commit('setUserInfo', data)\r\n            }\r\n        },\r\n        async IMLogin ({commit}){\r\n            login()\r\n        }\r\n    }\r\n}"],"names":["user","namespaced","state","userInfo","getStoreUserInfo","getters","getUserInfo","mutations","setUserInfo","validataGender","validateObjAttr","showModal","title","content","success","res","confirm","reLaunch","url","log","redirectTo","actions","async","commit","data","code"],"mappings":"4LAgBY,MAACA,EAAO,CAChBC,YAAY,EACZC,MAAO,CACHC,SAAkBC,sBAEtBC,QAAS,CACLC,YAAcJ,GACHA,EAAMC,UAAYC,sBAGjCG,UAAW,CACPC,YAAYN,EAAOC,GACXM,iBAAeN,GAoCTO,kBAAgBP,YAClBQ,UAAU,CACVC,MAAO,KACPC,QAAS,kBACTC,QAAS,SAAUC,GACXA,EAAIC,iBACAC,SAAS,CACTC,IAAK,kCA1CbC,IAAI,OAAQhB,WAiBhBiB,WAAW,CACXF,IAAK,gCA8BPf,SAAWA,qBACAA,KAGzBkB,QAAS,CACLC,mBAAkBC,OAACA,UACPC,MAAMC,KACVA,OAAMD,UACElB,wBACJa,IAAI,QAASK,GACT,MAATC,gBAEQ,cAAeD,KAG9BF,eAAeC,OAACA"}