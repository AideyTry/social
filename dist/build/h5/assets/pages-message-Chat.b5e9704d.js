import{al as e,k as s,a5 as t,am as a,a4 as o,r as n,y as r,Q as l,o as c,ai as u,b as i,c as g,d,g as p,H as m,a9 as f,I,V as v,p as h,an as D}from"./index.4f21874d.js";import{C}from"./ChatContent.3c28fe0c.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";var S=O({components:{ChatContent:C},onShow:function(e){this.currentDate=new Date+Math.random(),setTimeout((()=>{this.getConver()}),1e3)},onLoad:function(e){this.propsOptions=e},onNavigationBarButtonTap(n){console.log("button ... e=================",n);const r=this.operations,l=this.propsOptions;e({itemList:r,success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮"),e.tapIndex+1===1?(console.log("propsOptions.value.userID=====",l.userID),s({url:`/pages/message/Inform?account=${l.userID}`})):t({title:"屏蔽用户",content:"屏蔽后，您将不再收到对方的消息",success:function(e){if(console.log("res=============",e),e.confirm){console.log("用户点击确定"),console.log("propsOptions.conversationID===",l.conversationID);const e={shieldedParty:l.userID};a(e).then((e=>{200===e.data.code&&o({title:e.data.msg,duration:2e3})}))}else e.cancel&&console.log("用户点击取消")}})},fail:function(e){console.log(e.errMsg)}})},setup(e){let s=n(null),t=n("");const a=n([]);let i=n(["举报","屏蔽"]);const g=n(!1),d=m();console.log("store.state.user===========================================================================",d.getters["user/getUserInfo"]),r((()=>d.getters["user/getUserInfo"])).value;const p=()=>{const e={groupID:"",startClientMsgID:"",count:1e4,userID:s.value.userID};f.getHistoryMessageList(e).then((({data:e})=>{console.log("历史数据=",JSON.parse(e)),a.value=[...JSON.parse(e).reverse()]})).catch((e=>{console.log("err 000000000000000000000000000000000000000000=",e)}))};l((()=>a),((e,t)=>{const a=e.value.filter((e=>e.sendID===s.value.userID)).map((e=>e.clientMsgID)),o={userID:s.value.userID,msgIDList:a};f.markC2CMessageAsRead(o).then((({data:e})=>{console.log("传入已读=",e),f.markC2CMessageAsRead({userID:s.value.userID,msgIDList:[]})})).catch((e=>{console.log("err===",e)}))}),{deep:!0}),c((()=>{u({title:s.value.title}),p(),f.on("OnRecvNewMessage",(e=>{const s=JSON.parse(e.data);101===s.contentType&&a.value.unshift(s)})),f.on("OnRecvC2CReadReceipt",(e=>{JSON.parse(e.data).map((e=>{e.msgIDList.map((e=>{a.value.find((s=>{s.clientMsgID===e&&(s.isRead=!0)}))}))}))}))}));let I=n("");return{inputString:t,messageInfo:a,onConfirm:async e=>{if(await(async e=>{const s={shielding_party:e};return console.log("params=============",s),await D(s).then((e=>(console.log("data============",e),200===e.data.code&&1===e.data.flag?g.value=!0:g.value=!1,g.value)))})(s.value.userID))return void o({title:"对不起，该用户已屏蔽了您，您不能给该用户发送信息",duration:3e3});const{value:n}=e.detail;t.value=n;const r={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};f.createTextMessage(n).then((e=>{const o={recvID:s.value.userID,groupID:"",offlinePushInfo:r,message:e.data};f.sendMessage(o).then((({data:e,errCode:s})=>{const o=JSON.parse(e);a.value.unshift(o),t.value=""})).catch((e=>{console.log("err=",e)}))})).catch((e=>{console.log("text err=",e)}))},currentDate:I,getConver:p,propsOptions:s,operations:i}}},[["render",function(e,s,t,a,o,n){const r=I("ChatContent"),l=v,c=h;return i(),g(c,{class:"chat-wraper"},{default:d((()=>[(i(),g(r,{key:a.currentDate,msgList:a.messageInfo},null,8,["msgList"])),p(c,{class:"send-msg"},{default:d((()=>[p(l,{type:"text",placeholder:"请输入消息",modelValue:a.inputString,"onUpdate:modelValue":s[0]||(s[0]=e=>a.inputString=e),class:"send",onConfirm:a.onConfirm},null,8,["modelValue","onConfirm"])])),_:1})])),_:1})}],["__scopeId","data-v-61ad0e0e"]]);export{S as default};
//# sourceMappingURL=pages-message-Chat.b5e9704d.js.map
