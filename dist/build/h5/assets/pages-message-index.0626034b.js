import{x as e,r as a,o as s,a5 as t,b as o,c as l,d as n,e as r,f as c,F as u,g as d,i as g,h as i,G as f,P as m,a6 as p,D as h,E as _,m as v,t as C,l as w,p as D}from"./index.5db6d7a1.js";import{C as I}from"./ChatContent.941760cd.js";import{_ as N}from"./plugin-vue_export-helper.21dcd24c.js";var b=N({components:{ChatContent:I},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const o=f(),l=e((()=>o.state.user.userInfo)).value,n=a([]),r=()=>{p.getAllConversationList().then((({data:e})=>{console.log("会话总数data====",JSON.parse(e)),n.value=JSON.parse(e),c()})).catch((e=>{console.log("err=",e)}))},c=()=>{p.getTotalUnreadMsgCount().then((({data:e})=>{console.log("data===",e),console.log("Number(data)=",Number(e)),Number(e)>0?h({index:2,text:"···"}):_({index:2})})).catch((e=>{console.log("err=",e)}))};return s((()=>{((e,a)=>{console.log("userID, token=====================",e,a);const s={userID:e,token:a,url:"wss://mancao.social:20038",platformID:5};p.login(s).then((e=>{console.log("login suc...",e),0===e.errCode&&r()})).catch((e=>{console.log("login failed...",e)}))})(l.phone,t()),p.on("OnRecvNewMessage",(e=>{101===JSON.parse(e.data).contentType&&r()}))})),{defaultAvatar:"/static/images/default_avatar.png",convers:n,goChat:e=>{console.log("item=",e),m({url:`/pages/message/Chat?userID=${e.userID}&title=${e.showName}&conversationID=${e.conversationID}`})},showLastMessage:e=>JSON.parse(e).content,getAllConversationList:r}}},[["render",function(e,a,s,t,f,m){const p=w,h=D,_=v;return o(),l(_,{class:"message-wrapper"},{default:n((()=>[(o(!0),r(u,null,c(t.convers,(a=>(o(),l(_,{key:a.userID,class:"conver",onClick:e=>t.goChat(a)},{default:n((()=>[d(_,{class:"conver-msg"},{default:n((()=>[d(_,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[d(p,{src:a.faceURL&&a.faceURL.includes("https://")?a.faceURL:t.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),a.unreadCount?(o(),l(_,{key:0,class:"unread-total"},{default:n((()=>[d(h,null,{default:n((()=>[g(C(a.unreadCount),1)])),_:2},1024)])),_:2},1024)):i("v-if",!0)])),_:2},1024),d(_,{class:"content-wraper"},{default:n((()=>[d(h,null,{default:n((()=>[g(C(a.showName),1)])),_:2},1024),d(h,null,{default:n((()=>[g(C(t.showLastMessage(a.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(h,{class:"conver-time"},{default:n((()=>[g(C(e.$filters.formatMsgDate(a.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),t.convers.length<=0?(o(),l(_,{key:0,class:"empty"},{default:n((()=>[d(_,null,{default:n((()=>[g("您还未发起聊天")])),_:1}),d(_,{class:"empty-content"},{default:n((()=>[g("可以去关注兴趣爱好发布者，然后到“我的”模块中点击关注，进入关注的用户或者粉丝一起聊天吧~！")])),_:1})])),_:1})):i("v-if",!0)])),_:1})}],["__scopeId","data-v-7e62848b"]]);export{b as default};
//# sourceMappingURL=pages-message-index.0626034b.js.map
