{"version":3,"file":"pages-user-info-User.8180f1dc.js","sources":["../../../../src/pages/user/info/User.vue"],"sourcesContent":["<template>\r\n  <view class=\"userinfo-wraper\">\r\n    <view class=\"userinfo\">\r\n      <image mode=\"aspectFill\" :src=\"userInfo.avatar\" class=\"avatar\"></image>\r\n      <view class=\"basic-info\">\r\n        <PickerRegion\r\n          isDisabled\r\n          :propsProvinceCode=\"\r\n            userInfo.location && userInfo.location.provinceCode\r\n          \"\r\n          :propsCityCode=\"userInfo.location && userInfo.location.cityCode\"\r\n          :key=\"userInfo.location && userInfo.location.cityCode\"\r\n        />/{{ $filters.filterGender(userInfo.gender) || \"暂无\" }}/<text\r\n          v-if=\"age || age === 0\"\r\n          >{{ age }}岁</text\r\n        >\r\n        <text v-if=\"!age && age !== 0\">暂无</text>\r\n        <!-- <uni-tag\r\n          v-if=\"!age && age !== 0\"\r\n          disabled\r\n          inverted\r\n          text=\"暂无\"\r\n        ></uni-tag> -->\r\n      </view>\r\n    </view>\r\n    <view class=\"photos\">\r\n      <view\r\n        class=\"photo-wraper\"\r\n        @click=\"onPreviewImage(item, index)\"\r\n        v-for=\"(item, index) in userInfo.photos\"\r\n        :key=\"index\"\r\n      >\r\n        <image mode=\"aspectFill\" :src=\"item\" class=\"photo\"></image>\r\n      </view>\r\n    </view>\r\n    <uni-forms>\r\n      <uni-forms-item label=\"签名\">\r\n        <view>{{ userInfo.motto || \"暂未填写\" }}</view>\r\n      </uni-forms-item>\r\n      <uni-forms-item label=\"家乡\">\r\n        <PickerRegion\r\n          isDisabled\r\n          :propsProvinceCode=\"\r\n            userInfo.hometown && userInfo.hometown.provinceCode\r\n          \"\r\n          :propsCityCode=\"userInfo.hometown && userInfo.hometown.cityCode\"\r\n          :key=\"userInfo.hometown && userInfo.hometown.provinceCode\"\r\n        />\r\n      </uni-forms-item>\r\n      <uni-forms-item label=\"学校\">\r\n        <view>{{ userInfo.schoolName || \"暂未填写\" }}</view>\r\n      </uni-forms-item>\r\n      <uni-forms-item label=\"职业\">\r\n        <view>{{ userInfo.job || \"暂未填写\" }}</view>\r\n      </uni-forms-item>\r\n    </uni-forms>\r\n  </view>\r\n  <view class=\"send-msg\">\r\n    <view class=\"chat\">\r\n      <svg class=\"chat-icon\" aria-hidden=\"true\" @click.stop=\"goChat\">\r\n        <use xlink:href=\"#icon-faxinxi\"></use>\r\n      </svg>\r\n      <text>私聊</text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  onBackPress(options) {\r\n    console.log(\"options=\", options);\r\n  },\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed } from \"vue\";\r\nimport moment from \"moment\";\r\nimport PickerRegion from \"./PickerRegion.vue\";\r\nimport openIM from \"@/utils/openIM.js\";\r\nimport { getFrendInfo } from \"@/api/user.js\";\r\nimport { getIMToken } from \"@/utils/auth.js\";\r\nimport { useStore } from \"vuex\";\r\n\r\nconst props = defineProps({\r\n  id: {\r\n    type: String,\r\n    default: \"\",\r\n  },\r\n});\r\n\r\nlet userInfo = ref({});\r\n\r\nconst age = ref(moment().diff(userInfo.birthday, \"years\"));\r\n\r\n\r\n    const store = useStore();\r\n    const getUserInfo = computed(() => store.state.user.userInfo).value;\r\n\r\n// 获取好友信息\r\nconst getFrend = () => {\r\n  const params = {\r\n    userId: props.id,\r\n  };\r\n  getFrendInfo(params).then((res) => {\r\n    console.log(\"好友=\", res);\r\n    if (res.data.code === 200) {\r\n      userInfo.value = res.data.data;\r\n      console.log(\"userInfo.value=======\", userInfo.value);\r\n    }\r\n  });\r\n};\r\n\r\n// 预览图片\r\nconst onPreviewImage = (item, index) => {\r\n  uni.previewImage({\r\n    current: index,\r\n    urls: userInfo.value.photos,\r\n  });\r\n};\r\n\r\n// 聊天\r\nconst goChat = () => {\r\n  const token = getIMToken();\r\n  console.log('token===', token)\r\n  console.log('userInfo.value.phone===', userInfo.value.phone)\r\n    uni.navigateTo({\r\n    url: `/pages/message/Chat?userID=${userInfo.value.phone}&title=${userInfo.value.username}`,\r\n  });\r\n  return\r\n  const config = {\r\n    userID: getUserInfo.phone,\r\n    token,\r\n    url: \"wss://mancao.social:20038\",\r\n    platformID: 5,\r\n  };\r\n  openIM\r\n    .login(config)\r\n    .then((res) => {\r\n      console.log(\"login suc...\", res);\r\n      if (res.errCode === 0) {\r\n        uni.navigateTo({\r\n          url: `/pages/message/Chat?userID=${userInfo.value.phone}&title=${userInfo.value.username}`,\r\n        });\r\n      }\r\n    })\r\n    .catch((err) => {\r\n      console.log(\"login failed...\", err);\r\n    });\r\n};\r\n\r\nonMounted(() => {\r\n  console.log(\"props===\", props);\r\n  getFrend();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.userinfo-wraper {\r\n  padding: 40rpx;\r\n}\r\n.userinfo {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.avatar {\r\n  width: 150rpx;\r\n  height: 150rpx;\r\n  border-radius: 50%;\r\n}\r\n.photos {\r\n  display: flex;\r\n  .photo-wraper {\r\n    position: relative;\r\n    margin-right: 20rpx;\r\n    .photo {\r\n      width: 100rpx;\r\n      height: 100rpx;\r\n      border-radius: 20%;\r\n    }\r\n    .photo-add {\r\n      position: absolute;\r\n      left: 50%;\r\n      top: 50%;\r\n      transform: translateY(-50%);\r\n      font-size: 12rpx;\r\n    }\r\n  }\r\n}\r\n.basic-info {\r\n  display: flex;\r\n}\r\n.send-msg {\r\n  position: fixed;\r\n  bottom: 0;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 10rpx 0;\r\n  width: 100%;\r\n  background-color: #eaeaea;\r\n  .chat {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n  .chat-icon {\r\n    width: 1.5em;\r\n    height: 1.5em;\r\n    vertical-align: -0.15em;\r\n    fill: currentColor;\r\n    overflow: hidden;\r\n  }\r\n}\r\n</style>\r\n"],"names":["onBackPress","options","log","userInfo","ref","age","moment","diff","birthday","store","useStore","state","user","value","goChat","token","getIMToken","phone","url","username","props","params","userId","id","then","res","data","code","item","index","current","urls","photos"],"mappings":"qcAoEA,QAAe,CACbA,YAAYC,WACFC,IAAI,WAAYD,yFAqBxBE,EAAWC,EAAI,UAEbC,EAAMD,EAAIE,IAASC,KAAKJ,EAASK,SAAU,UAGvCC,EAAQC,OACe,IAAMD,EAAME,MAAMC,KAAKT,WAAUU,YAyB5DC,EAAS,WACPC,EAAQC,YACNd,IAAI,WAAYa,WAChBb,IAAI,0BAA2BC,EAASU,MAAMI,SACrC,CACfC,IAAK,8BAA8Bf,EAASU,MAAMI,eAAed,EAASU,MAAMM,wBAwB1E,aACAjB,IAAI,WAAYkB,GApDT,YACTC,EAAS,CACbC,OAAQF,EAAMG,MAEHF,GAAQG,MAAMC,YACjBvB,IAAI,MAAOuB,GACG,MAAlBA,EAAIC,KAAKC,SACFd,MAAQY,EAAIC,KAAKA,aAClBxB,IAAI,wBAAyBC,EAASU,uiCAM7B,EAACe,EAAMC,OACX,CACfC,QAASD,EACTE,KAAM5B,EAASU,MAAMmB"}