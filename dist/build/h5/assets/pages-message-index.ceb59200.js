import{a0 as a,U as e,A as s,B as t,o,c as l,w as n,E as r,F as c,N as u,O as d,_ as g,$ as i,Q as f,e as m,K as h,L as p,J as _,P as v,R as C}from"./vendor.ae4da609.js";import{c as w,o as N}from"./index.990a2432.js";import{C as L}from"./ChatContent.f6dcb750.js";import{_ as I}from"./plugin-vue_export-helper.21dcd24c.js";var D=I({components:{ChatContent:L},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const o=a(),l=e((()=>o.state.user.userInfo)).value,n=s([]),r=()=>{N.getAllConversationList().then((({data:a})=>{console.log("会话总数data====",JSON.parse(a)),n.value=JSON.parse(a),c()})).catch((a=>{console.log("err=",a)}))},c=()=>{N.getTotalUnreadMsgCount().then((({data:a})=>{console.log("data===",a),console.log("Number(data)=",Number(a)),Number(a)>0?g({index:2,text:"···"}):i({index:2})})).catch((a=>{console.log("err=",a)}))};return t((()=>{((a,e)=>{console.log("userID, token=====================",a,e);const s={userID:a,token:e,url:"wss://mancao.social:20038",platformID:5};N.login(s).then((a=>{console.log("login suc...",a),0===a.errCode&&r()})).catch((a=>{console.log("login failed...",a)}))})(l.phone,w()),N.on("OnRecvNewMessage",(a=>{101===JSON.parse(a.data).contentType&&r()}))})),{defaultAvatar:"/static/images/default_avatar.png",convers:n,goChat:a=>{console.log("item=",a),d({url:`/pages/message/Chat?userID=${a.userID}&title=${a.showName}`})},showLastMessage:a=>JSON.parse(a).content,getAllConversationList:r}}},[["render",function(a,e,s,t,d,g){const i=v,w=C,N=f;return o(),l(N,null,{default:n((()=>[(o(!0),r(u,null,c(t.convers,(e=>(o(),l(N,{key:e.userID,class:"conver",onClick:a=>t.goChat(e)},{default:n((()=>[m(N,{class:"conver-msg"},{default:n((()=>[m(N,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[m(i,{src:e.faceURL&&e.faceURL.includes("https://")?e.faceURL:t.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),e.unreadCount?(o(),l(N,{key:0,class:"unread-total"},{default:n((()=>[m(w,null,{default:n((()=>[h(p(e.unreadCount),1)])),_:2},1024)])),_:2},1024)):_("v-if",!0)])),_:2},1024),m(N,{class:"content-wraper"},{default:n((()=>[m(w,null,{default:n((()=>[h(p(e.showName),1)])),_:2},1024),m(w,null,{default:n((()=>[h(p(t.showLastMessage(e.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(w,{class:"conver-time"},{default:n((()=>[h(p(a.$filters.formatMsgDate(e.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-64a59283"]]);export{D as default};
//# sourceMappingURL=pages-message-index.ceb59200.js.map
