import{r as e,l as s,W as t,o as a,Q as n,c as o,d as r,e as l,f as u,E as c,ab as i,b as d,U as g,x as m}from"./index.caabeb3a.js";import{C as p}from"./ChatContent.d2d8dfd6.js";import{_ as f}from"./plugin-vue_export-helper.21dcd24c.js";var I=f({components:{ChatContent:p},onShow:function(e){this.currentDate=new Date+Math.random(),setTimeout((()=>{this.getConver()}),1e3)},setup(o){let r=e("");const l=e([]),u=c();console.log("store.state.user===========================================================================",u.getters["user/getUserInfo"]),s((()=>u.getters["user/getUserInfo"])).value;const d=()=>{const e={groupID:"",startClientMsgID:"",count:1e4,userID:o.userID};i.getHistoryMessageList(e).then((({data:e})=>{console.log("历史数据=",JSON.parse(e)),l.value=[...JSON.parse(e).reverse()]})).catch((e=>{console.log("err 000000000000000000000000000000000000000000=",e)}))};t((()=>l),((e,s)=>{const t=e.value.filter((e=>e.sendID===o.userID)).map((e=>e.clientMsgID)),a={userID:o.userID,msgIDList:t};i.markC2CMessageAsRead(a).then((({data:e})=>{console.log("传入已读=",e),i.markC2CMessageAsRead({userID:o.userID,msgIDList:[]})})).catch((e=>{console.log("err===",e)}))}),{deep:!0}),a((()=>{n({title:o.title}),d(),i.on("OnRecvNewMessage",(e=>{const s=JSON.parse(e.data);101===s.contentType&&l.value.unshift(s)})),i.on("OnRecvC2CReadReceipt",(e=>{JSON.parse(e.data).map((e=>{e.msgIDList.map((e=>{l.value.find((s=>{s.clientMsgID===e&&(s.isRead=!0)}))}))}))}))}));let g=e("");return{inputString:r,messageInfo:l,onConfirm:e=>{const{value:s}=e.detail;r.value=s;const t={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};i.createTextMessage(s).then((e=>{const s={recvID:o.userID,groupID:"",offlinePushInfo:t,message:e.data};i.sendMessage(s).then((({data:e,errCode:s})=>{const t=JSON.parse(e);l.value.unshift(t),r.value=""})).catch((e=>{console.log("err=",e)}))})).catch((e=>{console.log("text err=",e)}))},currentDate:g,getConver:d}}},[["render",function(e,s,t,a,n,c){const i=d("ChatContent"),p=g,f=m;return o(),r(f,{class:"chat-wraper"},{default:l((()=>[(o(),r(i,{key:a.currentDate,msgList:a.messageInfo},null,8,["msgList"])),u(f,{class:"send-msg"},{default:l((()=>[u(p,{type:"text",placeholder:"请输入消息",modelValue:a.inputString,"onUpdate:modelValue":s[0]||(s[0]=e=>a.inputString=e),class:"send",onConfirm:a.onConfirm},null,8,["modelValue","onConfirm"])])),_:1})])),_:1})}],["__scopeId","data-v-62f0652a"]]);export{I as default};
//# sourceMappingURL=pages-message-Chat.84604d55.js.map
