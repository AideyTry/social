{"version":3,"file":"pages-user-info-index.2865f402.js","sources":["../../../../src/pages/user/info/index.vue"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-22 16:09:06\r\n * @LastEditTime: 2022-01-09 20:14:45\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"userinfo-wraper\">\r\n    <view class=\"userinfo\">\r\n      <image\r\n        mode=\"aspectFill\"\r\n        :src=\"avatar ? avatar : defaultAvatar\"\r\n        class=\"avatar\"\r\n      ></image>\r\n      <view class=\"basic-info\">\r\n        <PickerRegion\r\n          isDisabled\r\n          :propsProvinceCode=\"\r\n            userInfo.location && userInfo.location.provinceCode\r\n          \"\r\n          :propsCityCode=\"userInfo.location && userInfo.location.cityCode\"\r\n        />/{{ $filters.filterGender(userInfo.gender) || \"暂无\" }}/<text\r\n          v-if=\"age || age === 0\"\r\n          >{{ age }}岁</text\r\n        >\r\n        <text v-if=\"!age && age !== 0\">暂无</text>\r\n        <!-- <uni-tag\r\n          v-if=\"!age && age !== 0\"\r\n          disabled\r\n          inverted\r\n          text=\"暂无\"\r\n        ></uni-tag> -->\r\n      </view>\r\n    </view>\r\n    <view class=\"photos\">\r\n      <view\r\n        class=\"photo-wraper\"\r\n        @click=\"onUpload(item, index)\"\r\n        v-for=\"(item, index) in images\"\r\n        :key=\"index\"\r\n      >\r\n        <image\r\n          mode=\"aspectFill\"\r\n          :src=\"item ? item : defaultAvatar\"\r\n          class=\"photo\"\r\n        ></image>\r\n        <text\r\n          class=\"photo-add\"\r\n          v-if=\"(!item && images[index - 1]) || (index === 0 && !images[0])\"\r\n          >+</text\r\n        >\r\n      </view>\r\n    </view>\r\n    <uni-forms>\r\n      <uni-forms-item label=\"家乡\">\r\n        <PickerRegion\r\n          isDisabled\r\n          :propsProvinceCode=\"\r\n            userInfo.hometown && userInfo.hometown.provinceCode\r\n          \"\r\n          :propsCityCode=\"userInfo.hometown && userInfo.hometown.cityCode\"\r\n        />\r\n      </uni-forms-item>\r\n      <uni-forms-item label=\"学校\">\r\n        <view>{{ userInfo.schoolName || '暂未填写'}}</view>\r\n      </uni-forms-item>\r\n      <uni-forms-item label=\"职业\">\r\n        <view>{{ userInfo.job || '暂未填写'}}</view>\r\n      </uni-forms-item>\r\n    </uni-forms>\r\n    <button @click=\"inEditor\">编辑资料</button>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  onBackPress(options) {\r\n    if (options.from === \"navigateBack\") {\r\n      return false;\r\n    }\r\n    uni.switchTab({\r\n      url: \"/pages/user/index\",\r\n    });\r\n    return true;\r\n  },\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { computed, ref, reactive } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport moment from \"moment\";\r\nconst defaultAvatar = \"/static/images/default_avatar.png\";\r\nimport PickerRegion from \"./PickerRegion.vue\";\r\n\r\nconst store = useStore();\r\nlet userInfo = computed(() => store.state.user.userInfo).value;\r\n\r\nlet images = reactive(userInfo.photos);\r\n\r\nconsole.log(\"images===\", images);\r\n\r\nconst avatar = ref(userInfo.avatar);\r\n\r\nconst age = ref(moment().diff(userInfo.birthday, \"years\"));\r\n\r\n/**\r\n * @description: 提交图片\r\n * @param {*}\r\n * @Author:\r\n * @return {*}\r\n */\r\nconst onUploadFile = (filePath) => {\r\n  uni.uploadFile({\r\n    url: \"http://127.0.0.1:3000/users/uploadFile\",\r\n    filePath,\r\n    name: \"file\",\r\n    formData: {\r\n      user: \"test\",\r\n    },\r\n    success: (uploadFileRes) => {\r\n      console.log(\"uploadFileRes===\", uploadFileRes);\r\n    },\r\n  });\r\n};\r\n\r\n/**\r\n * @description: 头像上传\r\n * @param {*}\r\n * @Author:\r\n * @return {*}\r\n */\r\nconst onUpload = (item, index) => {\r\n  console.log(\"item, index===\", item, index);\r\n  if (item) {\r\n    uni.previewImage({\r\n      urls: images,\r\n      longPressActions: {\r\n        itemList: [\"发送给朋友\", \"保存图片\", \"收藏\"],\r\n        success: function (data) {\r\n          console.log(\r\n            \"选中了第\" +\r\n              (data.tapIndex + 1) +\r\n              \"个按钮,第\" +\r\n              (data.index + 1) +\r\n              \"张图片\"\r\n          );\r\n        },\r\n        fail: function (err) {\r\n          console.log(err.errMsg);\r\n        },\r\n      },\r\n    });\r\n    return;\r\n  }\r\n  uni.navigateTo({\r\n    url: \"/pages/user/info/Editor\",\r\n  });\r\n\r\n  const getDate = (type) => {\r\n    const date = new Date();\r\n    let year = date.getFullYear();\r\n    let month = date.getMonth() + 1;\r\n    let day = date.getDate();\r\n\r\n    if (type === \"start\") {\r\n      year = year - 60;\r\n    } else if (type === \"end\") {\r\n      year = year + 2;\r\n    }\r\n    month = month > 9 ? month : \"0\" + month;\r\n    day = day > 9 ? day : \"0\" + day;\r\n    return `${year}-${month}-${day}`;\r\n  };\r\n\r\n  const currentDate = getDate({\r\n    format: true,\r\n  });\r\n\r\n  // uni.chooseImage({\r\n  //   success: (chooseImageRes) => {\r\n  //     console.log(\"chooseImageRes===\", chooseImageRes);\r\n  //     const { tempFilePaths, tempFiles } = chooseImageRes;\r\n  //     console.log(\"tempFilePaths[0]===\", tempFilePaths[0]);\r\n  //     // onUploadFile(tempFilePaths[0])\r\n  //     images[index] = tempFilePaths[0]\r\n  //     console.log('images===', images)\r\n  //   },\r\n  // });\r\n};\r\n\r\n// 编辑资料\r\nconst inEditor = () => {\r\n  console.log(\"why\");\r\n  uni.navigateTo({\r\n    url: \"/pages/user/info/Editor\",\r\n  });\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.userinfo-wraper {\r\n  padding: 40rpx;\r\n}\r\n.userinfo {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.avatar {\r\n  width: 150rpx;\r\n  height: 150rpx;\r\n  border-radius: 50%;\r\n}\r\n.photos {\r\n  display: flex;\r\n  .photo-wraper {\r\n    position: relative;\r\n    margin-right: 20rpx;\r\n    .photo {\r\n      width: 100rpx;\r\n      height: 100rpx;\r\n      border-radius: 20%;\r\n    }\r\n    .photo-add {\r\n      position: absolute;\r\n      left: 50%;\r\n      top: 50%;\r\n      transform: translateY(-50%);\r\n      font-size: 12rpx;\r\n    }\r\n  }\r\n}\r\n.basic-info {\r\n  display: flex;\r\n}\r\n</style>"],"names":["onBackPress","options","from","url","defaultAvatar","store","useStore","userInfo","computed","state","user","value","images","reactive","photos","log","avatar","ref","age","moment","diff","birthday","inEditor","item","index2","urls","longPressActions","itemList","success","data","tapIndex","index","fail","err","errMsg","type","date","Date","year","getFullYear","month","getMonth","day","getDate","format"],"mappings":"wbA6EA,QAAe,CACbA,YAAYC,GACW,iBAAjBA,EAAQC,SAGE,CACZC,IAAK,uBAEA,4CASLC,EAAgB,oCAGhBC,EAAQC,QACVC,EAAWC,GAAS,IAAMH,EAAMI,MAAMC,KAAKH,WAAUI,MAErDC,EAASC,EAASN,EAASO,gBAEvBC,IAAI,YAAaH,SAEnBI,EAASC,EAAIV,EAASS,QAEtBE,EAAMD,EAAIE,IAASC,KAAKb,EAASc,SAAU,UAwF3CC,EAAW,aACPP,IAAI,SACG,CACbZ,IAAK,igCA/DQ,EAACoB,EAAMC,gBACdT,IAAI,iBAAkBQ,EAAMC,GAChCD,gBACe,CACfE,KAAMb,EACNc,iBAAkB,CAChBC,SAAU,CAAC,QAAS,OAAQ,MAC5BC,QAAS,SAAUC,WACTd,IACN,UACQe,SAAW,GACjB,WACMC,MAAQ,GACd,QAGNC,KAAM,SAAUC,WACNlB,IAAIkB,EAAIC,cAMT,CACb/B,IAAK,4BAGS,CAACgC,UACTC,EAAO,IAAIC,SACbC,EAAOF,EAAKG,cACZC,EAAQJ,EAAKK,WAAa,EAC1BC,EAAMN,EAAKO,UAEF,UAATR,KACY,GACI,QAATA,OACK,KAERK,EAAQ,EAAIA,EAAQ,IAAMA,IAC5BE,EAAM,EAAIA,EAAM,IAAMA,IAIF,CAC1BE,QAAQ"}