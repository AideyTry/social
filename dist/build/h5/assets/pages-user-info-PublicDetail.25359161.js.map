{"version":3,"file":"pages-user-info-PublicDetail.25359161.js","sources":["../../../../src/pages/user/info/PublicDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"hobby-detail\">\r\n    <view class=\"author-wraper\">\r\n      <view class=\"author\">\r\n        <view @click=\"goBack\">返回</view>\r\n        <view class=\"author-info\">\r\n          <image\r\n            class=\"avatar\"\r\n            mode=\"aspectFit\"\r\n            :src=\"hobbyInfo.avatar || ''\"\r\n          ></image>\r\n          <text>{{ hobbyInfo.username || \"\" }}</text>\r\n        </view>\r\n        <view @click=\"onEdit\">\r\n          <text>...</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view class=\"swiper-box\" v-if=\"hobbyInfo.fileType === 0\">\r\n      <swiper class=\"swiper-box\" :indicator-dots=\"hobbyInfo.photos.length > 1\">\r\n        <swiper-item v-for=\"(item, index) in hobbyInfo.photos\" :key=\"index\">\r\n          <view class=\"swiper-item\">\r\n            <image :src=\"item\" class=\"image\" mode=\"aspectFit\"></image>\r\n          </view>\r\n        </swiper-item>\r\n      </swiper>\r\n    </view>\r\n    <view class=\"swiper-box\" v-if=\"hobbyInfo.fileType === 1\">\r\n      <view class=\"swiper-item\">\r\n        <VideoPlayer\r\n          :options=\"{ src: hobbyInfo.video_url, poster: hobbyInfo.url }\"\r\n          :key=\"hobbyInfo.id\"\r\n        ></VideoPlayer>\r\n      </view>\r\n    </view>\r\n    <view class=\"content-wraper\">\r\n      <view class=\"content\">\r\n        <view class=\"title\">\r\n          {{ hobbyInfo.title }}\r\n        </view>\r\n        <view class=\"main\">\r\n          {{ hobbyInfo.content }}\r\n        </view>\r\n        <view class=\"publish-date\"\r\n          ><text>发布于: </text><text>{{ publishDate }}</text></view\r\n        >\r\n      </view>\r\n    </view>\r\n    <view class=\"comment-wraper\">\r\n      <Comment v-if=\"hobbyInfo.id\" :hobbyInfo=\"hobbyInfo\" :key=\"hobbyInfo.id\" />\r\n    </view>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted, computed } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\n\r\nimport { getHobbyDetail } from \"@/api/hobby.js\";\r\nimport { deletePublish } from \"@/api/publish.js\";\r\nimport { setFollow, getFollow, deleteFollow } from \"@/api/communication.js\";\r\nimport Comment from \"@/pages/components/Comment.vue\";\r\nimport VideoPlayer from \"@/pages/components/VideoPlayer.vue\";\r\n\r\nimport { formatDate } from \"@/utils/util.js\";\r\n\r\nexport default {\r\n  components: {\r\n    Comment,\r\n    VideoPlayer,\r\n  },\r\n  onLoad: function(options) {\r\n    console.log(\"options===\", options);\r\n  },\r\n  onReady: function() {},\r\n  setup(props) {\r\n    console.log(\"props=\", props);\r\n    const store = useStore();\r\n    const userInfo = computed(() => store.state.user.userInfo).value;\r\n\r\n    const options = reactive({\r\n      poster: \"\",\r\n      src: \"\", //视频源\r\n    });\r\n\r\n    let info = ref([\r\n      {\r\n        content:\r\n          \"https://social-1308251497.cos.ap-guangzhou.myqcloud.com/images/4.jfif\",\r\n      },\r\n    ]);\r\n    let current = ref(0);\r\n    let mode = ref(\"default\");\r\n\r\n    const change = (e) => {\r\n      current.value = e.detail.current;\r\n    };\r\n\r\n    let hobbyInfo = ref({});\r\n    const initGetHobbyDetail = (obj) => {\r\n      const { id, hobby } = obj;\r\n      const params = { id, hobby };\r\n      getHobbyDetail(params).then((data) => {\r\n        console.log(\"data===\", data);\r\n        if (data.data.code === 200) {\r\n          hobbyInfo.value = data.data.data;\r\n          publishDate.value = formatDate(data.data.data.create_time);\r\n          console.log(\"hobbyInfo.value===\", hobbyInfo.value);\r\n          console.log(\"data.data.data.url===\", data.data.data.url);\r\n          options.poster = data.data.data.url;\r\n          options.src = data.data.data.video_url;\r\n        }\r\n      });\r\n    };\r\n\r\n    // 返回\r\n    const goBack = () => {\r\n      uni.switchTab({\r\n        url: \"/pages/user/index\",\r\n      });\r\n    };\r\n\r\n    // 发布\r\n    let publishDate = ref(null);\r\n\r\n    // 编辑\r\n    let operations = ref([\"编辑\", \"删除\"]);\r\n    let activeOperationIndex = ref(0);\r\n    const onUpdate = (info) => {\r\n      console.log(\"info==\", info);\r\n      uni.navigateTo({\r\n        url: `/pages/user/info/EditDetail?id=${info.id}&hobby=${info.hobby}`,\r\n      });\r\n    };\r\n    const onDelete = (info) => {\r\n      console.log(\"info==\", info);\r\n      uni.showModal({\r\n        title: \"删除\",\r\n        content: \"确定删除？\",\r\n        success: function(res) {\r\n          if (res.confirm) {\r\n            const params = {\r\n              hobby: props.hobby,\r\n              id: props.id,\r\n            };\r\n            deletePublish(params).then((data) => {\r\n              if (data.data.code === 200) {\r\n                uni.showToast({\r\n                  title: \"删除成功\",\r\n                  duration: 2000,\r\n                });\r\n                uni.switchTab({\r\n                  url: \"/pages/user/index\",\r\n                  success() {\r\n                    let page = getCurrentPages().pop(); //跳转页面成功之后\r\n                    console.log(\"page==============\", page);\r\n                    if (!page) return;\r\n                    page.onLoad(); //如果页面存在，则重新刷新页面\r\n                  },\r\n                });\r\n              }\r\n            });\r\n          } else if (res.cancel) {\r\n          }\r\n        },\r\n      });\r\n    };\r\n    const onEdit = (e) => {\r\n      uni.showActionSheet({\r\n        itemList: operations,\r\n        success: function(res) {\r\n          console.log(\"选中了第\" + (res.tapIndex + 1) + \"个按钮\");\r\n          activeOperationIndex.value = res.tapIndex;\r\n          if (activeOperationIndex.value === 1) {\r\n            onDelete(props);\r\n          } else {\r\n            onUpdate(props);\r\n          }\r\n        },\r\n        fail: function(res) {\r\n          console.log(res.errMsg);\r\n        },\r\n      });\r\n      // console.log(\"value=\", value);\r\n      // activeOperationIndex.value = value;\r\n      // if (activeOperationIndex.value === 1) {\r\n      //   onDelete(props);\r\n      // } else {\r\n      //   onUpdate(props);\r\n      // }\r\n    };\r\n\r\n    onMounted(() => {\r\n      console.log(\"userInfo===\", userInfo);\r\n      initGetHobbyDetail({ id: props.id, hobby: props.hobby });\r\n    });\r\n    return {\r\n      hobbyInfo,\r\n      info,\r\n      publishDate,\r\n      options,\r\n      goBack,\r\n      onEdit,\r\n      operations,\r\n      activeOperationIndex,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.hobby-detail {\r\n}\r\n.swiper-box {\r\n  width: 100%;\r\n  height: 554rpx;\r\n  .swiper-item {\r\n    width: 100%;\r\n    height: 100%;\r\n    .image {\r\n      width: inherit;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n\r\n.author-wraper {\r\n  margin-top: 32rpx;\r\n  padding: 0 32rpx;\r\n}\r\n.author {\r\n  padding-bottom: 32rpx;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  border-bottom: 1px solid #e6e6e6;\r\n  .author-info {\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n  .avatar {\r\n    width: 52rpx;\r\n    height: 52rpx;\r\n    border-radius: 50%;\r\n    background-color: #ccc;\r\n    margin-right: 20rpx;\r\n  }\r\n}\r\n.content-wraper {\r\n  margin-top: 32rpx;\r\n  padding: 0 32rpx;\r\n  .content {\r\n    padding-bottom: 32rpx;\r\n    border-bottom: 1px solid #e6e6e6;\r\n    .title {\r\n      font-size: 32rpx;\r\n      font-weight: 700;\r\n    }\r\n    .main {\r\n      margin-top: 20rpx;\r\n      color: #555;\r\n      letter-spacing: 6rpx;\r\n      text-indent: 2em;\r\n    }\r\n    .publish-date {\r\n      margin-top: 20rpx;\r\n      color: #999;\r\n      font-size: 24rpx;\r\n    }\r\n  }\r\n}\r\n.comment-wraper {\r\n  margin-top: 32rpx;\r\n  padding: 0 32rpx;\r\n}\r\n</style>\r\n"],"names":["components","Comment","VideoPlayer","onLoad","options","log","onReady","setup","props","store","useStore","userInfo","computed","state","user","value","reactive","poster","src","info","ref","content","hobbyInfo","publishDate","operations","activeOperationIndex","obj","id","hobby","then","data","code","formatDate","create_time","url","video_url","goBack","onEdit","e","itemList","success","res","info2","tapIndex","title","confirm","params","duration","page","getCurrentPages","pop","cancel","fail","errMsg","class","mode","key","$setup","item"],"mappings":"8hBAmEEA,WAAY,CACVC,QAAAA,EACAC,YAAAA,GAEFC,OAAQ,SAASC,WACPC,IAAI,aAAcD,IAE5BE,QAAS,aACTC,MAAMC,WACIH,IAAI,SAAUG,SAChBC,EAAQC,IACRC,EAAWC,GAAS,IAAMH,EAAMI,MAAMC,KAAKH,WAAUI,MAErDX,EAAUY,EAAS,CACvBC,OAAQ,GACRC,IAAK,SAGHC,EAAOC,EAAI,CACb,CACEC,QACE,6EAGY,KACH,eAMXC,EAAYF,EAAI,QAyBhBG,EAAcH,EAAI,MAGlBI,EAAaJ,EAAI,CAAC,KAAM,OACxBK,EAAuBL,EAAI,aAiErB,aACAf,IAAI,cAAeM,GA9FF,CAACe,UACpBC,GAAEA,QAAIC,GAAUF,IACP,CAAEC,GAAAA,EAAIC,MAAAA,IACEC,MAAMC,YACnBzB,IAAI,UAAWyB,GACA,MAAnBA,EAAKA,KAAKC,SACFhB,MAAQe,EAAKA,KAAKA,OAChBf,MAAQiB,EAAWF,EAAKA,KAAKA,KAAKG,qBACtC5B,IAAI,qBAAsBiB,EAAUP,eACpCV,IAAI,wBAAyByB,EAAKA,KAAKA,KAAKI,OAC5CjB,OAASa,EAAKA,KAAKA,KAAKI,MACxBhB,IAAMY,EAAKA,KAAKA,KAAKK,gBAoFd,CAAER,GAAInB,EAAMmB,GAAIC,MAAOpB,EAAMoB,WAE3C,CACLN,UAAAA,EACAH,KAAAA,EACAI,YAAAA,EACAnB,QAAAA,EACAgC,OArFa,OACC,CACZF,IAAK,uBAoFPG,OAnCcC,MACM,CAClBC,SAAUf,EACVgB,QAAS,SAASC,GApCL,IAACC,UAqCJrC,IAAI,UAAcsC,SAAW,GAAK,SACrB5B,MAAQ0B,EAAIE,SACE,IAA/BlB,EAAqBV,OAvCb2B,EAwCDlC,UAvCPH,IAAI,SAAUqC,KACR,CACZE,MAAO,KACPvB,QAAS,QACTmB,QAAS,SAASC,MACZA,EAAII,QAAS,OACTC,EAAS,CACblB,MAAOpB,EAAMoB,MACbD,GAAInB,EAAMmB,MAEEmB,GAAQjB,MAAMC,IACH,MAAnBA,EAAKA,KAAKC,SACE,CACZa,MAAO,OACPG,SAAU,QAEE,CACZb,IAAK,oBACLM,cACMQ,EAAOC,IAAkBC,cACrB7C,IAAI,qBAAsB2C,GAC7BA,KACA7C,qBAKJsC,EAAIU,WAlCJ,CAACT,YACRrC,IAAI,SAAUqC,KACP,CACbR,IAAK,kCAAkCQ,EAAKf,YAAYe,EAAKd,YA6ChDpB,IAGb4C,KAAM,SAASX,WACLpC,IAAIoC,EAAIY,YAuBpB7B,WAAAA,EACAC,qBAAAA,uVApMM6B,eACCC,2MAKM,+FAITC,IAAK,4CACmBF,oGACmCG,6GAEtCvC,IAAKwC,EAASJ,6KAKnCE,IAAK,4FAIJpD,iIAID,8dAciDkB"}