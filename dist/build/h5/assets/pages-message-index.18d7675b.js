import{a0 as e,U as a,A as s,B as t,o,c as l,w as n,E as r,F as c,N as u,O as d,_ as g,$ as i,Q as f,e as m,K as h,L as p,J as _,P as v,R as C}from"./vendor.ae4da609.js";import{c as w,o as N}from"./index.4fc2b9ce.js";import{C as L}from"./ChatContent.f6dcb750.js";import{_ as I}from"./plugin-vue_export-helper.21dcd24c.js";var b=I({components:{ChatContent:L},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const o=e(),l=a((()=>o.state.user.userInfo)).value,n=s([]),r=()=>{N.getAllConversationList().then((({data:e})=>{console.log("会话总数data====",JSON.parse(e)),n.value=JSON.parse(e),c()})).catch((e=>{console.log("err=",e)}))},c=()=>{N.getTotalUnreadMsgCount().then((({data:e})=>{console.log("data===",e),console.log("Number(data)=",Number(e)),Number(e)>0?g({index:2,text:"···"}):i({index:2})})).catch((e=>{console.log("err=",e)}))};return t((()=>{((e,a)=>{console.log("userID, token=====================",e,a);const s={userID:e,token:a,url:"wss://mancao.social:20038",platformID:5};N.login(s).then((e=>{console.log("login suc...",e),0===e.errCode&&r()})).catch((e=>{console.log("login failed...",e)}))})(l.phone,w()),N.on("OnRecvNewMessage",(e=>{101===JSON.parse(e.data).contentType&&r()}))})),{defaultAvatar:"/static/images/default_avatar.png",convers:n,goChat:e=>{console.log("item=",e),d({url:`/pages/message/Chat?userID=${e.userID}&title=${e.showName}`})},showLastMessage:e=>JSON.parse(e).content,getAllConversationList:r}}},[["render",function(e,a,s,t,d,g){const i=v,w=C,N=f;return o(),l(N,null,{default:n((()=>[(o(!0),r(u,null,c(t.convers,(a=>(o(),l(N,{key:a.userID,class:"conver",onClick:e=>t.goChat(a)},{default:n((()=>[m(N,{class:"conver-msg"},{default:n((()=>[m(N,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[m(i,{src:a.faceURL&&a.faceURL.includes("https://")?a.faceURL:t.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),a.unreadCount?(o(),l(N,{key:0,class:"unread-total"},{default:n((()=>[m(w,null,{default:n((()=>[h(p(a.unreadCount),1)])),_:2},1024)])),_:2},1024)):_("v-if",!0)])),_:2},1024),m(N,{class:"content-wraper"},{default:n((()=>[m(w,null,{default:n((()=>[h(p(a.showName),1)])),_:2},1024),m(w,null,{default:n((()=>[h(p(t.showLastMessage(a.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(w,{class:"conver-time"},{default:n((()=>[h(p(e.$filters.formatMsgDate(a.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-64a59283"]]);export{b as default};
//# sourceMappingURL=pages-message-index.18d7675b.js.map
