import{z as e,Z as s,T as o,a8 as a,A as t,a3 as n,_ as r,o as l,c,w as u,e as g,a6 as d,P as i}from"./vendor.ada0ecfb.js";import{o as p}from"./openIM.fd559ab0.js";import{C as m}from"./ChatContent.b6858d8c.js";import{_ as I}from"./plugin-vue_export-helper.21dcd24c.js";var f=I({components:{ChatContent:m},setup(r){let l=e("");const c=e([]),u=s(),g=o((()=>u.state.user.userInfo)).value;return a((()=>c),((e,s)=>{console.log("count, prevCount====",e,s);const o=e.value.filter((e=>e.sendID===r.userID));console.log("selfMessages===",o),console.log("props.userID=========================================",r.userID),console.log("userInfo.phone===",g.phone);const a=o.map((e=>e.clientMsgID));console.log("msgIDList===",a);const t={userID:r.userID,msgIDList:a};p.markC2CMessageAsRead(t).then((({data:e})=>{console.log("传入已读=",e),p.markC2CMessageAsRead({userID:r.userID,msgIDList:[]})})).catch((e=>{console.log("err===",e)}))}),{deep:!0}),t((()=>{n({title:r.title}),(()=>{const e={groupID:"",startClientMsgID:"",count:1e4,userID:r.userID};p.getHistoryMessageList(e).then((({data:e})=>{console.log("历史数据=",JSON.parse(e)),c.value=[...JSON.parse(e).reverse()]})).catch((e=>{}))})(),p.on("OnRecvNewMessage",(e=>{const s=JSON.parse(e.data);101===s.contentType&&c.value.unshift(s)})),p.on("OnRecvC2CReadReceipt",(e=>{JSON.parse(e.data).map((e=>{e.msgIDList.map((e=>{c.value.find((s=>{s.clientMsgID===e&&(s.isRead=!0)}))}))}))}))})),{inputString:l,messageInfo:c,onConfirm:e=>{console.log("event=",e);const{value:s}=e.detail;l.value=s;const o={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};console.log("props.userID=",r.userID),p.createTextMessage(s).then((e=>{console.log("res========",e),console.log("message=",JSON.parse(e.data));const s={recvID:r.userID,groupID:"",offlinePushInfo:o,message:e.data};p.sendMessage(s).then((({data:e,errCode:s})=>{console.log("data, errCode ============================",e,s);const o=JSON.parse(e);c.value.unshift(o),l.value=""})).catch((e=>{console.log("err=",e)}))})).catch((e=>{console.log("text err=",e)}))}}}},[["render",function(e,s,o,a,t,n){const p=r("ChatContent"),m=d,I=i;return l(),c(I,{class:"chat-wraper"},{default:u((()=>[(l(),c(p,{key:a.messageInfo,msgList:a.messageInfo},null,8,["msgList"])),g(I,{class:"send-msg"},{default:u((()=>[g(m,{type:"text",placeholder:"请输入消息",modelValue:a.inputString,"onUpdate:modelValue":s[0]||(s[0]=e=>a.inputString=e),class:"send",onConfirm:a.onConfirm},null,8,["modelValue","onConfirm"])])),_:1})])),_:1})}],["__scopeId","data-v-3666429a"]]);export{f as default};
//# sourceMappingURL=pages-message-Chat.118ef91b.js.map
