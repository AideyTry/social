import{a0 as e,W as a,C as s,D as t,o,c as n,w as l,G as r,H as c,P as u,Q as d,n as g,p as i,S as f,e as m,M as p,N as h,L as _,R as v,T as C}from"./vendor.9ff48645.js";import{g as w,o as N}from"./index.2edda64d.js";import{C as L}from"./ChatContent.68ef7820.js";import{_ as D}from"./plugin-vue_export-helper.21dcd24c.js";var I=D({components:{ChatContent:L},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const o=e(),n=a((()=>o.state.user.userInfo)).value,l=s([]),r=()=>{N.getAllConversationList().then((({data:e})=>{console.log("会话总数data====",JSON.parse(e)),l.value=JSON.parse(e),c()})).catch((e=>{console.log("err=",e)}))},c=()=>{N.getTotalUnreadMsgCount().then((({data:e})=>{console.log("data===",e),console.log("Number(data)=",Number(e)),Number(e)>0?g({index:2,text:"···"}):i({index:2})})).catch((e=>{console.log("err=",e)}))};return t((()=>{((e,a)=>{console.log("userID, token=====================",e,a);const s={userID:e,token:a,url:"wss://mancao.social:20038",platformID:5};N.login(s).then((e=>{console.log("login suc...",e),0===e.errCode&&r()})).catch((e=>{console.log("login failed...",e)}))})(n.phone,w()),N.on("OnRecvNewMessage",(e=>{101===JSON.parse(e.data).contentType&&r()}))})),{defaultAvatar:"/static/images/default_avatar.png",convers:l,goChat:e=>{console.log("item=",e),d({url:`/pages/message/Chat?userID=${e.userID}&title=${e.showName}`})},showLastMessage:e=>JSON.parse(e).content,getAllConversationList:r}}},[["render",function(e,a,s,t,d,g){const i=v,w=C,N=f;return o(),n(N,null,{default:l((()=>[(o(!0),r(u,null,c(t.convers,(a=>(o(),n(N,{key:a.userID,class:"conver",onClick:e=>t.goChat(a)},{default:l((()=>[m(N,{class:"conver-msg"},{default:l((()=>[m(N,{class:"chat_bg_msg_icon-wraper"},{default:l((()=>[m(i,{src:a.faceURL&&a.faceURL.includes("https://")?a.faceURL:t.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),a.unreadCount?(o(),n(N,{key:0,class:"unread-total"},{default:l((()=>[m(w,null,{default:l((()=>[p(h(a.unreadCount),1)])),_:2},1024)])),_:2},1024)):_("v-if",!0)])),_:2},1024),m(N,{class:"content-wraper"},{default:l((()=>[m(w,null,{default:l((()=>[p(h(a.showName),1)])),_:2},1024),m(w,null,{default:l((()=>[p(h(t.showLastMessage(a.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(w,{class:"conver-time"},{default:l((()=>[p(h(e.$filters.formatMsgDate(a.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-64a59283"]]);export{I as default};
//# sourceMappingURL=pages-message-index.edb6867a.js.map
