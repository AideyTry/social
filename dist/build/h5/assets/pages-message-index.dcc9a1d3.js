import{Z as a,T as e,z as s,A as t,o,c as l,w as n,D as r,E as c,M as u,N as d,P as g,e as i,J as f,K as p,I as m,O as _,Q as h}from"./vendor.99a7c6c2.js";import{o as v}from"./openIM.fd559ab0.js";import{g as C}from"./index.b8352297.js";import{C as I}from"./ChatContent.6323ae75.js";import{_ as w}from"./plugin-vue_export-helper.21dcd24c.js";var D=w({components:{ChatContent:I},setup(){const o=a(),l=e((()=>o.state.user.userInfo)).value;let n=s(null);const r=s([]),c=()=>{v.getAllConversationList().then((({data:a})=>{console.log("data====",JSON.parse(a)),r.value=JSON.parse(a),g()})).catch((a=>{console.log("err=",a)}))};let u=s("");const g=()=>{v.getTotalUnreadMsgCount().then((({data:a})=>{console.log("data===",a),u.value=a})).catch((a=>{console.log("err=",a)}))};return t((()=>{((a,e)=>{console.log("userID, token=====================",a,e);const s={userID:a,token:e,url:"wss://mancao.social:20038",platformID:5};v.login(s).then((a=>{console.log("login suc...",a),0===a.errCode&&c(),n.value=a.operationID})).catch((a=>{console.log("login failed...",a)}))})(l.phone,C()),v.on("OnRecvNewMessage",(a=>{101===JSON.parse(a.data).contentType&&c()}))})),{defaultAvatar:"/static/images/default_avatar.png",operationID:n,convers:r,unReadTotal:u,goChat:a=>{console.log("item=",a),d({url:`/pages/message/Chat?userID=${a.userID}&title=${a.showName}`})},showLastMessage:a=>JSON.parse(a).content}}},[["render",function(a,e,s,t,d,v){const C=_,I=h,w=g;return o(),l(w,null,{default:n((()=>[(o(!0),r(u,null,c(t.convers,(e=>(o(),l(w,{key:e.userID,class:"conver",onClick:a=>t.goChat(e)},{default:n((()=>[i(w,{class:"conver-msg"},{default:n((()=>[i(w,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[i(C,{src:e.faceURL&&e.faceURL.includes("https://")?e.faceURL:t.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),t.unReadTotal?(o(),l(w,{key:0,class:"unread-total"},{default:n((()=>[i(I,null,{default:n((()=>[f(p(t.unReadTotal),1)])),_:1})])),_:1})):m("v-if",!0)])),_:2},1024),i(w,{class:"content-wraper"},{default:n((()=>[i(I,null,{default:n((()=>[f(p(e.showName),1)])),_:2},1024),i(I,null,{default:n((()=>[f(p(t.showLastMessage(e.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),i(I,{class:"conver-time"},{default:n((()=>[f(p(a.$filters.commentTime(e.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-67665768"]]);export{D as default};
//# sourceMappingURL=pages-message-index.dcc9a1d3.js.map
