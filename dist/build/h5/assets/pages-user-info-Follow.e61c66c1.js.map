{"version":3,"file":"pages-user-info-Follow.e61c66c1.js","sources":["../../../../src/pages/user/info/Follow.vue"],"sourcesContent":["<template>\r\n  <view class=\"info-list\">\r\n    <view class=\"ul\">\r\n      <view\r\n        class=\"li\"\r\n        v-for=\"item in infoList\"\r\n        :key=\"item.id\"\r\n        @click=\"goUserDetail(item)\"\r\n      >\r\n        <view class=\"userinfo-wraper\">\r\n          <view class=\"avatar-wraper\">\r\n            <image\r\n              class=\"avatar\"\r\n              mode=\"aspectFit\"\r\n              :src=\"item.avatar || ''\"\r\n            ></image>\r\n          </view>\r\n          <view class=\"publish-info\">\r\n            <view class=\"title\">{{ item.title }} </view>\r\n            <view class=\"userinfo\">\r\n              <text class=\"username\">{{ item.username }}</text>\r\n            </view>\r\n            <view class=\"userinfo\">\r\n              <text class=\"username\">{{ item.motto }}</text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <view\r\n          :class=\"{ follow: !isFlollow, active: isFlollow }\"\r\n          @click.stop=\"following(item)\"\r\n        >\r\n          <text>{{ followText }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nimport { getFollowsInfo, getFansInfo } from \"@/api/communication.js\";\r\nimport { setFollow, getFollow, deleteFollow } from \"@/api/communication.js\";\r\nexport default {\r\n  name: \"follow\",\r\n    onLoad: function (options) {\r\n    console.log(\"options===\", options);\r\n    this.propsOptions = options\r\n  },\r\n  setup(props) {\r\n    let infoList = ref([]);\r\n    let propsOptions = ref(null)\r\n\r\n    // 关注\r\n    let isFlollow = ref(false);\r\n    let followText = ref(\"关注\");\r\n    let followTitle = ref('')\r\n    const following = (info) => {\r\n      if (isFlollow.value) {\r\n        uni.showModal({\r\n          content: \"确认不再关注？\",\r\n          success: function (res) {\r\n            if (res.confirm) {\r\n              let params = { followId: info.user_id };\r\n              deleteFollow(params).then((data) => {\r\n                if (data.data.code === 200) {\r\n                  followText.value = \"关注\";\r\n                  isFlollow.value = false;\r\n                  getInfo(JSON.parse(decodeURIComponent(propsOptions.value.userids)));\r\n                }\r\n              });\r\n            } else if (res.cancel) {\r\n              console.log(\"用户点击取消\");\r\n            }\r\n          },\r\n        });\r\n        return;\r\n      }\r\n      let params = { followId: info.user_id };\r\n      setFollow(params).then((data) => {\r\n        console.log(\"data===\", data);\r\n        if (data.data.code === 200) {\r\n          followText.value = \"已关注\";\r\n          isFlollow.value = true;\r\n        } else if (data.data.code === 400) {\r\n          uni.showToast({\r\n            title: data.data.msg,\r\n            icon: \"none\",\r\n            duration: 2000,\r\n          });\r\n        }\r\n      });\r\n    };\r\n\r\n    const initFlow = (info) => {\r\n      let params = { followId: info.user_id };\r\n      console.log(\"params===\", params);\r\n      getFollow(params).then((data) => {\r\n        console.log(\"data1===\", data);\r\n        if (data.data.code === 200) {\r\n          isFlollow.value = data.data.isFollow;\r\n          data.data.isFollow\r\n            ? (followText.value = \"已关注\")\r\n            : (followText.value = \"关注\");\r\n        }\r\n      });\r\n    };\r\n\r\n    const getInfo = (userids) => {\r\n      const params = {\r\n        userids,\r\n      };\r\n      if (parseInt(propsOptions.value.type) === 0) {\r\n        uni.setNavigationBarTitle({\r\n          title: \"关注\",\r\n        }),\r\n        followTitle.value = '关注'\r\n          getFollowsInfo(params).then((data) => {\r\n            if (data.data.code === 200) {\r\n              infoList.value = data.data.followsInfo;\r\n              infoList.value = infoList.value.filter((element) => element);\r\n              console.log(\"infoList.value====\", infoList.value);\r\n              infoList.value.forEach((item) => {\r\n                initFlow(item);\r\n              });\r\n            }\r\n          });\r\n      } else if (parseInt(propsOptions.value.type) === 1) {\r\n        uni.setNavigationBarTitle({\r\n          title: \"粉丝\",\r\n        }),\r\n                followTitle.value = '粉丝'\r\n          getFansInfo(params).then((data) => {\r\n            console.log(\"getFansInfo===\", data);\r\n            if (data.data.code === 200) {\r\n              infoList.value = data.data.fansInfo;\r\n              infoList.value = infoList.value.filter((element) => element);\r\n              infoList.value.forEach((item) => {\r\n                initFlow(item);\r\n              });\r\n            }\r\n          });\r\n      }\r\n    };\r\n\r\n    // 跳转到好友详情\r\n    const goUserDetail = (info) => {\r\n      console.log(\"info======\", info);\r\n      //#ifdef APP-PLUS || H5\r\n      uni.navigateTo({\r\n        url: `/pages/user/info/User?id=${info.user_id}&title=${followTitle.value}`,\r\n      });\r\n      //#endif\r\n      //#ifdef MP-WEIXIN\r\n      uni.navigateTo({\r\n        url: `/pages/userInfo/User/User?id=${info.user_id}&title=${followTitle.value}`,\r\n      });\r\n      //#endif\r\n    };\r\n\r\n    onMounted(() => {\r\n      console.log('follow props=====================================================', propsOptions)\r\n      //   console.log(\"props=\", JSON.parse(decodeURIComponent(props.userids)));\r\n      getInfo(JSON.parse(decodeURIComponent(propsOptions.value.userids)));\r\n      // console.log(\"infoList.value=\", infoList.value);\r\n    });\r\n    return {\r\n      propsOptions,\r\n      infoList,\r\n      followText,\r\n      isFlollow,\r\n      following,\r\n      goUserDetail,\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.li {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 20rpx;\r\n  border-bottom: 1rpx solid #ccc;\r\n  .userinfo-wraper {\r\n    display: flex;\r\n  }\r\n  .avatar-wraper {\r\n    width: 100rpx;\r\n    height: 100rpx;\r\n    .avatar {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n  .img {\r\n    margin-left: 20rpx;\r\n    width: 133rpx;\r\n    height: 100rpx;\r\n    .img-url {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n.publish-info {\r\n  margin-left: 40rpx;\r\n  .title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #363636;\r\n  }\r\n}\r\n\r\n.follow {\r\n  border: 1rpx solid #ff2442;\r\n  border-radius: 8rpx;\r\n  color: #ff2442;\r\n  padding: 10rpx 20rpx;\r\n  font-size: 24rpx;\r\n}\r\n.active {\r\n  border: 1rpx solid #ccc;\r\n  border-radius: 8rpx;\r\n  color: #ccc;\r\n  padding: 10rpx 10rpx;\r\n  font-size: 24rpx;\r\n}\r\n\r\n.userinfo {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 24rpx;\r\n  color: #363636;\r\n  .avatar {\r\n    width: 50rpx;\r\n    height: 50rpx;\r\n    border-radius: 10rpx;\r\n  }\r\n  .username,\r\n  .update-time {\r\n    margin-left: 30rpx;\r\n  }\r\n}\r\n.replay-icon {\r\n  width: 1.2rem;\r\n  height: 1.2rem;\r\n}\r\n</style>\r\n"],"names":["name","onLoad","options","log","propsOptions","setup","props","infoList","ref","isFlollow","followText","followTitle","initFlow","info","params","followId","user_id","then","data","code","value","isFollow","getInfo","userids","parseInt","type","title","followsInfo","filter","element","forEach","item","fansInfo","JSON","parse","decodeURIComponent","following","content","success","res","confirm","params2","cancel","msg","icon","duration","goUserDetail","url","_createBlock","_component_v_uni_view","class","_createVNode","_createElementBlock","_Fragment","$setup","key","id","onClick","_component_v_uni_image","mode","src","avatar","_component_v_uni_text","username","motto"],"mappings":"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"}