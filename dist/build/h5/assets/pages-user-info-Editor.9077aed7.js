import{x as e,v as o,aq as a,av as t,r as l,M as s,b as n,c as r,d as c,g as i,i as d,t as u,u as m,h as p,e as f,f as h,F as g,G as v,aw as C,P as _,aj as b,l as y,y as x,m as w,p as j,S as I,R as k,at as P,V,Y as F,$ as N}from"./index.5db6d7a1.js";import{_ as D,a as M}from"./uni-forms.0b65dcb8.js";import{r as Y}from"./uni-app.es.737f45e5.js";import{_ as $}from"./PickerRegion.c9c4d61d.js";import{_ as R}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.eb5ebe58.js";var U=R({setup(R){const U=v();let G=e((()=>U.state.user.userInfo)).value,S=o({avatar:G.avatar,username:G.username,gender:G.gender,birthday:a(G.birthday).format("YYYY-MM-DD"),location:{provinceCode:G.location&&G.location.provinceCode,cityCode:G.location&&G.location.cityCode},hometown:{provinceCode:G.hometown&&G.hometown.provinceCode,cityCode:G.hometown&&G.hometown.cityCode},schoolName:G.schoolName,job:G.job,motto:G.motto,photos:G.photos}),q={username:{rules:[{required:!0,errorMessage:"请输入昵称"}]}};t("schoolUpdate",(function(e){S.schoolName=e.schoolName}));const L=l(null),J=e=>{console.log("form=e==",e),L.value.validate().then((e=>{console.log("表单数据信息：",e);const o={form:{...e,photos:T}};C(o).then((e=>{console.log("data======",e),U.dispatch("user/GetUserInfo").then((()=>{_({url:"/pages/user/info/index"})}))}))})).catch((e=>{console.log("表单错误信息：",e)}))},O="/static/images/default_avatar.png";let T=o(G.photos);s(T,((e,o)=>{console.log("images",e),S.photos=e}));console.log("images===",T);const z=l(G.avatar);s(z,((e,o)=>{S.avatar=e}));const A=e=>{F({success:o=>{console.log("chooseImageRes===",o);const{tempFilePaths:a,tempFiles:t}=o;console.log("tempFilePaths[0]===",a[0]),((e,o)=>{N({url:"https://mancao.social/prod/users/uploadFile",filePath:o,name:"file",formData:{user:"test"},success:o=>{console.log("uploadFileRes===",o);const{data:a}=o,t=JSON.parse(a);console.log("imgData=",t),T[e]=t.url,console.log("index===",e),0===e&&(z.value=t.url)}})})(e,a[0])}})},B=e=>{const o=new Date;let a=o.getFullYear(),t=o.getMonth()+1,l=o.getDate();return"start"===e?a-=60:"end"===e&&(a+=2),t=t>9?t:"0"+t,l=l>9?l:"0"+l,`${a}-${t}-${l}`},E=B({format:!0});console.log("currentDate===",E);let H=B("start"),K=B("end");const Q=e=>{S.birthday=e.detail.value},W=()=>{b({itemList:["男","女"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮")},fail:function(e){console.log(e.errMsg)}})},X=e=>{console.log("obj=====",e);const{provinceCode:o,cityCode:a}=e;S.location.provinceCode=o,S.location.cityCode=a},Z=e=>{console.log("obj.home=====",e);const{provinceCode:o,cityCode:a}=e;S.hometown.provinceCode=o,S.hometown.cityCode=a},ee=()=>{_({url:"/pages/user/info/School"})};let oe=l(["IT/互联网/通信","金融","工业制造业","教育/科研","公共事业单位","医药/健康","媒体/公关","影视/娱乐","零售","餐饮/酒店","其他"]),ae=l(0);const te=e=>{const{detail:{value:o}}=e;ae.value=o,S.job=oe.value[o]};return(e,o)=>{const a=y,t=Y(x("uni-forms-item"),D),l=w,s=j,v=I,C=k,_=P,F=Y(x("uni-forms"),M),N=V;return n(),r(l,{class:"userinfo-wraper"},{default:c((()=>[i(F,{ref_key:"form",ref:L,modelValue:m(S),rules:m(q)},{default:c((()=>[i(l,{class:"userinfo"},{default:c((()=>[i(t,{name:"avatar"},{default:c((()=>[i(a,{src:z.value?z.value:O,class:"avatar"},null,8,["src"])])),_:1})])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("个人照片")])),_:1}),i(s,null,{default:c((()=>{return[d("("+u((e=m(T),e.filter((e=>e)).length))+"/"+u(m(T).length)+")",1)];var e})),_:1})])),_:1}),p(' <uni-forms-item name="photos"> '),i(v,{"scroll-x":"true",class:"photos"},{default:c((()=>[i(l,{class:"photos"},{default:c((()=>[(n(!0),f(g,null,h(m(T),((e,o)=>(n(),r(l,{class:"photo-wraper",onClick:a=>((e,o)=>{if(console.log("item, index===",e,o),e){let a=["编辑"];return o>0&&(a=["设为头像","编辑","删除"]),void b({itemList:a,success:function(a){if(console.log("选中了第"+(a.tapIndex+1)+"个按钮"),0===a.tapIndex)return T[o]=T[0],T[0]=e,void(z.value=e);1!==a.tapIndex?2===a.tapIndex&&T.splice(o,1):A(o)},fail:function(e){console.log(e.errMsg)}})}A(o)})(e,o),key:o},{default:c((()=>[i(a,{mode:"aspectFill",src:e||O,class:"photo"},null,8,["src"]),!e&&m(T)[o-1]||0===o&&!m(T)[0]?(n(),r(s,{key:0,class:"photo-add"},{default:c((()=>[d("+")])),_:1})):p("v-if",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),p(" </uni-forms-item> ")])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("个人签名")])),_:1})])),_:1}),i(t,{name:"motto"},{default:c((()=>[i(C,{modelValue:m(S).motto,"onUpdate:modelValue":o[0]||(o[0]=e=>m(S).motto=e),type:"text",placeholder:"请输入个人签名"},null,8,["modelValue"])])),_:1})])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("基础信息")])),_:1})])),_:1}),p(' <view class="base-item">\r\n        <text>昵称</text>\r\n        <input type="text" placeholder="请输入昵称" />\r\n      </view> '),i(t,{label:"昵称",name:"username"},{default:c((()=>[i(C,{class:"input",modelValue:m(S).username,"onUpdate:modelValue":o[1]||(o[1]=e=>m(S).username=e),type:"text",placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),i(t,{label:"性别",name:"gender"},{default:c((()=>[p(" <text>性别</text> "),i(l,{onClick:W},{default:c((()=>[d(u(e.$filters.filterGender(m(G).gender)),1)])),_:1})])),_:1}),i(t,{label:"出生日期",name:"birthday"},{default:c((()=>[i(_,{mode:"date",value:m(S).birthday,start:m(H),end:m(K),onChange:Q},{default:c((()=>[i(l,{class:"uni-input"},{default:c((()=>[d(u(m(S).birthday),1)])),_:1})])),_:1},8,["value","start","end"])])),_:1}),i(t,{label:"所在地",name:"location"},{default:c((()=>[i($,{propsProvinceCode:m(S).location.provinceCode,propsCityCode:m(S).location.cityCode,onChange:X},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),i(t,{label:"家乡",name:"hometown"},{default:c((()=>[i($,{propsProvinceCode:m(S).hometown.provinceCode,propsCityCode:m(S).hometown.cityCode,onChange:Z},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),i(t,{label:"学校",name:"schoolName"},{default:c((()=>[i(l,{onClick:ee},{default:c((()=>[d(u(m(S).schoolName?m(S).schoolName:"请选择学校"),1)])),_:1})])),_:1}),i(t,{label:"职业",name:"job"},{default:c((()=>[i(_,{range:m(oe),value:m(ae),onChange:te},{default:c((()=>[i(l,{class:"uni-input"},{default:c((()=>[d(u(m(S).job?m(S).job:"请选择职业"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1})])),_:1},8,["modelValue","rules"]),i(N,{onClick:J},{default:c((()=>[d("保存")])),_:1}),p(" end ")])),_:1})}}},[["__scopeId","data-v-70bfd651"]]);export{U as default};
//# sourceMappingURL=pages-user-info-Editor.9077aed7.js.map
