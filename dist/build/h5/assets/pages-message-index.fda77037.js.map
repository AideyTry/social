{"version":3,"file":"pages-message-index.fda77037.js","sources":["../../../../src/pages/message/index.vue"],"sourcesContent":["<!--\n * @Author: Aiden(戴林波)\n * @Date: 2021-12-17 17:50:38\n * @LastEditTime: 2022-05-08 21:07:15\n * @LastEditors: Aiden(戴林波)\n * @Description: \n * @Email: jason_dlb@sina.cn\n-->\n<template>\n  <view>\n    <view v-for=\"item in convers\" :key=\"item.userID\" class=\"conver\" @click=\"goChat(item)\">\n      <view class=\"conver-msg\">\n        <image\n          :src=\"\n            item.faceURL && item.faceURL.includes('https://')\n              ? item.faceURL\n              : defaultAvatar\n          \"\n          class=\"chat_bg_msg_icon\"\n        />\n        <view class=\"content-wraper\">\n          <text>{{ item.showName }}</text>\n          <text>{{ $filters.commentTime(item.latestMsgSendTime) }}</text>\n        </view>\n      </view>\n      <text class=\"conver-time\">{{\n        $filters.commentTime(item.latestMsgSendTime)\n      }}</text>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { onMounted, computed, ref } from \"vue\";\nimport openIM from \"@/utils/openIM.js\";\nimport { getIMToken } from \"../../utils/auth.js\";\nimport { useStore } from \"vuex\";\nimport ChatContent from \"./ChatContent.vue\";\nexport default {\n  components: {\n    ChatContent,\n  },\n  setup() {\n    const defaultAvatar = \"/static/images/default_avatar.png\";\n    const store = useStore();\n    const userInfo = computed(() => store.state.user.userInfo).value;\n    let operationID = ref(null);\n    const convers = ref([]);\n    const goChat = (item) => {\n      console.log('item=', item)\n      uni.navigateTo({\n        url: `/pages/message/Chat?userID=${item.userID}&title=${item.showName}`,\n      });\n    };\n    const connectIM = (userID, token) => {\n      console.log(\"userID, token=====================\", userID, token);\n      const config = {\n        userID,\n        token,\n        // url: \"ws://42.192.229.151/:10003\",\n        url: \"wss://mancao.social:20038\",\n        platformID: 5,\n      };\n      openIM\n        .login(config)\n        .then((res) => {\n          console.log(\"login suc...\", res);\n          if (res.errCode === 0) {\n            openIM\n              .getAllConversationList()\n              .then(({ data }) => {\n                console.log(\"data====\", JSON.parse(data));\n                convers.value = JSON.parse(data);\n              })\n              .catch((err) => {\n                console.log(\"err=\", err);\n              });\n          }\n          operationID.value = res.operationID;\n          //         openIM.getAllConversationList().then(res=>{\n          // //注意 会话对象中latestMsg（会话最后一条消息）仍为Json字符串格式 若需要使用请自行转换\n          //         console.log('回话=', JSON.parse(res.data))\n          //         console.log('列表信息=', JSON.parse(JSON.parse(res.data)[0].latestMsg))\n          //       }).catch(err=>{\n\n          //       })\n          //   const options = {\n          //   offset: 0,\n          //   count: 20\n          // }\n          // openIM.getConversationListSplit(options).then(({ data })=>{\n          //   console.log('获取的数据=', data)\n          // }).catch(err=>{\n          //   console.log('err===', err)\n          // })\n        })\n        .catch((err) => {\n          console.log(\"login failed...\", err);\n        });\n    };\n\n    onMounted(() => {\n      connectIM(userInfo.phone, getIMToken());\n      // login();\n      // resiger()\n    });\n    return {\n      defaultAvatar,\n      operationID,\n      convers,\n      goChat\n    };\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n.conver {\n  display: flex;\n  justify-content: space-between;\n  border-bottom: 1rpx solid #dbdbdb;\n  padding: 10rpx;\n  .conver-msg {\n    display: flex;\n  }\n  .chat_bg_msg_icon {\n    width: 84rpx;\n    height: 84rpx;\n  }\n  .content-wraper {\n    display: flex;\n    flex-direction: column;\n    margin: 0 12rpx;\n    background-color: #f2f2f2;\n  }\n  .conver-time {\n  }\n}\n</style>\n"],"names":["components","ChatContent","setup","store","useStore","userInfo","computed","state","user","value","operationID","ref","convers","userID","token","log","config","url","platformID","login","then","res","errCode","getAllConversationList","data","JSON","parse","catch","err","phone","getIMToken","defaultAvatar","goChat","item","showName","key","class"],"mappings":"qTAuCEA,WAAY,CACVC,YAAAA,GAEFC,cAEQC,EAAQC,IACRC,EAAWC,GAAS,IAAMH,EAAMI,MAAMC,KAAKH,WAAUI,UACvDC,EAAcC,EAAI,YAChBC,EAAUD,EAAI,cAsDV,KA/CQ,EAACE,EAAQC,aACjBC,IAAI,qCAAsCF,EAAQC,SACpDE,EAAS,CACbH,OAAAA,EACAC,MAAAA,EAEAG,IAAK,4BACLC,WAAY,KAGXC,MAAMH,GACNI,MAAMC,YACGN,IAAI,eAAgBM,GACR,IAAhBA,EAAIC,WAEHC,yBACAH,MAAK,EAAGI,KAAAA,cACCT,IAAI,WAAYU,KAAKC,MAAMF,MAC3Bf,MAAQgB,KAAKC,MAAMF,MAE5BG,OAAOC,YACEb,IAAI,OAAQa,QAGdnB,MAAQY,EAAIX,eAkBzBiB,OAAOC,YACEb,IAAI,kBAAmBa,QAKzBvB,EAASwB,MAAOC,QAIrB,CACLC,cAhEoB,oCAiEpBrB,YAAAA,EACAE,QAAAA,EACAoB,OA9DcC,YACNlB,IAAI,QAASkB,KACN,CACbhB,IAAK,8BAA8BgB,EAAKpB,gBAAgBoB,EAAKC,mJAzChBC,IAAKF,SAAWG,MAAK,gHAGiCH,+BAAiBA"}