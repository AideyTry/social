import{Z as e,T as o,S as a,z as t,A as s,_ as l,U as n,o as c,D as i,e as u,w as d,J as r,K as p,c as f,M as m,E as h,I as b,a1 as y,ap as g,ae as v,l as _,aw as I,P as k,O as x,Q as C,W as j,a6 as w,a9 as V,n as T}from"./vendor.99a7c6c2.js";import{_ as F,a as P}from"./uni-forms.3a8f3d88.js";import{r as z}from"./uni-app.es.4451f765.js";import{l as L}from"./index.0b6b4e02.js";import{b as D}from"./hobby.568df93f.js";import{u as E,b as S}from"./publish.ec8ec870.js";import{C as U}from"./Comment.2563a683.js";import{V as q}from"./VideoPlayer.d5324a0e.js";import{f as B,b as M}from"./index.820bb8c9.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.e12d4142.js";import"./communication.2d8a9001.js";var A=O({components:{Comment:U,VideoPlayer:q},onLoad:function(e){console.log("options===",e)},onReady:function(){},setup(l){console.log("props=",l);const n=e();o((()=>n.state.user.userInfo)).value;const c=a({poster:"",src:""});let i=t([{content:"https://social-1308251497.cos.ap-guangzhou.myqcloud.com/images/4.jfif"}]);t(0),t("default");let u=t({});let d=t(null),r=t(["编辑","删除"]),p=t(0);const f=t([]),m=t(null);return s((()=>{(e=>{const{id:o,hobby:a}=e;D({id:o,hobby:a}).then((e=>{200===e.data.code&&(u.value=e.data.data,d.value=B(e.data.data.create_time),e.data.data.video_url||(f.value=u.value.photos.map(((e,o)=>({path:e})))),c.poster=e.data.data.url,c.src=e.data.data.video_url)}))})({id:l.id,hobby:l.hobby})})),{hobbyInfo:u,photos:f,info:i,publishDate:d,options:c,goBack:()=>{y({url:"/pages/user/index"})},onEdit:(e,o)=>{console.log("item, index===",e,o),g({itemList:r,success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮"),p.value=e.tapIndex,1===p.value?(e=>{f.value.length<=1?T({content:"至少需要发布一张图片",confirmText:"知道了",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}}):(f.value.splice(e,1),console.log("photos.value===========",f.value))})(o):(e=>{v({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(o){const{tempFiles:a}=o;f.value[e]=a[0]}})})(o)},fail:function(e){console.log(e.errMsg)}})},operations:r,activeOperationIndex:p,addImage:()=>{v({count:6,sizeType:["original","compressed"],sourceType:["album"],success:function(e){console.log("res===",e);const{tempFiles:o}=e;f.value=f.value.concat(o),console.log("photos.value====",f.value)}})},form:m,changeTitle:e=>{const{detail:o}=e;u.value.title.value=o},changeContent:e=>{const{detail:o}=e;u.value.content.value=o},submit:()=>{m.value.validate().then((async e=>{console.log("表单数据信息：",e);const{title:o,content:a}=e;if(console.log("photos=====",f.value),f.value.length<=0){const e={title:o,id:parseInt(l.id),hobby:parseInt(l.hobby),content:a};return void E(e).then((e=>{200===e.data.code&&(_({title:e.data.msg,duration:2e3}),y({url:"/pages/user/index",success(){let e=I().pop();console.log("page==============",e),e&&e.onLoad()}}))}))}const t=f.value.map(((e,o)=>({key:e,index:o}))),s=t.filter((e=>e.key.path.includes("social-1308251497"))),n=t.filter((e=>e.key.path.includes("blob:"))),c=[];for(let l of n){const e=await M(l.key,"base64");c.push({index:l.index,filename:l.key.name,chunk:e})}const i=u.value.photos[0].match(/myqcloud.com\/(\S*)/)[1].match(/(\S*)\//)[1],d=s.map((e=>({index:e.index,path:e.key.path}))),r={uploadHash:i,uploadFiles:c.length>0?c:[],remotePhotos:d.length>0?d:[],title:o,id:parseInt(l.id),hobby:parseInt(l.hobby),content:a};S(L.stringify(r)).then((e=>{200===e.data.code&&(_({title:e.data.msg,duration:2e3}),y({url:"/pages/user/index",success(){let e=I().pop();console.log("page==============",e),e&&e.onLoad()}})),console.log("data=",e)}))})).catch((e=>{console.log("表单错误信息：",e)}))}}}},[["render",function(e,o,a,t,s,y){const g=k,v=x,_=C,I=j,T=l("VideoPlayer"),L=w,D=z(n("uni-forms-item"),F),E=l("Comment"),S=z(n("uni-forms"),P),U=V;return c(),i("div",{class:"hobby-detail"},[u(S,{ref:"form",modelValue:t.hobbyInfo},{default:d((()=>[u(g,{class:"author-wraper"},{default:d((()=>[u(g,{class:"author"},{default:d((()=>[u(g,{onClick:t.goBack},{default:d((()=>[r("返回")])),_:1},8,["onClick"]),u(g,{class:"author-info"},{default:d((()=>[u(v,{class:"avatar",mode:"aspectFit",src:t.hobbyInfo.avatar||""},null,8,["src"]),u(_,null,{default:d((()=>[r(p(t.hobbyInfo.username||""),1)])),_:1})])),_:1})])),_:1})])),_:1}),0===t.hobbyInfo.fileType?(c(),f(I,{key:0,"scroll-x":"true",class:"photos"},{default:d((()=>[u(g,{class:"photos"},{default:d((()=>[(c(!0),i(m,null,h(t.photos,((e,o)=>(c(),f(g,{class:"photo-wraper",key:o},{default:d((()=>[u(v,{mode:"aspectFill",src:e.path,class:"photo",onClick:a=>t.onEdit(e,o)},null,8,["src","onClick"])])),_:2},1024)))),128)),u(g,{class:"photo-add-wraper",onClick:t.addImage},{default:d((()=>[u(_,{class:"photo-add"},{default:d((()=>[r("+")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})):b("v-if",!0),1===t.hobbyInfo.fileType?(c(),f(g,{key:1,class:"swiper-box"},{default:d((()=>[u(g,{class:"swiper-item"},{default:d((()=>[(c(),f(T,{options:{src:t.hobbyInfo.video_url,poster:t.hobbyInfo.url},key:t.hobbyInfo.id},null,8,["options"]))])),_:1})])),_:1})):b("v-if",!0),u(g,{class:"content-wraper"},{default:d((()=>[u(g,{class:"content"},{default:d((()=>[u(g,{class:"title"},{default:d((()=>[u(D,{name:"title"},{default:d((()=>[u(L,{modelValue:t.hobbyInfo.title,"onUpdate:modelValue":o[0]||(o[0]=e=>t.hobbyInfo.title=e),type:"text",placeholder:"请输入文本",onConfirm:t.changeTitle},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),u(g,{class:"main"},{default:d((()=>[u(D,{name:"content"},{default:d((()=>[u(L,{modelValue:t.hobbyInfo.content,"onUpdate:modelValue":o[1]||(o[1]=e=>t.hobbyInfo.content=e),type:"text",placeholder:"请输入文本",onConfirm:t.changeContent},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),u(g,{class:"publish-date"},{default:d((()=>[u(_,null,{default:d((()=>[r("发布于: ")])),_:1}),u(_,null,{default:d((()=>[r(p(t.publishDate),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(g,{class:"comment-wraper"},{default:d((()=>[t.hobbyInfo.id?(c(),f(E,{hobbyInfo:t.hobbyInfo,key:t.hobbyInfo.id},null,8,["hobbyInfo"])):b("v-if",!0)])),_:1})])),_:1},8,["modelValue"]),u(g,{class:"submit-wraper"},{default:d((()=>[u(U,{onClick:t.submit,class:"submit"},{default:d((()=>[r("发 布")])),_:1},8,["onClick"])])),_:1})])}],["__scopeId","data-v-20538578"]]);export{A as default};
//# sourceMappingURL=pages-user-info-EditDetail.a0038a1b.js.map
