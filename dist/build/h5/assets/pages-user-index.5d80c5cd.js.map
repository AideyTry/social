{"version":3,"file":"pages-user-index.5d80c5cd.js","sources":["../../../../src/pages/components/InfoList.vue","../../../../src/pages/user/index.vue"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2022-03-01 13:17:37\r\n * @LastEditTime: 2022-04-21 22:19:45\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"info-list\">\r\n    <!-- <uni-list>\r\n      <uni-list-item\r\n        v-for=\"item in infoList\"\r\n        :key=\"item.id\"\r\n        :title=\"item.username\"\r\n        :note=\"item.title\"\r\n        :thumb=\"item.avatar\"\r\n        thumb-size=\"lg\"\r\n      ></uni-list-item>\r\n    </uni-list> -->\r\n    <view class=\"ul\">\r\n      <view class=\"li\" v-for=\"item in infoList\" :key=\"item.id\"  @click=\"goDetail(item)\">\r\n        <view class=\"comment\">\r\n          <svg class=\"replay-icon\" aria-hidden=\"true\">\r\n            <use xlink:href=\"#icon-pinglunhuifu\"></use>\r\n          </svg>\r\n          <view><text>{{item.comments || 0}}</text></view>\r\n        </view>\r\n        <view class=\"publish-info\">\r\n          <view class=\"title\">{{ item.title }} </view>\r\n          <view class=\"userinfo\">\r\n            <image\r\n              class=\"avatar\"\r\n              mode=\"aspectFit\"\r\n              :src=\"item.avatar || ''\"\r\n            ></image>\r\n            <text class=\"username\">{{ item.username }}</text>\r\n            <text class=\"update-time\"\r\n              >{{ $filters.commentTime(item.create_time || '') }}&nbsp;更新</text\r\n            >\r\n          </view>\r\n        </view>\r\n        <view class=\"img\">\r\n            <image\r\n              class=\"img-url\"\r\n              mode=\"aspectFit\"\r\n              :src=\"item.url || ''\"\r\n            ></image>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"infoList\",\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nconst props = defineProps({\r\n  list: {\r\n    type: Array,\r\n    default: [],\r\n  },\r\n  activeIndex: {\r\n    type: Number,\r\n    default: 0\r\n  }\r\n});\r\nlet infoList = ref([]);\r\n\r\nconst goDetail = (item) => {\r\n  console.log('item=', item)\r\n  if(props.activeIndex === 0){\r\n    uni.navigateTo({\r\n    url: `/pages/user/info/PublicDetail?id=${item.id}&hobby=${item.hobby}`\r\n  });\r\n  } else {\r\n    uni.navigateTo({\r\n      url: `/pages/user/info/LikeDetail?id=${item.id}&hobby=${item.hobby}`\r\n    });\r\n  }\r\n}\r\n\r\nwatch(\r\n  () => props.list,\r\n  (state) => {\r\n    console.log(\"state=\", state);\r\n    infoList.value = state;\r\n  },\r\n  {\r\n    deep: true,\r\n  }\r\n);\r\n\r\nonMounted(() => {\r\n  console.log(\"props=\", props);\r\n\r\n  // console.log(\"infoList.value=\", infoList.value);\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.li {\r\n  display: flex;\r\n  padding: 20rpx;\r\n  border-bottom: 1rpx solid #ccc;\r\n  .img{\r\n    margin-left: 20rpx;\r\n    width: 133rpx;\r\n    height: 100rpx;\r\n    .img-url{\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n.publish-info {\r\n  margin-left: 40rpx;\r\n  .title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #363636;\r\n  }\r\n}\r\n\r\n.userinfo {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 24rpx;\r\n  color: #363636;\r\n  .avatar {\r\n    width: 50rpx;\r\n    height: 50rpx;\r\n    border-radius: 10rpx;\r\n  }\r\n  .username,\r\n  .update-time {\r\n    margin-left: 30rpx;\r\n  }\r\n}\r\n  .replay-icon{\r\n    width: 1.2rem;\r\n    height: 1.2rem;\r\n  }\r\n</style>\r\n","<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-17 17:52:36\r\n * @LastEditTime: 2022-05-16 20:38:54\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"userinfo-wraper\">\r\n    <view class=\"userinfo\">\r\n      <view class=\"avatar-warper\" @click=\"onUserInfo\">\r\n        <image\r\n          :src=\"userInfo.avatar ? userInfo.avatar : defaultAvatar\"\r\n          class=\"avatar\"\r\n        ></image>\r\n        <text class=\"avatar-title\" v-if=\"!userInfo.avatar\">请上传图片</text>\r\n      </view>\r\n      <view class=\"userinfo-detail\">\r\n        <text>用户名：{{ userInfo.username }}</text>\r\n        <view class=\"motto\"\r\n          ><text>签&nbsp;&nbsp;&nbsp;名：</text\r\n          ><text>{{ userInfo.motto }}</text></view\r\n        >\r\n      </view>\r\n    </view>\r\n    <view class=\"fans-wraper\">\r\n      <view class=\"follows\" @click=\"goFollows\"\r\n        ><text>关注</text>&nbsp;<text>{{ follows.length }}</text></view\r\n      >\r\n      <view class=\"fans\" @click=\"goFans\"\r\n        ><text>粉丝</text>&nbsp;<text>{{ fans.length }}</text></view\r\n      >\r\n    </view>\r\n    <view class=\"publish-wraper\">\r\n      <view class=\"my-publishs\" @click=\"changeTab(0)\">\r\n        <text>我发布的</text>\r\n        <view :class=\"{ active: activeIndex === 0 }\"></view>\r\n      </view>\r\n      <view class=\"my-likes\" @click=\"changeTab(1)\">\r\n        <text>我喜欢的</text>\r\n        <view :class=\"{ active: activeIndex === 1 }\"></view>\r\n      </view>\r\n    </view>\r\n    <view>\r\n      <InfoList :list=\"publishs\" :activeIndex=\"activeIndex\" />\r\n    </view>\r\n    <button @click=\"onLogout\" style=\"margin-top: 20rpx;\">退出</button>\r\n    <view v-if=\"false\">\r\n      <button @click=\"onOpenIMLogout\">OpenIM logout</button>\r\n      <button @click=\"onDeleteConversation\">Delete Conversicon</button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getTotalIM } from \"@/utils/storage.js\";\r\nexport default {\r\n  onShow: function() {\r\n    if (getTotalIM() > 0) {\r\n      uni.setTabBarBadge({\r\n        index: 2,\r\n        text: \"···\",\r\n      });\r\n    } else {\r\n      uni.removeTabBarBadge({\r\n        index: 2,\r\n      });\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted, watchEffect } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { removeToken } from \"../../utils/auth\";\r\nimport { getFollows, getFans } from \"@/api/communication.js\";\r\nimport { getPublish, getMylikes } from \"@/api/publish.js\";\r\n\r\nimport InfoList from \"@/pages/components/InfoList.vue\";\r\n\r\nimport openIM from \"@/utils/openIM.js\";\r\n\r\nconst defaultAvatar = \"/static/images/default_avatar.png\";\r\nconst store = useStore();\r\nconst userInfo = computed(() => store.state.user.userInfo).value;\r\n\r\nconst onLogout = () => {\r\n  new Promise((resolve, reject) => {\r\n    removeToken();\r\n    resolve();\r\n  }).then(() => {\r\n    location.reload();\r\n  });\r\n};\r\n\r\nconst onUserInfo = () => {\r\n  uni.navigateTo({\r\n    url: \"/pages/user/info/index\",\r\n  });\r\n};\r\n\r\n// fans\r\nlet follows = ref([]);\r\nlet fans = ref([]);\r\nlet getFollowsData = () => {\r\n  getFollows().then((data) => {\r\n    console.log(\"getfollows =\", data);\r\n    if (data.data.code === 200) {\r\n      follows.value = data.data.follows;\r\n    }\r\n  });\r\n};\r\nlet getFansData = () => {\r\n  getFans().then((data) => {\r\n    console.log(\"getfans =\", data);\r\n    if (data.data.code === 200) {\r\n      fans.value = data.data.fans;\r\n    }\r\n  });\r\n};\r\n\r\nconst goFollows = () => {\r\n  const userids = [];\r\n  for (let item of follows.value) {\r\n    userids.push(item.follow_id);\r\n  }\r\n  uni.navigateTo({\r\n    url: `/pages/user/info/Follow?type=${0}&userids=${encodeURIComponent(\r\n      JSON.stringify(userids)\r\n    )}`,\r\n  });\r\n};\r\n\r\nconst goFans = () => {\r\n  const userids = [];\r\n  for (let item of fans.value) {\r\n    userids.push(item.user_id);\r\n  }\r\n  uni.navigateTo({\r\n    url: `/pages/user/info/Follow?type=${1}&userids=${encodeURIComponent(\r\n      JSON.stringify(userids)\r\n    )}`,\r\n  });\r\n};\r\n\r\n// publish\r\nlet activeIndex = ref(0);\r\nlet publishs = ref([]);\r\n\r\nconst getPublishData = () => {\r\n  publishs.value = [];\r\n  getPublish().then((data) => {\r\n    console.log(\"data getPublish=\", data);\r\n    if (data.data.code === 200) {\r\n      publishs.value = data.data.data;\r\n    }\r\n  });\r\n};\r\n\r\n// 喜爱\r\nlet likes = ref([]);\r\nconst getMylikesData = () => {\r\n  publishs.value = [];\r\n  getMylikes().then((data) => {\r\n    console.log(\"data likes=\", data);\r\n    if (data.data.code === 200) {\r\n      publishs.value = data.data.data;\r\n    }\r\n  });\r\n};\r\n\r\nconst changeTab = (flag) => {\r\n  activeIndex.value = flag;\r\n};\r\n\r\nconst onOpenIMLogout = () => {\r\n  openIM\r\n    .logout()\r\n    .then(({ data }) => {\r\n      console.log(\"logout=\", data);\r\n    })\r\n    .catch((err) => {\r\n      console.log(\"logout err=\", err);\r\n    });\r\n};\r\n\r\nconst onDeleteConversation = () => {\r\n  openIM\r\n    .getAllConversationList()\r\n    .then((res) => {\r\n      //注意 会话对象中latestMsg（会话最后一条消息）仍为Json字符串格式 若需要使用请自行转换\r\n      console.log(\"res========\", res);\r\n      const conversData = JSON.parse(res.data);\r\n      conversData.forEach((item) => {\r\n        openIM\r\n          .deleteConversation(item.conversationID)\r\n          .then((res) => {\r\n            console.log(\"delete res=\", res);\r\n          })\r\n          .catch((err) => {\r\n            console.log(\"err=========\", err);\r\n          });\r\n      });\r\n      console.log(\"conversData=\", conversData);\r\n    })\r\n    .catch((err) => {});\r\n};\r\n\r\nwatchEffect(() => {\r\n  if (activeIndex.value === 0) {\r\n    getPublishData();\r\n  } else {\r\n    getMylikesData();\r\n  }\r\n}, activeIndex.value);\r\n\r\nonMounted(() => {\r\n  getFollowsData();\r\n  getFansData();\r\n  // getPublishData();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.userinfo-wraper {\r\n  padding: 40rpx;\r\n}\r\n.userinfo {\r\n  display: flex;\r\n  .userinfo-detail {\r\n    padding-left: 20rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    .motto {\r\n      display: flex;\r\n    }\r\n  }\r\n}\r\n.avatar-warper {\r\n  position: relative;\r\n}\r\n.avatar {\r\n  width: 150rpx;\r\n  height: 150rpx;\r\n  border-radius: 50%;\r\n  padding: 12rpx;\r\n}\r\n.avatar-title {\r\n  position: absolute;\r\n  left: 6%;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n  font-size: 12rpx;\r\n}\r\n\r\n.fans-wraper {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n.follows {\r\n}\r\n.fans {\r\n  margin-left: 20rpx;\r\n  padding-left: 20rpx;\r\n  position: relative;\r\n}\r\n.fans:before {\r\n  content: \"\";\r\n  height: 80%;\r\n  position: absolute;\r\n  top: 10%;\r\n  left: 0;\r\n  border-left: 1px solid #ccc;\r\n}\r\n.publish-wraper {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 20rpx 0;\r\n  padding-top: 20rpx;\r\n  border-top: 1rpx solid #ccc;\r\n  // border-bottom: 1rpx solid #ccc;\r\n  .my-publishs,\r\n  .my-likes {\r\n    font-size: 28rpx;\r\n    position: relative;\r\n  }\r\n  .my-likes {\r\n    margin-left: 40rpx;\r\n  }\r\n  .active {\r\n    position: absolute;\r\n    left: 50%;\r\n    transform: translate(-50%, 0);\r\n    bottom: -10rpx;\r\n    width: 100%;\r\n    height: 0.1875rem;\r\n    border-radius: 0.125rem;\r\n    background-color: #ff8200;\r\n  }\r\n}\r\n</style>\r\n"],"names":["name","infoList","ref","props","list","state","log","value","deep","item","activeIndex","url","id","hobby","onShow","getTotalIM","index","text","store","useStore","userInfo","computed","user","onLogout","Promise","resolve","reject","then","reload","onUserInfo","follows","fans","goFollows","userids","push","follow_id","encodeURIComponent","JSON","stringify","goFans","user_id","publishs","changeTab","flag","data","code"],"mappings":"6aAuDA,QAAe,CACbA,KAAM,qIAgBJC,EAAWC,EAAI,cAgBjB,IAAMC,EAAMC,OACXC,YACSC,IAAI,SAAUD,KACbE,MAAQF,IAEnB,CACEG,MAAM,OAIA,aACAF,IAAI,SAAUH,2cAzBP,CAACM,YACRH,IAAI,QAASG,GACI,IAAtBN,EAAMO,cACQ,CACfC,IAAK,oCAAoCF,EAAKG,YAAYH,EAAKI,YAGhD,CACbF,IAAK,kCAAkCF,EAAKG,YAAYH,EAAKI,26BCzBnE,QAAe,CACbC,OAAQ,WACFC,IAAe,IACE,CACjBC,MAAO,EACPC,KAAM,UAGc,CACpBD,MAAO,8CAmBTE,EAAQC,IACRC,EAAWC,GAAS,IAAMH,EAAMb,MAAMiB,KAAKF,WAAUb,MAErDgB,EAAW,SACXC,SAAQ,CAACC,EAASC,gBAGnBC,MAAK,cACGC,aAIPC,EAAa,OACF,CACblB,IAAK,gCAKLmB,EAAU5B,EAAI,IACd6B,EAAO7B,EAAI,UAkBT8B,EAAY,WACVC,EAAU,WACPxB,KAAQqB,EAAQvB,QACf2B,KAAKzB,EAAK0B,aAEL,CACbxB,IAAK,0CAA6CyB,mBAChDC,KAAKC,UAAUL,SAKfM,EAAS,WACPN,EAAU,WACPxB,KAAQsB,EAAKxB,QACZ2B,KAAKzB,EAAK+B,WAEL,CACb7B,IAAK,0CAA6CyB,mBAChDC,KAAKC,UAAUL,aAMjBvB,EAAcR,EAAI,GAClBuC,EAAWvC,EAAI,MAaH,UAWVwC,EAAaC,MACLpC,MAAQoC,aAoCV,KACgB,IAAtBjC,EAAYH,SA3DPA,MAAQ,OACJoB,MAAMiB,YACTtC,IAAI,mBAAoBsC,GACT,MAAnBA,EAAKA,KAAKC,SACHtC,MAAQqC,EAAKA,KAAKA,aAQtBrC,MAAQ,OACJoB,MAAMiB,YACTtC,IAAI,cAAesC,GACJ,MAAnBA,EAAKA,KAAKC,SACHtC,MAAQqC,EAAKA,KAAKA,YAgD9BlC,EAAYH,UAEL,SA/GKoB,MAAMiB,YACTtC,IAAI,eAAgBsC,GACL,MAAnBA,EAAKA,KAAKC,SACJtC,MAAQqC,EAAKA,KAAKd,gBAKpBH,MAAMiB,YACNtC,IAAI,YAAasC,GACF,MAAnBA,EAAKA,KAAKC,SACPtC,MAAQqC,EAAKA,KAAKb,oOAlCP"}