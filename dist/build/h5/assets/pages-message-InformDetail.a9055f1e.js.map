{"version":3,"file":"pages-message-InformDetail.a9055f1e.js","sources":["../../../../src/pages/message/InformDetail.vue"],"sourcesContent":["<template>\r\n  <view class=\"inform-detail-wrapper\">\r\n    <view class=\"title\" v-if=\"title !== '0'\"\r\n      ><text>{{ title }}</text></view\r\n    >\r\n    <view class=\"content\"><text>上传截图、提高举报准确度</text></view>\r\n    <scroll-view scroll-x=\"true\" class=\"photos\">\r\n      <view class=\"photos\">\r\n        <view\r\n          class=\"photo-wraper\"\r\n          @click=\"onUpload(item, index)\"\r\n          v-for=\"(item, index) in images\"\r\n          :key=\"index\"\r\n        >\r\n          <image mode=\"aspectFill\" :src=\"item ? item : ''\" class=\"photo\"></image\r\n          ><span\r\n            class=\"iconfont photo-add\"\r\n            v-if=\"(!item && images[index - 1]) || (index === 0 && !images[0])\"\r\n          >\r\n            &#xe602;</span\r\n          >\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n    <textarea\r\n      :placeholder=\"\r\n        title === '0'\r\n          ? '请填写不少于10个字的举报理由（必填项）'\r\n          : '还有其他想说的...（选填）'\r\n      \"\r\n      :value=\"inputInform\"\r\n      @input=\"onInput\"\r\n      :maxlength=\"100\"\r\n    />\r\n    <view\r\n      ><text>{{ count }}/100</text></view\r\n    >\r\n    <view class=\"submit-wraper\">\r\n      <button @click=\"onSubmit\" type=\"primary\" :disabled=\"!submitvisible\">\r\n        提交\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted, computed, watch } from \"vue\";\r\nimport { sendInform } from \"@/api/user.js\";\r\nexport default {\r\n  onLoad: function (options) {\r\n    console.log(\"options===\", options);\r\n    this.propsOptions = options;\r\n  },\r\n  setup() {\r\n    let title = ref(null);\r\n    let images = reactive([\"\"]);\r\n    let inputInform = ref(\"\");\r\n    let propsOptions = ref(null);\r\n    let submitvisible = ref(true);\r\n\r\n    watch(inputInform, (current) => {\r\n      console.log(\"current======\", current);\r\n      if (propsOptions.value.title != \"0\") {\r\n        return;\r\n      }\r\n      if (current) {\r\n        submitvisible.value = true;\r\n      } else {\r\n        submitvisible.value = false;\r\n      }\r\n    });\r\n\r\n    let count = computed(() => inputInform.value.length);\r\n\r\n    /**\r\n     * @description: 提交图片\r\n     * @param {*}\r\n     * @Author:\r\n     * @return {*}\r\n     */\r\n    const onUploadFile = (index, filePath) => {\r\n      console.log(\"index, filePath===\", index, filePath);\r\n      uni.uploadFile({\r\n        url: `${process.env.BASE_URL}/users/uploadFile`,\r\n        filePath,\r\n        name: \"file\",\r\n        formData: {\r\n          user: \"test\",\r\n        },\r\n        success: (uploadFileRes) => {\r\n          console.log(\"uploadFileRes===\", uploadFileRes);\r\n          const { data } = uploadFileRes;\r\n          const imgData = JSON.parse(data);\r\n          console.log(\"imgData=\", imgData);\r\n          images[index] = imgData.url;\r\n          images.push(\"\");\r\n          console.log(\"index===\", index);\r\n        },\r\n      });\r\n    };\r\n\r\n    const chooseImage = (index) => {\r\n      uni.chooseImage({\r\n        success: (chooseImageRes) => {\r\n          console.log(\"chooseImageRes===\", chooseImageRes);\r\n          const { tempFilePaths, tempFiles } = chooseImageRes;\r\n          console.log(\"tempFilePaths[0]===\", tempFilePaths[0]);\r\n          onUploadFile(index, tempFilePaths[0]);\r\n          // images[index] = tempFilePaths[0];\r\n          // console.log(\"images===\", images);\r\n        },\r\n      });\r\n    };\r\n\r\n    const onUpload = (item, index) => {\r\n      console.log(\"item, index===\", item, index);\r\n      if (item) {\r\n        return;\r\n      }\r\n      chooseImage(index);\r\n    };\r\n    const onInput = (e) => {\r\n      console.log(\"einput= \", e);\r\n      inputInform.value = e.detail.value;\r\n    };\r\n    const onSubmit = () => {\r\n      console.log(\"title============\", title.value);\r\n      console.log(\"inputInform=====================\", inputInform.value);\r\n      const resultImages = JSON.parse(JSON.stringify(images));\r\n      console.log(\r\n        \"resultImages==========================\",\r\n        resultImages.splice(resultImages.length - 1, 1)\r\n      );\r\n      console.log(\"resultImages result=\", resultImages);\r\n      const params = {\r\n        account: propsOptions.value.account,\r\n        title: title.value,\r\n        content: inputInform.value,\r\n        images: resultImages,\r\n      };\r\n      sendInform(params).then((data) => {\r\n        if (data.data.code === 200) {\r\n          uni.showToast({\r\n            title: data.data.msg,\r\n            duration: 2000,\r\n          });\r\n        }\r\n      });\r\n    };\r\n    onMounted(() => {\r\n      title.value = propsOptions.value.title;\r\n      if (title.value === \"0\") {\r\n        submitvisible.value = false;\r\n      }\r\n    });\r\n    return {\r\n      title,\r\n      inputInform,\r\n      count,\r\n      images,\r\n      propsOptions,\r\n      submitvisible,\r\n      onUpload,\r\n      onInput,\r\n      onSubmit,\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.inform-detail-wrapper {\r\n  padding: 20rpx;\r\n  .title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #363636;\r\n  }\r\n  .content {\r\n    margin: 40rpx 0;\r\n  }\r\n  .photos {\r\n    display: flex;\r\n    .photo-wraper {\r\n      position: relative;\r\n      margin-right: 20rpx;\r\n      .photo {\r\n        width: 200rpx;\r\n        height: 200rpx;\r\n        border-radius: 20%;\r\n        border: 1rpx solid #787878;\r\n      }\r\n      .photo-add {\r\n        position: absolute;\r\n        left: 50%;\r\n        top: 50%;\r\n        transform: translate(-50%, -50%);\r\n        // transform: translateX(-50%);\r\n        font-size: 68rpx;\r\n      }\r\n    }\r\n  }\r\n  ::v-deep uni-textarea {\r\n    margin-top: 60rpx;\r\n    width: 100%;\r\n    background-color: #ededed;\r\n  }\r\n  .submit-wraper {\r\n    margin-top: 60rpx;\r\n  }\r\n}\r\n</style>\r\n"],"names":["onLoad","options","log","propsOptions","setup","title","ref","images","reactive","inputInform","submitvisible","current","value","count","computed","length","chooseImage","index","success","chooseImageRes","tempFilePaths","tempFiles","filePath","url","name","formData","user","uploadFileRes","data","imgData","JSON","parse","push","onUpload","item","onInput","e","detail","onSubmit","resultImages","stringify","splice","params","account","content","then","code","msg","duration","_createBlock","_component_v_uni_view","class","$setup","_createVNode","_component_v_uni_text","_component_v_uni_scroll_view","_createElementBlock","_Fragment","onClick","key","_component_v_uni_image","mode","src","_component_v_uni_textarea","placeholder","maxlength","_component_v_uni_button","type","disabled"],"mappings":"iRAiDEA,OAAQ,SAAUC,WACRC,IAAI,aAAcD,QACrBE,aAAeF,GAEtBG,YACMC,EAAQC,EAAI,MACZC,EAASC,EAAS,CAAC,KACnBC,EAAcH,EAAI,IAClBH,EAAeG,EAAI,MACnBI,EAAgBJ,GAAI,KAElBG,GAAcE,YACVT,IAAI,gBAAiBS,GACG,KAA5BR,EAAaS,MAAMP,UAIPO,QADZD,UAOFE,EAAQC,GAAS,IAAML,EAAYG,MAAMG,eA6BvCC,EAAeC,MACH,CACdC,QAAUC,YACAjB,IAAI,oBAAqBiB,SAC3BC,cAAEA,YAAeC,GAAcF,UAC7BjB,IAAI,sBAAuBkB,EAAc,IA1BlC,EAACH,EAAOK,aACnBpB,IAAI,qBAAsBe,EAAOK,KAC1B,CACbC,IAAK,8CACLD,SAAAA,EACAE,KAAM,OACNC,SAAU,CACRC,KAAM,QAERR,QAAUS,YACAzB,IAAI,mBAAoByB,SAC1BC,KAAEA,GAASD,EACXE,EAAUC,KAAKC,MAAMH,WACnB1B,IAAI,WAAY2B,KACjBZ,GAASY,EAAQN,MACjBS,KAAK,YACJ9B,IAAI,WAAYe,QAWXA,EAAOG,EAAc,kBA0C9B,OACFR,MAAQT,EAAaS,MAAMP,MACb,MAAhBA,EAAMO,UACMA,OAAQ,MAGnB,CACLP,MAAAA,EACAI,YAAAA,EACAI,MAAAA,EACAN,OAAAA,EACAJ,aAAAA,EACAO,cAAAA,EACAuB,SAhDe,CAACC,EAAMjB,aACdf,IAAI,iBAAkBgC,EAAMjB,GAChCiB,KAGQjB,IA4CZkB,QA1CeC,YACPlC,IAAI,WAAYkC,KACZxB,MAAQwB,EAAEC,OAAOzB,OAyC7B0B,SAvCe,aACPpC,IAAI,oBAAqBG,EAAMO,eAC/BV,IAAI,mCAAoCO,EAAYG,aACtD2B,EAAeT,KAAKC,MAAMD,KAAKU,UAAUjC,YACvCL,IACN,yCACAqC,EAAaE,OAAOF,EAAaxB,OAAS,EAAG,YAEvCb,IAAI,uBAAwBqC,SAC9BG,EAAS,CACbC,QAASxC,EAAaS,MAAM+B,QAC5BtC,MAAOA,EAAMO,MACbgC,QAASnC,EAAYG,MACrBL,OAAQgC,KAECG,GAAQG,MAAMjB,IACA,MAAnBA,EAAKA,KAAKkB,QACE,CACZzC,MAAOuB,EAAKA,KAAKmB,IACjBC,SAAU,uFA/IpBC,EAyCOC,GAzCDC,MAAM,qCACV,WAA0BC,aAA1BH,EAECC,SAFKC,MAAM,qBACT,KAAAE,EAAwBC,mBAAlB,SAAGF,4CAEZC,EAAsDH,GAAhDC,MAAM,uBAAU,KAAAE,EAAyBC,mBAAnB,OAAA,kCAC5BD,EAiBcE,GAjBD,WAAS,OAAOJ,MAAM,sBACjC,KAAAE,EAeOH,GAfDC,MAAM,sBAIR,YAHFK,EAaOC,SAVmBL,WAAhBlB,EAAMjB,SAHhBgC,EAaOC,GAZLC,MAAM,eACLO,WAAON,WAASlB,EAAMjB,GAEtB0C,IAAK1C,eAEN,KAAAoC,EACCO,GADMC,KAAK,aAAcC,IAAK5B,MAAkBiB,MAAM,0BAG7CjB,GAAQkB,SAAOnC,UAAgBA,IAAgBmC,iBAFxDI,EAKA,cAJCL,MAAM,sBAEP,yEAMPE,EASEU,GARCC,kBAAuBZ,gDAKvBxC,MAAOwC,cACPjB,QAAOiB,UACPa,UAAW,+CAEdZ,EAECH,mBADE,KAAAG,EAA4BC,mBAAtB,SAAGF,SAAQ,4BAEpBC,EAIOH,GAJDC,MAAM,6BACV,KAAAE,EAESa,GAFAR,QAAON,WAAUe,KAAK,UAAWC,UAAWhB,6BAAe,OAAA"}