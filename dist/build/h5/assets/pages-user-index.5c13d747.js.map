{"version":3,"file":"pages-user-index.5c13d747.js","sources":["../../../../src/pages/components/InfoList.vue","../../../../src/pages/user/index.vue"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2022-03-01 13:17:37\r\n * @LastEditTime: 2022-04-21 22:19:45\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"info-list\">\r\n    <!-- <uni-list>\r\n      <uni-list-item\r\n        v-for=\"item in infoList\"\r\n        :key=\"item.id\"\r\n        :title=\"item.username\"\r\n        :note=\"item.title\"\r\n        :thumb=\"item.avatar\"\r\n        thumb-size=\"lg\"\r\n      ></uni-list-item>\r\n    </uni-list> -->\r\n    <view class=\"ul\">\r\n      <view class=\"li\" v-for=\"item in infoList\" :key=\"item.id\"  @click=\"goDetail(item)\">\r\n        <view class=\"comment\">\r\n          <svg class=\"replay-icon\" aria-hidden=\"true\">\r\n            <use xlink:href=\"#icon-pinglunhuifu\"></use>\r\n          </svg>\r\n          <view><text>{{item.comments || 0}}</text></view>\r\n        </view>\r\n        <view class=\"publish-info\">\r\n          <view class=\"title\">{{ item.title }} </view>\r\n          <view class=\"userinfo\">\r\n            <image\r\n              class=\"avatar\"\r\n              mode=\"aspectFit\"\r\n              :src=\"item.avatar || ''\"\r\n            ></image>\r\n            <text class=\"username\">{{ item.username }}</text>\r\n            <text class=\"update-time\"\r\n              >{{ $filters.commentTime(item.create_time || '') }}&nbsp;更新</text\r\n            >\r\n          </view>\r\n        </view>\r\n        <view class=\"img\">\r\n            <image\r\n              class=\"img-url\"\r\n              mode=\"aspectFit\"\r\n              :src=\"item.url || ''\"\r\n            ></image>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"infoList\",\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { ref, onMounted, watch } from \"vue\";\r\nconst props = defineProps({\r\n  list: {\r\n    type: Array,\r\n    default: [],\r\n  },\r\n  activeIndex: {\r\n    type: Number,\r\n    default: 0\r\n  }\r\n});\r\nlet infoList = ref([]);\r\n\r\nconst goDetail = (item) => {\r\n  console.log('item=', item)\r\n  if(props.activeIndex === 0){\r\n    uni.navigateTo({\r\n    url: `/pages/user/info/PublicDetail?id=${item.id}&hobby=${item.hobby}`\r\n  });\r\n  } else {\r\n    uni.navigateTo({\r\n      url: `/pages/user/info/LikeDetail?id=${item.id}&hobby=${item.hobby}`\r\n    });\r\n  }\r\n}\r\n\r\nwatch(\r\n  () => props.list,\r\n  (state) => {\r\n    console.log(\"state=\", state);\r\n    infoList.value = state;\r\n  },\r\n  {\r\n    deep: true,\r\n  }\r\n);\r\n\r\nonMounted(() => {\r\n  console.log(\"props=\", props);\r\n\r\n  // console.log(\"infoList.value=\", infoList.value);\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.li {\r\n  display: flex;\r\n  padding: 20rpx;\r\n  border-bottom: 1rpx solid #ccc;\r\n  .img{\r\n    margin-left: 20rpx;\r\n    width: 133rpx;\r\n    height: 100rpx;\r\n    .img-url{\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n.publish-info {\r\n  margin-left: 40rpx;\r\n  .title {\r\n    font-size: 36rpx;\r\n    font-weight: 600;\r\n    color: #363636;\r\n  }\r\n}\r\n\r\n.userinfo {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 24rpx;\r\n  color: #363636;\r\n  .avatar {\r\n    width: 50rpx;\r\n    height: 50rpx;\r\n    border-radius: 10rpx;\r\n  }\r\n  .username,\r\n  .update-time {\r\n    margin-left: 30rpx;\r\n  }\r\n}\r\n  .replay-icon{\r\n    width: 1.2rem;\r\n    height: 1.2rem;\r\n  }\r\n</style>\r\n","<!--\n * @Author: Aiden(戴林波)\n * @Date: 2021-12-17 17:52:36\n * @LastEditTime: 2022-04-21 10:52:51\n * @LastEditors: Aiden(戴林波)\n * @Description: \n * @Email: jason_dlb@sina.cn\n-->\n<template>\n  <view class=\"userinfo-wraper\">\n    <view class=\"userinfo\">\n      <view class=\"avatar-warper\" @click=\"onUserInfo\">\n        <image\n          :src=\"userInfo.avatar ? userInfo.avatar : defaultAvatar\"\n          class=\"avatar\"\n        ></image>\n        <text class=\"avatar-title\" v-if=\"!userInfo.avatar\">请上传图片</text>\n      </view>\n      <view class=\"userinfo-detail\">\n        <text>用户名：{{ userInfo.username }}</text>\n        <text>签&nbsp;&nbsp;名: {{ userInfo.motto }}</text>\n      </view>\n    </view>\n    <view class=\"fans-wraper\">\n      <view class=\"follows\"\n        @click=\"goFollows\"\n        ><text>关注</text>&nbsp;<text>{{ follows.length }}</text></view\n      >\n      <view class=\"fans\"\n        @click=\"goFans\"\n        ><text>粉丝</text>&nbsp;<text>{{ fans.length }}</text></view\n      >\n    </view>\n    <view class=\"publish-wraper\">\n      <view class=\"my-publishs\" @click=\"changeTab(0)\">\n        <text>我发布的</text>\n        <view :class=\"{ active: activeIndex === 0 }\"></view>\n      </view>\n      <view class=\"my-likes\" @click=\"changeTab(1)\">\n        <text>我喜欢的</text>\n        <view :class=\"{ active: activeIndex === 1 }\"></view>\n      </view>\n    </view>\n    <view>\n      <InfoList :list=\"publishs\" :activeIndex=\"activeIndex\"/>\n    </view>\n    <button @click=\"onLogout\" style=\"margin-top: 20rpx;\">退出</button>\n  </view>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watchEffect } from \"vue\";\nimport { useStore } from \"vuex\";\nimport { removeToken } from \"../../utils/auth\";\nimport { getFollows, getFans } from \"@/api/communication.js\";\nimport { getPublish, getMylikes } from \"@/api/publish.js\";\n\nimport InfoList from \"@/pages/components/InfoList.vue\";\n\nconst defaultAvatar = \"/static/images/default_avatar.png\";\nconst store = useStore();\nconst userInfo = computed(() => store.state.user.userInfo).value;\n\nconst onLogout = () => {\n  new Promise((resolve, reject) => {\n    removeToken();\n    resolve();\n  }).then(() => {\n    location.reload();\n  });\n};\n\nconst onUserInfo = () => {\n  uni.navigateTo({\n    url: \"/pages/user/info/index\",\n  });\n};\n\n// fans\nlet follows = ref([]);\nlet fans = ref([]);\nlet getFollowsData = () => {\n  getFollows().then((data) => {\n    console.log(\"getfollows =\", data);\n    if (data.data.code === 200) {\n      follows.value = data.data.follows;\n    }\n  });\n};\nlet getFansData = () => {\n  getFans().then((data) => {\n    console.log(\"getfans =\", data);\n    if (data.data.code === 200) {\n      fans.value = data.data.fans;\n    }\n  });\n};\n\nconst goFollows = () => {\n  const userids = []\n  for(let item of follows.value){\n    userids.push(item.follow_id)\n  }\n  uni.navigateTo({\n    url: `/pages/user/info/Follow?type=${0}&userids=${encodeURIComponent(JSON.stringify(userids))}`,\n  });\n}\n\nconst goFans = () => {\n  const userids = []\n  for(let item of fans.value){\n    userids.push(item.user_id)\n  }\n  uni.navigateTo({\n    url: `/pages/user/info/Follow?type=${1}&userids=${encodeURIComponent(JSON.stringify(userids))}`,\n  });\n}\n\n// publish\nlet activeIndex = ref(0);\nlet publishs = ref([]);\n\nconst getPublishData = () => {\n  publishs.value = []\n  getPublish().then((data) => {\n    console.log(\"data getPublish=\", data);\n    if (data.data.code === 200) {\n      publishs.value = data.data.data;\n    }\n  });\n};\n\n// 喜爱\nlet likes = ref([]);\nconst getMylikesData = () => {\n  publishs.value = []\n  getMylikes().then((data) => {\n    console.log(\"data likes=\", data);\n    if (data.data.code === 200) {\n      publishs.value = data.data.data;\n    }\n  });\n};\n\nconst changeTab = (flag) => {\n  activeIndex.value = flag;\n};\n\nwatchEffect(() => {\n  if (activeIndex.value === 0) {\n    getPublishData();\n  } else {\n    getMylikesData();\n  }\n}, activeIndex.value);\n\nonMounted(() => {\n  getFollowsData();\n  getFansData();\n  // getPublishData();\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.userinfo-wraper {\n  padding: 40rpx;\n}\n.userinfo {\n  display: flex;\n  .userinfo-detail {\n    padding-left: 20rpx;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n  }\n}\n.avatar-warper {\n  position: relative;\n}\n.avatar {\n  width: 150rpx;\n  height: 150rpx;\n  border-radius: 50%;\n}\n.avatar-title {\n  position: absolute;\n  left: 6%;\n  top: 50%;\n  transform: translateY(-50%);\n  font-size: 12rpx;\n}\n\n.fans-wraper {\n  display: flex;\n  justify-content: center;\n}\n.follows {\n}\n.fans {\n  margin-left: 20rpx;\n  padding-left: 20rpx;\n  position: relative;\n}\n.fans:before {\n  content: \"\";\n  height: 80%;\n  position: absolute;\n  top: 10%;\n  left: 0;\n  border-left: 1px solid #ccc;\n}\n.publish-wraper {\n  display: flex;\n  justify-content: center;\n  margin: 20rpx 0;\n  padding-top: 20rpx;\n  border-top: 1rpx solid #ccc;\n  // border-bottom: 1rpx solid #ccc;\n  .my-publishs,\n  .my-likes {\n    font-size: 28rpx;\n    position: relative;\n  }\n  .my-likes {\n    margin-left: 40rpx;\n  }\n  .active {\n    position: absolute;\n    left: 50%;\n    transform: translate(-50%, 0);\n    bottom: -10rpx;\n    width: 100%;\n    height: 0.1875rem;\n    border-radius: 0.125rem;\n    background-color: #ff8200;\n  }\n}\n</style>\n"],"names":["name","infoList","ref","props","list","state","log","value","deep","item","activeIndex","url","id","hobby","store","useStore","userInfo","computed","user","onLogout","Promise","resolve","reject","then","reload","onUserInfo","follows","fans","goFollows","userids","push","follow_id","encodeURIComponent","JSON","stringify","goFans","user_id","publishs","changeTab","flag","data","code"],"mappings":"wZAuDA,QAAe,CACbA,KAAM,qIAgBJC,EAAWC,EAAI,cAgBjB,IAAMC,EAAMC,OACXC,YACSC,IAAI,SAAUD,KACbE,MAAQF,IAEnB,CACEG,MAAM,OAIA,aACAF,IAAI,SAAUH,2cAzBP,CAACM,YACRH,IAAI,QAASG,GACI,IAAtBN,EAAMO,cACQ,CACfC,IAAK,oCAAoCF,EAAKG,YAAYH,EAAKI,YAGhD,CACbF,IAAK,kCAAkCF,EAAKG,YAAYH,EAAKI,m8BCtB7DC,EAAQC,IACRC,EAAWC,GAAS,IAAMH,EAAMT,MAAMa,KAAKF,WAAUT,MAErDY,EAAW,SACXC,SAAQ,CAACC,EAASC,gBAGnBC,MAAK,cACGC,aAIPC,EAAa,OACF,CACbd,IAAK,gCAKLe,EAAUxB,EAAI,IACdyB,EAAOzB,EAAI,UAkBT0B,EAAY,WACVC,EAAU,WACRpB,KAAQiB,EAAQnB,QACduB,KAAKrB,EAAKsB,aAEL,CACbpB,IAAK,0CAA6CqB,mBAAmBC,KAAKC,UAAUL,SAIlFM,EAAS,WACPN,EAAU,WACRpB,KAAQkB,EAAKpB,QACXuB,KAAKrB,EAAK2B,WAEL,CACbzB,IAAK,0CAA6CqB,mBAAmBC,KAAKC,UAAUL,aAKpFnB,EAAcR,EAAI,GAClBmC,EAAWnC,EAAI,MAaH,UAWVoC,EAAaC,MACLhC,MAAQgC,aAGV,KACgB,IAAtB7B,EAAYH,SA1BPA,MAAQ,OACJgB,MAAMiB,YACTlC,IAAI,mBAAoBkC,GACT,MAAnBA,EAAKA,KAAKC,SACHlC,MAAQiC,EAAKA,KAAKA,aAQtBjC,MAAQ,OACJgB,MAAMiB,YACTlC,IAAI,cAAekC,GACJ,MAAnBA,EAAKA,KAAKC,SACHlC,MAAQiC,EAAKA,KAAKA,YAe9B9B,EAAYH,UAEL,SA1EKgB,MAAMiB,YACTlC,IAAI,eAAgBkC,GACL,MAAnBA,EAAKA,KAAKC,SACJlC,MAAQiC,EAAKA,KAAKd,gBAKpBH,MAAMiB,YACNlC,IAAI,YAAakC,GACF,MAAnBA,EAAKA,KAAKC,SACPlC,MAAQiC,EAAKA,KAAKb,oOAlCP"}