var e=Object.defineProperty,o=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,n=(o,a,t)=>a in o?e(o,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[a]=t,r=(e,o)=>{for(var a in o||(o={}))l.call(o,a)&&n(e,a,o[a]);if(t)for(var a of t(o))s.call(o,a)&&n(e,a,o[a]);return e};import{Z as c,T as i,S as d,ao as u,z as p,a8 as m,U as f,o as h,c as v,w as g,e as C,J as _,K as b,G as y,I as w,D as j,E as x,M as P,N as I,ap as O,O as k,P as N,Q as V,W as D,a6 as F,an as M,a9 as U,ae as S,ah as $}from"./vendor.99a7c6c2.js";import{_ as G,a as R}from"./uni-forms.3a8f3d88.js";import{r as E}from"./uni-app.es.4451f765.js";import{_ as J}from"./PickerRegion.25d83b9d.js";import{h as L}from"./index.203acf82.js";import{_ as T}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.e12d4142.js";var q=T({setup(e){const t=c();let l=i((()=>t.state.user.userInfo)).value,s=d({avatar:l.avatar,username:l.username,gender:l.gender,birthday:l.birthday,location:{provinceCode:l.location&&l.location.provinceCode,cityCode:l.location&&l.location.cityCode},hometown:{provinceCode:l.hometown&&l.hometown.provinceCode,cityCode:l.hometown&&l.hometown.cityCode},schoolName:l.schoolName,job:l.job,motto:l.motto,photos:l.photos}),n={username:{rules:[{required:!0,errorMessage:"请输入昵称"}]}};u("schoolUpdate",(function(e){s.schoolName=e.schoolName}));const T=p(null),q=e=>{console.log("form=e==",e),T.value.validate().then((e=>{console.log("表单数据信息：",e);const l={form:(s=r({},e),n={photos:K},o(s,a(n)))};var s,n;L(l).then((e=>{console.log("data======",e),t.dispatch("user/GetUserInfo").then((()=>{I({url:"/pages/user/info/index"})}))}))})).catch((e=>{console.log("表单错误信息：",e)}))},z="/static/images/default_avatar.png";let K=d(l.photos);m(K,((e,o)=>{console.log("images",e),s.photos=e}));console.log("images===",K);const Q=p(l.avatar);m(Q,((e,o)=>{s.avatar=e}));const W=e=>{S({success:o=>{console.log("chooseImageRes===",o);const{tempFilePaths:a,tempFiles:t}=o;console.log("tempFilePaths[0]===",a[0]),((e,o)=>{$({url:"/prod/users/uploadFile",filePath:o,name:"file",formData:{user:"test"},success:o=>{console.log("uploadFileRes===",o);const{data:a}=o,t=JSON.parse(a);console.log("imgData=",t),K[e]=t.url,console.log("index===",e),0===e&&(Q.value=t.url)}})})(e,a[0])}})},Y=e=>{const o=new Date;let a=o.getFullYear(),t=o.getMonth()+1,l=o.getDate();return"start"===e?a-=60:"end"===e&&(a+=2),t=t>9?t:"0"+t,l=l>9?l:"0"+l,`${a}-${t}-${l}`},Z=Y({format:!0});console.log("currentDate===",Z),s.birthday=Z;let A=Y("start"),B=Y("end");const H=e=>{s.birthday=e.detail.value},X=()=>{O({itemList:["男","女"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮")},fail:function(e){console.log(e.errMsg)}})},ee=e=>{console.log("obj=====",e);const{provinceCode:o,cityCode:a}=e;s.location.provinceCode=o,s.location.cityCode=a},oe=e=>{console.log("obj.home=====",e);const{provinceCode:o,cityCode:a}=e;s.hometown.provinceCode=o,s.hometown.cityCode=a},ae=()=>{I({url:"/pages/user/info/School"})};let te=p(["IT/互联网/通信","金融","工业制造业","教育/科研","公共事业单位","医药/健康","媒体/公关","影视/娱乐","零售","餐饮/酒店","其他"]),le=p(0);const se=e=>{const{detail:{value:o}}=e;le.value=o,s.job=te.value[o]};return(e,o)=>{const a=k,t=E(f("uni-forms-item"),G),r=N,c=V,i=D,d=F,u=M,p=E(f("uni-forms"),R),m=U;return h(),v(r,{class:"userinfo-wraper"},{default:g((()=>[C(p,{ref_key:"form",ref:T,modelValue:y(s),rules:y(n)},{default:g((()=>[C(r,{class:"userinfo"},{default:g((()=>[C(t,{name:"avatar"},{default:g((()=>[C(a,{src:Q.value?Q.value:z,class:"avatar"},null,8,["src"])])),_:1})])),_:1}),C(r,{class:"info-item"},{default:g((()=>[C(r,{class:"title-wraper"},{default:g((()=>[C(c,{class:"title"},{default:g((()=>[_("个人照片")])),_:1}),C(c,null,{default:g((()=>{return[_("("+b((e=y(K),e.filter((e=>e)).length))+"/"+b(y(K).length)+")",1)];var e})),_:1})])),_:1}),w(' <uni-forms-item name="photos"> '),C(i,{"scroll-x":"true",class:"photos"},{default:g((()=>[C(r,{class:"photos"},{default:g((()=>[(h(!0),j(P,null,x(y(K),((e,o)=>(h(),v(r,{class:"photo-wraper",onClick:a=>((e,o)=>{if(console.log("item, index===",e,o),e){let a=["编辑"];return o>0&&(a=["设为头像","编辑","删除"]),void O({itemList:a,success:function(a){if(console.log("选中了第"+(a.tapIndex+1)+"个按钮"),0===a.tapIndex)return K[o]=K[0],K[0]=e,void(Q.value=e);1!==a.tapIndex?2===a.tapIndex&&K.splice(o,1):W(o)},fail:function(e){console.log(e.errMsg)}})}W(o)})(e,o),key:o},{default:g((()=>[C(a,{mode:"aspectFill",src:e||z,class:"photo"},null,8,["src"]),!e&&y(K)[o-1]||0===o&&!y(K)[0]?(h(),v(c,{key:0,class:"photo-add"},{default:g((()=>[_("+")])),_:1})):w("v-if",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),w(" </uni-forms-item> ")])),_:1}),C(r,{class:"info-item"},{default:g((()=>[C(r,{class:"title-wraper"},{default:g((()=>[C(c,{class:"title"},{default:g((()=>[_("个人签名")])),_:1})])),_:1}),C(t,{name:"motto"},{default:g((()=>[C(d,{modelValue:y(s).motto,"onUpdate:modelValue":o[0]||(o[0]=e=>y(s).motto=e),type:"text",placeholder:"请输入个人签名"},null,8,["modelValue"])])),_:1})])),_:1}),C(r,{class:"info-item"},{default:g((()=>[C(r,{class:"title-wraper"},{default:g((()=>[C(c,{class:"title"},{default:g((()=>[_("基础信息")])),_:1})])),_:1}),w(' <view class="base-item">\r\n        <text>昵称</text>\r\n        <input type="text" placeholder="请输入昵称" />\r\n      </view> '),C(t,{label:"昵称",name:"username"},{default:g((()=>[C(d,{class:"input",modelValue:y(s).username,"onUpdate:modelValue":o[1]||(o[1]=e=>y(s).username=e),type:"text",placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),C(t,{label:"性别",name:"gender"},{default:g((()=>[w(" <text>性别</text> "),C(r,{onClick:X},{default:g((()=>[_(b(e.$filters.filterGender(y(l).gender)),1)])),_:1})])),_:1}),C(t,{label:"出生日期",name:"birthday"},{default:g((()=>[C(u,{mode:"date",value:y(s).birthday,start:y(A),end:y(B),onChange:H},{default:g((()=>[C(r,{class:"uni-input"},{default:g((()=>[_(b(y(s).birthday),1)])),_:1})])),_:1},8,["value","start","end"])])),_:1}),C(t,{label:"所在地",name:"location"},{default:g((()=>[C(J,{propsProvinceCode:y(s).location.provinceCode,propsCityCode:y(s).location.cityCode,onChange:ee},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),C(t,{label:"家乡",name:"hometown"},{default:g((()=>[C(J,{propsProvinceCode:y(s).hometown.provinceCode,propsCityCode:y(s).hometown.cityCode,onChange:oe},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),C(t,{label:"学校",name:"schoolName"},{default:g((()=>[C(r,{onClick:ae},{default:g((()=>[_(b(y(s).schoolName?y(s).schoolName:"请选择学校"),1)])),_:1})])),_:1}),C(t,{label:"职业",name:"job"},{default:g((()=>[C(u,{range:y(te),value:y(le),onChange:se},{default:g((()=>[C(r,{class:"uni-input"},{default:g((()=>[_(b(y(s).job?y(s).job:"请选择职业"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1})])),_:1},8,["modelValue","rules"]),C(m,{onClick:q},{default:g((()=>[_("保存")])),_:1}),w(" end ")])),_:1})}}},[["__scopeId","data-v-3d243936"]]);export{q as default};
//# sourceMappingURL=pages-user-info-Editor.c2fb73df.js.map
