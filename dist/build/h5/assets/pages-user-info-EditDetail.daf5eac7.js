import{y as e,x as o,r as a,o as t,b as s,e as l,g as n,d as c,i,t as u,c as d,F as r,f as p,h as f,H as m,ah as h,L as b,al as y,$ as g,a4 as v,aD as _,a3 as I,p as k,m as x,q as C,S as V,I as j,V as w,z as T,Y as F,a5 as L}from"./index.11d2ceab.js";import{_ as z,a as P}from"./uni-forms.a3496f8c.js";import{r as q}from"./uni-app.es.5a7a6d60.js";import{l as D}from"./index.0b6b4e02.js";import{b as S}from"./hobby.8ad864fb.js";import{u as B,b as E}from"./publish.f83e46c8.js";import{C as H}from"./Comment.1ff114e1.js";import{V as U}from"./VideoPlayer.8294b62a.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.393c2286.js";import"./communication.cab9d041.js";var O=M({components:{Comment:H,VideoPlayer:U},onLoad:function(e){console.log("options===",e)},onReady:function(){},setup(s){console.log("props=",s);const l=m();e((()=>l.state.user.userInfo)).value;const n=o({poster:"",src:""});let c=a([{content:"https://social-1308251497.cos.ap-guangzhou.myqcloud.com/images/4.jfif"}]);a(0),a("default");let i=a({});let u=a(null),d=a(["编辑","删除"]),r=a(0);const p=a([]),f=a(null);return t((()=>{(e=>{const{id:o,hobby:a}=e;S({id:o,hobby:a}).then((e=>{200===e.data.code&&(i.value=e.data.data,u.value=h(e.data.data.create_time),e.data.data.video_url||(p.value=i.value.photos.map(((e,o)=>({path:e})))),n.poster=e.data.data.url,n.src=e.data.data.video_url)}))})({id:s.id,hobby:s.hobby})})),{hobbyInfo:i,photos:p,info:c,publishDate:u,options:n,goBack:()=>{b({url:"/pages/user/index"})},onEdit:(e,o)=>{console.log("item, index===",e,o),y({itemList:d,success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮"),r.value=e.tapIndex,1===r.value?(e=>{p.value.length<=1?L({content:"至少需要发布一张图片",confirmText:"知道了",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}}):(p.value.splice(e,1),console.log("photos.value===========",p.value))})(o):(e=>{g({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(o){const{tempFiles:a}=o;p.value[e]=a[0]}})})(o)},fail:function(e){console.log(e.errMsg)}})},operations:d,activeOperationIndex:r,addImage:()=>{g({count:6,sizeType:["original","compressed"],sourceType:["album"],success:function(e){console.log("res===",e);const{tempFiles:o}=e;p.value=p.value.concat(o),console.log("photos.value====",p.value)}})},form:f,changeTitle:e=>{const{detail:o}=e;i.value.title.value=o},changeContent:e=>{const{detail:o}=e;i.value.content.value=o},submit:()=>{f.value.validate().then((async e=>{console.log("表单数据信息：",e);const{title:o,content:a}=e;if(console.log("photos=====",p.value),p.value.length<=0){const e={title:o,id:parseInt(s.id),hobby:parseInt(s.hobby),content:a};return void B(e).then((e=>{200===e.data.code&&(v({title:e.data.msg,duration:2e3}),b({url:"/pages/user/index",success(){let e=_().pop();console.log("page==============",e),e&&e.onLoad()}}))}))}const t=p.value.map(((e,o)=>({key:e,index:o}))),l=t.filter((e=>e.key.path.includes("social-1308251497"))),n=t.filter((e=>e.key.path.includes("blob:"))),c=[];for(let s of n){const e=await I(s.key,"base64");c.push({index:s.index,filename:s.key.name,chunk:e})}const u=i.value.photos[0].match(/myqcloud.com\/(\S*)/)[1].match(/(\S*)\//)[1],d=l.map((e=>({index:e.index,path:e.key.path}))),r={uploadHash:u,uploadFiles:c.length>0?c:[],remotePhotos:d.length>0?d:[],title:o,id:parseInt(s.id),hobby:parseInt(s.hobby),content:a};E(D.stringify(r)).then((e=>{200===e.data.code&&(v({title:e.data.msg,duration:2e3}),b({url:"/pages/user/index",success(){let e=_().pop();console.log("page==============",e),e&&e.onLoad()}})),console.log("data=",e)}))})).catch((e=>{console.log("表单错误信息：",e)}))}}}},[["render",function(e,o,a,t,m,h){const b=k,y=x,g=C,v=V,_=j("VideoPlayer"),I=w,L=q(T("uni-forms-item"),z),D=j("Comment"),S=q(T("uni-forms"),P),B=F;return s(),l("div",{class:"hobby-detail"},[n(S,{ref:"form",modelValue:t.hobbyInfo},{default:c((()=>[n(b,{class:"author-wraper"},{default:c((()=>[n(b,{class:"author"},{default:c((()=>[n(b,{onClick:t.goBack},{default:c((()=>[i("返回")])),_:1},8,["onClick"]),n(b,{class:"author-info"},{default:c((()=>[n(y,{class:"avatar",mode:"aspectFit",src:t.hobbyInfo.avatar||""},null,8,["src"]),n(g,null,{default:c((()=>[i(u(t.hobbyInfo.username||""),1)])),_:1})])),_:1})])),_:1})])),_:1}),0===t.hobbyInfo.fileType?(s(),d(v,{key:0,"scroll-x":"true",class:"photos"},{default:c((()=>[n(b,{class:"photos"},{default:c((()=>[(s(!0),l(r,null,p(t.photos,((e,o)=>(s(),d(b,{class:"photo-wraper",key:o},{default:c((()=>[n(y,{mode:"aspectFill",src:e.path,class:"photo",onClick:a=>t.onEdit(e,o)},null,8,["src","onClick"])])),_:2},1024)))),128)),n(b,{class:"photo-add-wraper",onClick:t.addImage},{default:c((()=>[n(g,{class:"photo-add"},{default:c((()=>[i("+")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})):f("v-if",!0),1===t.hobbyInfo.fileType?(s(),d(b,{key:1,class:"swiper-box"},{default:c((()=>[n(b,{class:"swiper-item"},{default:c((()=>[(s(),d(_,{options:{src:t.hobbyInfo.video_url,poster:t.hobbyInfo.url},key:t.hobbyInfo.id},null,8,["options"]))])),_:1})])),_:1})):f("v-if",!0),n(b,{class:"content-wraper"},{default:c((()=>[n(b,{class:"content"},{default:c((()=>[n(b,{class:"title"},{default:c((()=>[n(L,{name:"title"},{default:c((()=>[n(I,{modelValue:t.hobbyInfo.title,"onUpdate:modelValue":o[0]||(o[0]=e=>t.hobbyInfo.title=e),type:"text",placeholder:"请输入文本",onConfirm:t.changeTitle},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),n(b,{class:"main"},{default:c((()=>[n(L,{name:"content"},{default:c((()=>[n(I,{modelValue:t.hobbyInfo.content,"onUpdate:modelValue":o[1]||(o[1]=e=>t.hobbyInfo.content=e),type:"text",placeholder:"请输入文本",onConfirm:t.changeContent},null,8,["modelValue","onConfirm"])])),_:1})])),_:1}),n(b,{class:"publish-date"},{default:c((()=>[n(g,null,{default:c((()=>[i("发布于: ")])),_:1}),n(g,null,{default:c((()=>[i(u(t.publishDate),1)])),_:1})])),_:1})])),_:1})])),_:1}),n(b,{class:"comment-wraper"},{default:c((()=>[t.hobbyInfo.id?(s(),d(D,{hobbyInfo:t.hobbyInfo,key:t.hobbyInfo.id},null,8,["hobbyInfo"])):f("v-if",!0)])),_:1})])),_:1},8,["modelValue"]),n(b,{class:"submit-wraper"},{default:c((()=>[n(B,{onClick:t.submit,class:"submit"},{default:c((()=>[i("发 布")])),_:1},8,["onClick"])])),_:1})])}],["__scopeId","data-v-20538578"]]);export{O as default};
//# sourceMappingURL=pages-user-info-EditDetail.daf5eac7.js.map
