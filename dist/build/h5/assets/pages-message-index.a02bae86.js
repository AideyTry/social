import{l as a,r as e,o as s,aa as t,c as o,d as l,e as n,g as r,h as c,F as u,E as d,s as g,ab as i,C as f,D as h,x as m,f as p,i as _,t as v,q as C,y as w,v as N}from"./index.caabeb3a.js";import{C as b}from"./ChatContent.d2d8dfd6.js";import{_ as D}from"./plugin-vue_export-helper.21dcd24c.js";var I=D({components:{ChatContent:b},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const o=d(),l=a((()=>o.state.user.userInfo)).value,n=e([]),r=()=>{i.getAllConversationList().then((({data:a})=>{console.log("会话总数data====",JSON.parse(a)),n.value=JSON.parse(a),c()})).catch((a=>{console.log("err=",a)}))},c=()=>{i.getTotalUnreadMsgCount().then((({data:a})=>{console.log("data===",a),console.log("Number(data)=",Number(a)),Number(a)>0?f({index:2,text:"···"}):h({index:2})})).catch((a=>{console.log("err=",a)}))};return s((()=>{((a,e)=>{console.log("userID, token=====================",a,e);const s={userID:a,token:e,url:"wss://mancao.social:20038",platformID:5};i.login(s).then((a=>{console.log("login suc...",a),0===a.errCode&&r()})).catch((a=>{console.log("login failed...",a)}))})(l.phone,t()),i.on("OnRecvNewMessage",(a=>{101===JSON.parse(a.data).contentType&&r()}))})),{defaultAvatar:"/static/images/default_avatar.png",convers:n,goChat:a=>{console.log("item=",a),g({url:`/pages/message/Chat?userID=${a.userID}&title=${a.showName}`})},showLastMessage:a=>JSON.parse(a).content,getAllConversationList:r}}},[["render",function(a,e,s,t,d,g){const i=w,f=N,h=m;return o(),l(h,null,{default:n((()=>[(o(!0),r(u,null,c(t.convers,(e=>(o(),l(h,{key:e.userID,class:"conver",onClick:a=>t.goChat(e)},{default:n((()=>[p(h,{class:"conver-msg"},{default:n((()=>[p(h,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[p(i,{src:e.faceURL&&e.faceURL.includes("https://")?e.faceURL:t.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),e.unreadCount?(o(),l(h,{key:0,class:"unread-total"},{default:n((()=>[p(f,null,{default:n((()=>[_(v(e.unreadCount),1)])),_:2},1024)])),_:2},1024)):C("v-if",!0)])),_:2},1024),p(h,{class:"content-wraper"},{default:n((()=>[p(f,null,{default:n((()=>[_(v(e.showName),1)])),_:2},1024),p(f,null,{default:n((()=>[_(v(t.showLastMessage(e.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),p(f,{class:"conver-time"},{default:n((()=>[_(v(a.$filters.formatMsgDate(e.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-64a59283"]]);export{I as default};
//# sourceMappingURL=pages-message-index.a02bae86.js.map
