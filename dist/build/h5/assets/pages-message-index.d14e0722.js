import{Z as e,T as a,z as s,A as o,o as t,c as l,w as n,D as r,E as c,M as u,N as d,ak as g,al as i,P as f,e as m,J as p,K as h,I as v,O as _,Q as C}from"./vendor.ada0ecfb.js";import{o as I}from"./openIM.fd559ab0.js";import{g as N}from"./index.db753edd.js";import{C as w}from"./ChatContent.216adb98.js";import{_ as b}from"./plugin-vue_export-helper.21dcd24c.js";var D=b({components:{ChatContent:w},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const t=e(),l=a((()=>t.state.user.userInfo)).value;let n=s(null);const r=s([]),c=()=>{I.getAllConversationList().then((({data:e})=>{console.log("data====",JSON.parse(e)),r.value=JSON.parse(e),m()})).catch((e=>{console.log("err=",e)}))},u=(e,a)=>{console.log("userID, token=====================",e,a);const s={userID:e,token:a,url:"wss://mancao.social:20038",platformID:5};I.login(s).then((e=>{console.log("login suc...",e),0===e.errCode&&(c(),I.on("OnTotalUnreadMessageCountChanged",(e=>{console.log("data unredd=================",e)}))),n.value=e.operationID})).catch((e=>{console.log("login failed...",e)}))};let f=s("");const m=()=>{I.getTotalUnreadMsgCount().then((({data:e})=>{console.log("data===",e),console.log("Number(data)=",Number(e)),f.value=Number(e),Number(e)>0?g({index:2,text:"···"}):i({index:2})})).catch((e=>{console.log("err=",e)}))};return o((()=>{u(l.phone,N()),I.on("OnRecvNewMessage",(e=>{101===JSON.parse(e.data).contentType&&c()}))})),{defaultAvatar:"/static/images/default_avatar.png",operationID:n,convers:r,unReadTotal:f,goChat:e=>{console.log("item=",e),d({url:`/pages/message/Chat?userID=${e.userID}&title=${e.showName}`})},showLastMessage:e=>JSON.parse(e).content,getAllConversationList:c}}},[["render",function(e,a,s,o,d,g){const i=_,I=C,N=f;return t(),l(N,null,{default:n((()=>[(t(!0),r(u,null,c(o.convers,(a=>(t(),l(N,{key:a.userID,class:"conver",onClick:e=>o.goChat(a)},{default:n((()=>[m(N,{class:"conver-msg"},{default:n((()=>[m(N,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[m(i,{src:a.faceURL&&a.faceURL.includes("https://")?a.faceURL:o.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),o.unReadTotal?(t(),l(N,{key:0,class:"unread-total"},{default:n((()=>[m(I,null,{default:n((()=>[p(h(o.unReadTotal),1)])),_:1})])),_:1})):v("v-if",!0)])),_:2},1024),m(N,{class:"content-wraper"},{default:n((()=>[m(I,null,{default:n((()=>[p(h(a.showName),1)])),_:2},1024),m(I,null,{default:n((()=>[p(h(o.showLastMessage(a.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(I,{class:"conver-time"},{default:n((()=>[p(h(e.$filters.commentTime(a.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-1f8c2f6c"]]);export{D as default};
//# sourceMappingURL=pages-message-index.d14e0722.js.map
