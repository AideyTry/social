import{y as e,x as o,as as a,aw as t,r as l,Q as s,b as n,c as r,d as c,g as i,i as d,t as u,u as m,h as p,e as f,f as h,F as g,H as v,ax as C,k as _,al as y,m as b,z as x,p as w,q as j,S as k,V as I,au as V,Y as F,$ as N,a2 as P}from"./index.11d2ceab.js";import{_ as D,a as M}from"./uni-forms.a3496f8c.js";import{r as Y}from"./uni-app.es.5a7a6d60.js";import{_ as $}from"./PickerRegion.df5e7d74.js";import{_ as U}from"./plugin-vue_export-helper.21dcd24c.js";import"./uni-icons.393c2286.js";var R=U({setup(U){const R=v();let S=e((()=>R.state.user.userInfo)).value,q=o({avatar:S.avatar,username:S.username,gender:S.gender,birthday:a(S.birthday).format("YYYY-MM-DD"),location:{provinceCode:S.location&&S.location.provinceCode,cityCode:S.location&&S.location.cityCode},hometown:{provinceCode:S.hometown&&S.hometown.provinceCode,cityCode:S.hometown&&S.hometown.cityCode},schoolName:S.schoolName,job:S.job,motto:S.motto,photos:S.photos}),G={username:{rules:[{required:!0,errorMessage:"请输入昵称"}]}};t("schoolUpdate",(function(e){q.schoolName=e.schoolName}));const L=l(null),z=e=>{console.log("form=e==",e),L.value.validate().then((e=>{console.log("表单数据信息：",e);const o={form:{...e,photos:J}};C(o).then((e=>{console.log("data======",e),R.dispatch("user/GetUserInfo").then((()=>{_({url:"/pages/user/info/index"})}))}))})).catch((e=>{console.log("表单错误信息：",e)}))},H="/static/images/default_avatar.png";let J=o(S.photos);s(J,((e,o)=>{console.log("images",e),q.photos=e}));console.log("images===",J);const O=l(S.avatar);s(O,((e,o)=>{q.avatar=e}));const Q=e=>{N({success:o=>{console.log("chooseImageRes===",o);const{tempFilePaths:a,tempFiles:t}=o;console.log("tempFilePaths[0]===",a[0]),((e,o)=>{P({url:"https://mancao.social/prod/users/uploadFile",filePath:o,name:"file",formData:{user:"test"},success:o=>{console.log("uploadFileRes===",o);const{data:a}=o,t=JSON.parse(a);console.log("imgData=",t),J[e]=t.url,console.log("index===",e),0===e&&(O.value=t.url)}})})(e,a[0])}})},T=e=>{const o=new Date;let a=o.getFullYear(),t=o.getMonth()+1,l=o.getDate();return"start"===e?a-=60:"end"===e&&(a+=2),t=t>9?t:"0"+t,l=l>9?l:"0"+l,`${a}-${t}-${l}`},A=T({format:!0});console.log("currentDate===",A);let B=T("start"),E=T("end");const K=e=>{q.birthday=e.detail.value},W=()=>{y({itemList:["男","女"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮")},fail:function(e){console.log(e.errMsg)}})},X=e=>{console.log("obj=====",e);const{provinceCode:o,cityCode:a}=e;q.location.provinceCode=o,q.location.cityCode=a},Z=e=>{console.log("obj.home=====",e);const{provinceCode:o,cityCode:a}=e;q.hometown.provinceCode=o,q.hometown.cityCode=a},ee=()=>{_({url:"/pages/user/info/School"})};let oe=l(["IT/互联网/通信","金融","工业制造业","教育/科研","公共事业单位","医药/健康","媒体/公关","影视/娱乐","零售","餐饮/酒店","其他"]),ae=l(0);const te=e=>{const{detail:{value:o}}=e;ae.value=o,q.job=oe.value[o]};return(e,o)=>{const a=b,t=Y(x("uni-forms-item"),D),l=w,s=j,v=k,C=I,_=V,N=Y(x("uni-forms"),M),P=F;return n(),r(l,{class:"userinfo-wraper"},{default:c((()=>[i(N,{ref_key:"form",ref:L,modelValue:m(q),rules:m(G)},{default:c((()=>[i(l,{class:"userinfo"},{default:c((()=>[i(t,{name:"avatar"},{default:c((()=>[i(a,{src:O.value?O.value:H,class:"avatar"},null,8,["src"])])),_:1})])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("个人照片")])),_:1}),i(s,null,{default:c((()=>{return[d("("+u((e=m(J),e.filter((e=>e)).length))+"/"+u(m(J).length)+")",1)];var e})),_:1})])),_:1}),p(' <uni-forms-item name="photos"> '),i(v,{"scroll-x":"true",class:"photos"},{default:c((()=>[i(l,{class:"photos"},{default:c((()=>[(n(!0),f(g,null,h(m(J),((e,o)=>(n(),r(l,{class:"photo-wraper",onClick:a=>((e,o)=>{if(console.log("item, index===",e,o),e){let a=["编辑"];return o>0&&(a=["设为头像","编辑","删除"]),void y({itemList:a,success:function(a){if(console.log("选中了第"+(a.tapIndex+1)+"个按钮"),0===a.tapIndex)return J[o]=J[0],J[0]=e,void(O.value=e);1!==a.tapIndex?2===a.tapIndex&&J.splice(o,1):Q(o)},fail:function(e){console.log(e.errMsg)}})}Q(o)})(e,o),key:o},{default:c((()=>[i(a,{mode:"aspectFill",src:e||H,class:"photo"},null,8,["src"]),!e&&m(J)[o-1]||0===o&&!m(J)[0]?(n(),r(s,{key:0,class:"photo-add"},{default:c((()=>[d("+")])),_:1})):p("v-if",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),p(" </uni-forms-item> ")])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("个人签名")])),_:1})])),_:1}),i(t,{name:"motto"},{default:c((()=>[i(C,{modelValue:m(q).motto,"onUpdate:modelValue":o[0]||(o[0]=e=>m(q).motto=e),type:"text",placeholder:"请输入个人签名"},null,8,["modelValue"])])),_:1})])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("基础信息")])),_:1})])),_:1}),p(' <view class="base-item">\r\n        <text>昵称</text>\r\n        <input type="text" placeholder="请输入昵称" />\r\n      </view> '),i(t,{label:"昵称",name:"username"},{default:c((()=>[i(C,{class:"input",modelValue:m(q).username,"onUpdate:modelValue":o[1]||(o[1]=e=>m(q).username=e),type:"text",placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),i(t,{label:"性别",name:"gender"},{default:c((()=>[p(" <text>性别</text> "),i(l,{onClick:W},{default:c((()=>[d(u(e.$filters.filterGender(m(S).gender)),1)])),_:1})])),_:1}),i(t,{label:"出生日期",name:"birthday"},{default:c((()=>[i(_,{mode:"date",value:m(q).birthday,start:m(B),end:m(E),onChange:K},{default:c((()=>[i(l,{class:"uni-input"},{default:c((()=>[d(u(m(q).birthday),1)])),_:1})])),_:1},8,["value","start","end"])])),_:1}),i(t,{label:"所在地",name:"location"},{default:c((()=>[i($,{propsProvinceCode:m(q).location.provinceCode,propsCityCode:m(q).location.cityCode,onChange:X},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),i(t,{label:"家乡",name:"hometown"},{default:c((()=>[i($,{propsProvinceCode:m(q).hometown.provinceCode,propsCityCode:m(q).hometown.cityCode,onChange:Z},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),i(t,{label:"学校",name:"schoolName"},{default:c((()=>[i(l,{onClick:ee},{default:c((()=>[d(u(m(q).schoolName?m(q).schoolName:"请选择学校"),1)])),_:1})])),_:1}),i(t,{label:"职业",name:"job"},{default:c((()=>[i(_,{range:m(oe),value:m(ae),onChange:te},{default:c((()=>[i(l,{class:"uni-input"},{default:c((()=>[d(u(m(q).job?m(q).job:"请选择职业"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1})])),_:1},8,["modelValue","rules"]),i(P,{onClick:z},{default:c((()=>[d("保存")])),_:1}),p(" end ")])),_:1})}}},[["__scopeId","data-v-70bfd651"]]);export{R as default};
//# sourceMappingURL=pages-user-info-Editor.7b07c180.js.map
