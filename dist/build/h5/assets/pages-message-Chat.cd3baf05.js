import{A as e,a0 as s,U as t,ab as a,B as n,a6 as o,a1 as r,o as l,c,w as u,e as i,a9 as g,Q as d}from"./vendor.ae4da609.js";import{o as m}from"./index.8cb8be1f.js";import{C as p}from"./ChatContent.f6dcb750.js";import{_ as f}from"./plugin-vue_export-helper.21dcd24c.js";var I=f({components:{ChatContent:p},onShow:function(e){this.currentDate=new Date+Math.random(),setTimeout((()=>{this.getConver()}),1e3)},setup(r){let l=e("");const c=e([]),u=s();console.log("store.state.user===========================================================================",u.getters["user/getUserInfo"]),t((()=>u.getters["user/getUserInfo"])).value;const i=()=>{const e={groupID:"",startClientMsgID:"",count:1e4,userID:r.userID};m.getHistoryMessageList(e).then((({data:e})=>{console.log("历史数据=",JSON.parse(e)),c.value=[...JSON.parse(e).reverse()]})).catch((e=>{console.log("err 000000000000000000000000000000000000000000=",e)}))};a((()=>c),((e,s)=>{const t=e.value.filter((e=>e.sendID===r.userID)).map((e=>e.clientMsgID)),a={userID:r.userID,msgIDList:t};m.markC2CMessageAsRead(a).then((({data:e})=>{console.log("传入已读=",e),m.markC2CMessageAsRead({userID:r.userID,msgIDList:[]})})).catch((e=>{console.log("err===",e)}))}),{deep:!0}),n((()=>{o({title:r.title}),i(),m.on("OnRecvNewMessage",(e=>{const s=JSON.parse(e.data);101===s.contentType&&c.value.unshift(s)})),m.on("OnRecvC2CReadReceipt",(e=>{JSON.parse(e.data).map((e=>{e.msgIDList.map((e=>{c.value.find((s=>{s.clientMsgID===e&&(s.isRead=!0)}))}))}))}))}));let g=e("");return{inputString:l,messageInfo:c,onConfirm:e=>{const{value:s}=e.detail;l.value=s;const t={title:"you have a new message",desc:"",ex:"",iOSPushSound:"",iOSBadgeCount:!1};m.createTextMessage(s).then((e=>{const s={recvID:r.userID,groupID:"",offlinePushInfo:t,message:e.data};m.sendMessage(s).then((({data:e,errCode:s})=>{const t=JSON.parse(e);c.value.unshift(t),l.value=""})).catch((e=>{console.log("err=",e)}))})).catch((e=>{console.log("text err=",e)}))},currentDate:g,getConver:i}}},[["render",function(e,s,t,a,n,o){const m=r("ChatContent"),p=g,f=d;return l(),c(f,{class:"chat-wraper"},{default:u((()=>[(l(),c(m,{key:a.currentDate,msgList:a.messageInfo},null,8,["msgList"])),i(f,{class:"send-msg"},{default:u((()=>[i(p,{type:"text",placeholder:"请输入消息",modelValue:a.inputString,"onUpdate:modelValue":s[0]||(s[0]=e=>a.inputString=e),class:"send",onConfirm:a.onConfirm},null,8,["modelValue","onConfirm"])])),_:1})])),_:1})}],["__scopeId","data-v-62f0652a"]]);export{I as default};
//# sourceMappingURL=pages-message-Chat.cd3baf05.js.map
