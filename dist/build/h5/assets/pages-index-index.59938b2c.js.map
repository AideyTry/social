{"version":3,"file":"pages-index-index.59938b2c.js","sources":["../../../../src/pages/index/WaterFall.vue","../../../../src/pages/index/McTabs.vue","../../../../src/pages/index/index.vue"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2022-02-24 14:06:50\r\n * @LastEditTime: 2022-06-22 15:44:04\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"waterfall\">\r\n    <view\r\n      class=\"waterfall-item\"\r\n      :style=\"{\r\n        top: item.top + 'rpx',\r\n        left: item.left + 'rpx',\r\n      }\"\r\n      v-for=\"item in waterfallList\"\r\n      :key=\"item.id\"\r\n      @click=\"goDetail(item)\"\r\n    >\r\n      <view class=\"waterfall-image-wrapper\">\r\n      <image\r\n        class=\"waterfall-image\"\r\n        mode=\"widthFix\"\r\n        :style=\"{ width: waterfallImageWidth + 'rpx' }\"\r\n        :src=\"item.src\"\r\n      ></image>\r\n     <!-- <svg class=\"video-icon\" v-if=\"item.fileType\" aria-hidden=\"true\">\r\n        <use xlink:href=\"#icon-videofill\"></use>\r\n      </svg> -->\r\n      <span v-if=\"item.fileType\" class=\"iconfont video-icon\">&#xe7c7;</span>\r\n      </view>\r\n      <view class=\"hobby-title\" ref=\"hobbyTitle\">{{ item.title }}</view>\r\n      <view class=\"hobby-info\">\r\n        <view class=\"info\">\r\n          <image class=\"avatar\" mode=\"aspectFit\" :src=\"item.avatar\"></image>\r\n        <text>{{ item.username }}</text>\r\n        </view>\r\n        <view>\r\n          <!-- <svg v-if=\"item.likeFlag\" class=\"icon\" aria-hidden=\"true\" @click.stop=\"like(item)\">\r\n            <use xlink:href=\"#icon-xihuan1\"></use>\r\n          </svg>\r\n          <svg v-else class=\"icon\" aria-hidden=\"true\" @click.stop=\"like(item)\">\r\n            <use xlink:href=\"#icon-xihuan\"></use>\r\n          </svg> -->\r\n          <span v-if=\"item.likeFlag\" style=\"color: #f00;\" class=\"iconfont\" @click.stop=\"like(item)\">&#xe86f;</span>\r\n          <span v-else class=\"iconfont\" @click.stop=\"like(item)\">&#xe86f;</span>\r\n          <text style=\"margin-left: 10rpx;\">{{item.likes}}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"waterFall\",\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport {\r\n  ref,\r\n  reactive,\r\n  onMounted,\r\n  onUpdated,\r\n  getCurrentInstance,\r\n  watchEffect,\r\n} from \"vue\";\r\n\r\nimport { getLike, setLike } from \"@/api/communication.js\";\r\n\r\nconst props = defineProps({\r\n  list: {\r\n    type: Array,\r\n    default: [],\r\n  },\r\n  activeIndex: {\r\n    type: Number,\r\n    default: 1,\r\n  }\r\n});\r\nlet waterfallList = ref([]); // 需要渲染的数据列表\r\nlet waterfallImageWidth = ref(328); // 每一列宽度\r\nlet waterfallImageCol = ref(2); // 每行显示几列\r\nlet waterfallImageRight = ref(20); // 右边距\r\nlet waterfallImageBottom = ref(20); // 下边距\r\nlet waterfallDeviationHeight = ref([]); // 存放瀑布流各个列的高度\r\nlet hobbyTitle = ref(null);\r\nlet waterfall = ref(null);\r\nconst initWaterfall = () => {\r\n  waterfallDeviationHeight.value = new Array(waterfallImageCol.value);\r\n  for (let i = 0; i < waterfallDeviationHeight.value.length; i++) {\r\n    waterfallDeviationHeight.value[i] = 0;\r\n  }\r\n  imagePreLoading();\r\n};\r\n\r\n/**\r\n * @description: 图片预加载\r\n * @param {*}\r\n * @Author:\r\n * @return {*}\r\n */\r\nconst imagePreLoading = async () => {\r\n  for (let i = 0; i < props.list.length; i++) {\r\n    let image = new Image();\r\n    image.src = props.list[i].url;\r\n    console.log(\"waterfall==\", waterfall.value);\r\n    const img = await new Promise((resolve) => {\r\n      image.onload = (e) => {\r\n        console.log(\"e=\", e);\r\n        let imageData = {};\r\n        imageData.height =\r\n          (waterfallImageWidth.value / image.width) * image.height + 160;\r\n        imageData.id = props.list[i].id;\r\n        imageData.src = props.list[i].url;\r\n        imageData.title = props.list[i].title;\r\n        imageData.avatar = props.list[i].avatar;\r\n        imageData.username = props.list[i].username;\r\n        imageData.likes = props.list[i].likes;\r\n        imageData.fileType = props.list[i].fileType\r\n        waterfallList.value.push(imageData);\r\n        rankImage(imageData);\r\n        resolve(imageData);\r\n      };\r\n    });\r\n    getLikes()\r\n    console.log(\"img==\", img);\r\n  }\r\n};\r\n\r\nconst rankImage = (imageData) => {\r\n  const min = Math.min.apply(null, waterfallDeviationHeight.value);\r\n  let minIndex = waterfallDeviationHeight.value.indexOf(min);\r\n  imageData.top = waterfallDeviationHeight.value[minIndex];\r\n  imageData.left =\r\n    minIndex * (waterfallImageRight.value + waterfallImageWidth.value);\r\n  waterfallDeviationHeight.value[minIndex] +=\r\n    imageData.height + waterfallImageBottom.value;\r\n  console.log(\"imageData==\", imageData);\r\n};\r\n\r\nconst goDetail = (item) => {\r\n  console.log('item=', item)\r\n  console.log('props===', props)\r\n    uni.navigateTo({\r\n    url: `/pages/index/HobbyDetailMountain?id=${item.id}&hobby=${props.activeIndex}`,\r\n  });\r\n}\r\n\r\n// 点赞\r\nconst like = (item) => {\r\n  console.log('item=', item)\r\n  // item.likeFlag = true\r\n  let likeIds = uni.getStorageSync('like') || []\r\n  if(likeIds.includes(item.id)){\r\n    console.log('isOK=', likeIds)\r\n    for(let i = 0;i < likeIds.length; i++){\r\n      if(likeIds[i] === item.id){\r\n        likeIds.splice(i, 1)\r\n      }\r\n    }\r\n    item.likes -= 1\r\n    item.likeFlag = false\r\n    uni.setStorageSync('like', likeIds)\r\n  } else {\r\n      \r\n  item.likes += 1\r\n  item.likeFlag = true\r\n  console.log('likeIds=', likeIds)\r\n  likeIds.unshift(item.id)\r\n  uni.setStorageSync('like', likeIds)\r\n  }\r\n  const params = { hobby: props.activeIndex, hobbyId: item.id }\r\n  setLike(params).then(data => {\r\n    console.log('like data=', data)\r\n  })\r\n\r\n}\r\n\r\nconst getLikes = () => {\r\n  const params = {\r\n    hobby: props.activeIndex\r\n  }\r\n  getLike(params).then(data => {\r\n    console.log('getLike=', data)\r\n                if (data.data.code === 200) {\r\n          const ids = data.data.likes.map(item => item.hobby_id)\r\n          uni.setStorageSync('like', ids)\r\n          for(let i= 0; i < waterfallList.value.length; i++){\r\n            if(ids.includes(waterfallList.value[i].id)){\r\n              waterfallList.value[i].likeFlag = true\r\n            } else {\r\n              waterfallList.value[i].likeFlag = false\r\n            }\r\n          }\r\n          console.log('waterfallList====', waterfallList.value)\r\n        }\r\n  })\r\n}\r\n\r\nonMounted(() => {\r\n  console.log(\"list1=\", props.list);\r\n  initWaterfall();\r\n});\r\nonUpdated(() => {\r\n  console.log(\"list2=\", props.list);\r\n  // initWaterfall();\r\n});\r\n\r\nwatchEffect(() => {\r\n  initWaterfall();\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.waterfall {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n}\r\n.waterfall-item {\r\n  position: absolute;\r\n  float: left;\r\n}\r\n.waterfall-image-wrapper{\r\n  position: relative;\r\n  .waterfall-image{\r\n    position: absolue;\r\n  }\r\n  .video-icon{\r\n    position: absolute;\r\n    left: 50%;\r\n    top: 50%;\r\n    transform: translate(-50%, -50%);\r\n    width: 2em;\r\n    height: 2em;\r\n    vertical-align: -0.15em;\r\n    fill: currentColor;\r\n    overflow: hidden;\r\n    opacity: 0.6;\r\n  }\r\n}\r\n.hobby-title {\r\n  position: relative;\r\n  // bottom: 0;\r\n  padding: 20rpx;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  display: block;\r\n  -webkit-line-clamp: 2;\r\n  -webkit-box-orient: vertical;\r\n  color: #363636;\r\n  background-color: #fff;\r\n}\r\n.hobby-info {\r\n  display: flex;\r\n  background-color: #fff;\r\n  padding:0 20rpx 20rpx;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-size: 24rpx;\r\n  .info{\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n.avatar {\r\n    width: 52rpx;\r\n    height: 52rpx;\r\n    border-radius: 50%;\r\n    background-color: #ccc;\r\n    margin-right: 20rpx;\r\n  }\r\n}\r\n</style>\r\n","<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2022-01-16 13:32:17\r\n * @LastEditTime: 2022-07-05 12:12:46\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"tabs\">\r\n    <scroll-view\r\n      scroll-x\r\n      scroll-with-animaiton\r\n      :enable-flex=\"true\"\r\n      @scroll=\"handleScroll\"\r\n      class=\"nav-wraper\"\r\n    >\r\n      <view class=\"nav\">\r\n        <view\r\n          class=\"nav-item\"\r\n          v-for=\"(item, index) in list\"\r\n          :key=\"index\"\r\n          :class=\"swiperIndex == index ? 'nav-item-act' : ''\"\r\n          @click=\"taggleNav(index)\"\r\n        >\r\n          <text>{{ item.title }}</text>\r\n          <view\r\n            class=\"nav-line\"\r\n            :style=\"`{width: ${navItemWidth}rpx}`\"\r\n            v-if=\"swiperIndex == index\"\r\n          ></view>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n    <swiper\r\n      :current=\"swiperIndex\"\r\n      :duration=\"300\"\r\n      class=\"swiper\"\r\n      @change=\"swiperChange\"\r\n    >\r\n      <swiper-item v-for=\"(item, index) in list\" :key=\"index\">\r\n        <scroll-view\r\n          scroll-y=\"true\"\r\n          class=\"swiper-scroll\"\r\n          @scrolltolower=\"onScrolltolower\"\r\n        >\r\n          <uni-list v-if=\"index === 0\">\r\n            <uni-list-item\r\n              :title=\"item.title\"\r\n              :ellipsis=\"item.title\"\r\n              :note=\"item.description\"\r\n              v-for=\"item in videos\"\r\n              :key=\"item.id\"\r\n              direction=\"column\"\r\n              class=\"content-item\"\r\n            >\r\n              <template v-slot:header>\r\n                <view class=\"uni-thumb uni-content list-picture\">\r\n                  <image\r\n                    v-if=\"item.img\"\r\n                    class=\"slot-image\"\r\n                    :src=\"item.img\"\r\n                    mode=\"widthFix\"\r\n                    @click=\"goDetail(item)\"\r\n                  ></image>\r\n                  <view class=\"hint\" v-if=\"item.hintTitle || item.dateSrc\">\r\n                    <!-- <text v-if=\"item.hintTitle\">By</text> -->\r\n                    <text v-if=\"item.hintTitle\" class=\"hint-title\">{{\r\n                      item.hintTitle\r\n                    }}</text>\r\n                    <text class=\"hint-date\">{{ item.dateSrc }}</text>\r\n                  </view>\r\n                </view>\r\n              </template>\r\n              <template v-slot:body>\r\n                <view class=\"content-body\">\r\n                  <view class=\"title-wraper\" @click=\"goDetail(item)\"\r\n                    ><text class=\"title\">{{ item.title }}</text\r\n                    ><view class=\"video\"\r\n                      ><uni-icons\r\n                        style=\"vertical-align: middle\"\r\n                        type=\"videocam\"\r\n                        size=\"20\"\r\n                        color=\"#999\"\r\n                      ></uni-icons\r\n                      ><text>VIDEO</text></view\r\n                    ></view\r\n                  >\r\n                  <view class=\"description\">{{ item.description }}</view>\r\n                </view>\r\n              </template>\r\n            </uni-list-item>\r\n          </uni-list>\r\n          <!-- <view v-else-if=\"index === 3\"> -->\r\n          <!-- #ifdef H5 -->\r\n          <WaterFall v-if=\"index === 1\" :list=\"werewolfs\" :activeIndex=\"2\" />\r\n          <WaterFall\r\n            v-else-if=\"index === 2\"\r\n            :list=\"scriptKills\"\r\n            :activeIndex=\"3\"\r\n          />\r\n          <WaterFall\r\n            v-else-if=\"index === 3\"\r\n            :list=\"mountaineers\"\r\n            :activeIndex=\"4\"\r\n          />\r\n          <WaterFall v-else-if=\"index === 4\" :list=\"travels\" :activeIndex=\"5\" />\r\n          <WaterFall\r\n            v-else-if=\"index === 5\"\r\n            :list=\"videoList\"\r\n            :activeIndex=\"6\"\r\n          />\r\n          <!-- #endif -->\r\n          <!-- #ifdef APP-PLUS || MP-WEIXIN -->\r\n          <WaterFallApp\r\n            v-if=\"index === 1 && swiperIndex === index\"\r\n            :list=\"werewolfs\"\r\n            :activeIndex=\"2\"\r\n            :key=\"werewolfs\"\r\n          />\r\n          <WaterFallApp\r\n            v-else-if=\"index === 2 && swiperIndex === index\"\r\n            :list=\"scriptKills\"\r\n            :activeIndex=\"3\"\r\n            :key=\"scriptKills\"\r\n          />\r\n          <WaterFallApp\r\n            v-else-if=\"index === 3 && swiperIndex === index\"\r\n            :list=\"mountaineers\"\r\n            :activeIndex=\"4\"\r\n          />\r\n          <WaterFallApp\r\n            v-else-if=\"index === 4 && swiperIndex === index\"\r\n            :list=\"travels\"\r\n            :activeIndex=\"5\"\r\n          />\r\n          <WaterFallApp\r\n            v-else-if=\"index === 5 && swiperIndex === index\"\r\n            :list=\"videoList\"\r\n            :activeIndex=\"6\"\r\n          />\r\n          <!-- #endif -->\r\n          <!-- <WaterFall v-else-if=\"index === 6\" :list=\"movies\" :activeIndex=\"7\"/> -->\r\n          <!-- </view> -->\r\n          <!-- <view v-else>待上线</view> -->\r\n        </scroll-view>\r\n        <!-- <slot></slot> -->\r\n      </swiper-item>\r\n    </swiper>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"McTabs\",\r\n  mounted() {\r\n    console.log(\"this===\", this);\r\n  },\r\n};\r\n</script>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted, computed } from \"vue\";\r\nimport { getVideoList, getHobbyList } from \"@/api/hobby.js\";\r\n//#ifdef H5\r\nimport WaterFall from \"./WaterFall.vue\";\r\n//#endif\r\n//#ifdef APP-PLUS || MP-WEIXIN\r\nimport WaterFallApp from \"./WaterFallApp.vue\";\r\n//#endif\r\n\r\nconst list = ref([\r\n  { title: \"英语\", content: [] },\r\n  {\r\n    title: \"狼人杀\",\r\n    content: [],\r\n  },\r\n  { title: \"剧本杀\", content: [] },\r\n  {\r\n    title: \"登山\",\r\n    content: [],\r\n  },\r\n  {\r\n    title: \"旅游\",\r\n    content: [],\r\n  },\r\n  {\r\n    title: \"视频\",\r\n    content: [],\r\n  },\r\n]);\r\nlet swiperIndex = ref(0);\r\nlet navItemWidth = ref(0);\r\nconst navItems = reactive([]);\r\nconst strateies = {\r\n  hobby0: (obj) => getEnglishVideos(obj),\r\n  hobby1: (obj) => getWerewolf(obj),\r\n  hobby2: (obj) => getScriptKill(obj),\r\n  hobby3: (obj) => getMountaineers(obj),\r\n  hobby4: (obj) => getTravel(obj),\r\n  hobby5: (obj) => getvideoList(obj),\r\n  // hobby6: (obj) => getMovies(obj)\r\n};\r\nconst handleScroll = (e) => {\r\n  console.log(\"e=\", e);\r\n  const {\r\n    detail: { current },\r\n  } = e;\r\n  console.log(\"current=\", current);\r\n};\r\nconst taggleNav = (index) => {\r\n  console.log(\"swiperIndex========================\", index);\r\n  swiperIndex.value = index;\r\n};\r\nconst swiperChange = (e) => {\r\n  const {\r\n    detail: { current },\r\n  } = e;\r\n  swiperIndex.value = current;\r\n  navItemWidth.value = navItems[swiperIndex.value].width;\r\n  strateies[`hobby${current}`]({ pageNum: 1, pageSize: 100 });\r\n  console.log(\"e=\", e);\r\n  console.log(\"navItemWidth.value=====\", navItemWidth.value);\r\n};\r\nonMounted(() => {\r\n  //#ifdef H5\r\n  const items = document.querySelectorAll(\".nav-item\");\r\n  if (items.length > 0) {\r\n    items.forEach((item) => {\r\n      console.log(\"width=\", item.offsetWidth);\r\n      navItems.push({ width: item.offsetWidth });\r\n    });\r\n    navItemWidth.value = navItems[swiperIndex.value].width;\r\n    console.log(\"items===\", items);\r\n    console.log(\"navItemWidth===\", navItemWidth.value);\r\n    getEnglishVideos({ pageNum: 1, pageSize: 10 });\r\n  }\r\n  //#endif\r\n\r\n  //#ifdef APP-PLUS || MP-WEIXIN\r\n  console.log(\"list====\", list.value);\r\n  if (list.value.length > 0) {\r\n    list.value.forEach(() => {\r\n      navItems.push({ width: 48 });\r\n    });\r\n    navItemWidth.value = navItems[swiperIndex.value].width;\r\n    console.log(\"navItemWidth===\", navItemWidth.value);\r\n    getEnglishVideos({ pageNum: 1, pageSize: 10 });\r\n  }\r\n  //#endif\r\n});\r\nconst result = computed(() => `${navItemWidth.value}rpx`);\r\n\r\n// 英语\r\nlet videos = ref([]);\r\nlet pageNum = ref(1);\r\nlet pageSize = ref(10);\r\nlet total = ref(0);\r\nvar getEnglishVideos = ({ pageNum = 1, pageSize = 10 }) => {\r\n  const params = {\r\n    pageNum,\r\n    pageSize,\r\n  };\r\n  getVideoList(params).then((data) => {\r\n    console.log(\"data===\", data);\r\n    if (data.data.code === 200) {\r\n      videos.value = videos.value.concat(data.data.data);\r\n      total.value = data.data.total;\r\n    }\r\n  });\r\n};\r\n\r\nconst onScrolltolower = (e) => {\r\n  if (swiperIndex.value === 0) {\r\n    if (Math.ceil(total.value / pageSize.value) <= pageNum.value) {\r\n      return;\r\n    }\r\n    pageNum.value++;\r\n    getEnglishVideos({ pageNum: pageNum.value, pageSize: pageSize.value });\r\n  }\r\n};\r\n// 暂时不用\r\nconst onScroll = (e) => {\r\n  const items = uni.createSelectorQuery().selectAll(\".content-item\");\r\n  console.log(\"items===\", items);\r\n  console.log(\"onScroll=\", e);\r\n  let scrollHeight = null;\r\n  let scrollTop = null;\r\n  let height = null;\r\n\r\n  const view = uni\r\n    .createSelectorQuery()\r\n    .select(\".swiper-scroll\")\r\n    .scrollOffset((res) => {\r\n      console.log(\"res===============================\", res);\r\n      console.log(\"竖直滚动位置\" + res.scrollTop);\r\n      scrollHeight = res.scrollHeight;\r\n      scrollTop = res.scrollTop;\r\n    })\r\n    .exec();\r\n  view\r\n    .fields(\r\n      {\r\n        size: true,\r\n        scrollOffset: true,\r\n      },\r\n      (data) => {\r\n        // console.log(\"得到节点信息\" + JSON.stringify(data));\r\n        console.log(\"节点的高为\" + data.height);\r\n        height = parseInt(data.height);\r\n      }\r\n    )\r\n    .exec();\r\n\r\n  if (scrollHeight === scrollTop + height) {\r\n    console.log(\"滚动加载了更多了\");\r\n  }\r\n};\r\n\r\nconst goDetail = (item) => {\r\n  console.log(\"item===\", item);\r\n  //#ifdef APP-PLUS || H5\r\n  uni.navigateTo({\r\n    url: `/pages/index/VideoDetail?id=${item.id}`,\r\n  });\r\n  //#endif\r\n  //#ifdef MP-WEIXIN\r\n  uni.navigateTo({\r\n    url: `/pages/hobby/EnglishDetail/EnglishDetail?id=${item.id}`,\r\n  });\r\n  //#endif\r\n};\r\n\r\n// 登山\r\nlet mountaineers = ref([]);\r\nlet mountaineersTotal = ref(0);\r\nconst getMountaineers = ({ pageNum = 1, pageSize = 10 }) => {\r\n  const params = {\r\n    pageNum,\r\n    pageSize,\r\n    hobby: 4,\r\n  };\r\n  console.log(\"hobby\");\r\n  getHobbyList(params).then((data) => {\r\n    console.log(\"data===\", data);\r\n    if (data.data.code === 200) {\r\n      console.log(\"data.data.data=\", data.data.data);\r\n      mountaineers.value = data.data.data;\r\n      mountaineersTotal.value = data.data.total;\r\n    }\r\n  });\r\n};\r\n\r\n// 狼人杀\r\nlet werewolfs = ref([]);\r\nlet werewolfsTotal = ref(0);\r\nconst getWerewolf = ({ pageNum = 1, pageSize = 10 }) => {\r\n  const params = {\r\n    pageNum,\r\n    pageSize,\r\n    hobby: 2,\r\n  };\r\n  console.log(\"hobby\");\r\n  getHobbyList(params).then((data) => {\r\n    console.log(\"data===\", data);\r\n    if (data.data.code === 200) {\r\n      console.log(\"data.data.data=\", data.data.data);\r\n      werewolfs.value = data.data.data;\r\n      werewolfsTotal.value = data.data.total;\r\n    }\r\n  });\r\n};\r\n\r\n// 剧本杀\r\nlet scriptKills = ref([]);\r\nlet scriptKillsTotal = ref(0);\r\nconst getScriptKill = ({ pageNum = 1, pageSize = 10 }) => {\r\n  const params = {\r\n    pageNum,\r\n    pageSize,\r\n    hobby: 3,\r\n  };\r\n  console.log(\"hobby\");\r\n  getHobbyList(params).then((data) => {\r\n    console.log(\"data===\", data);\r\n    if (data.data.code === 200) {\r\n      console.log(\"data.data.data=\", data.data.data);\r\n      scriptKills.value = data.data.data;\r\n      scriptKillsTotal.value = data.data.total;\r\n    }\r\n  });\r\n};\r\n\r\n// 旅游\r\nlet travels = ref([]);\r\nlet travelsTotal = ref(0);\r\nconst getTravel = ({ pageNum = 1, pageSize = 10 }) => {\r\n  const params = {\r\n    pageNum,\r\n    pageSize,\r\n    hobby: 5,\r\n  };\r\n  console.log(\"hobby\");\r\n  getHobbyList(params).then((data) => {\r\n    console.log(\"data===\", data);\r\n    if (data.data.code === 200) {\r\n      console.log(\"data.data.data=\", data.data.data);\r\n      travels.value = data.data.data;\r\n      travelsTotal.value = data.data.total;\r\n    }\r\n  });\r\n};\r\n\r\n// 视频\r\nlet videoList = ref([]);\r\nlet videoListTotal = ref(0);\r\nconst getvideoList = ({ pageNum = 1, pageSize = 10 }) => {\r\n  const params = {\r\n    pageNum,\r\n    pageSize,\r\n    hobby: 6,\r\n  };\r\n  console.log(\"hobby\");\r\n  getHobbyList(params).then((data) => {\r\n    console.log(\"data===\", data);\r\n    if (data.data.code === 200) {\r\n      console.log(\"data.data.data=\", data.data.data);\r\n      videoList.value = data.data.data;\r\n      videoListTotal.value = data.data.total;\r\n    }\r\n  });\r\n};\r\n\r\n// 电影\r\n// let movies = ref([]);\r\n// let moviesTotal = ref(0);\r\n// const getMovies = ({ pageNum = 1, pageSize = 10 }) => {\r\n//   const params = {\r\n//     pageNum,\r\n//     pageSize,\r\n//     hobby: 7,\r\n//   };\r\n//   console.log(\"hobby\");\r\n//   getHobbyList(params).then((data) => {\r\n//     console.log(\"data===\", data);\r\n//     if (data.data.code === 200) {\r\n//       console.log(\"data.data.data=\", data.data.data);\r\n//       movies.value = data.data.data;\r\n//       moviesTotal.value = data.data.total;\r\n//     }\r\n//   });\r\n// };\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.tabs {\r\n}\r\n.nav-wraper {\r\n  background: #fafafa;\r\n}\r\n.nav {\r\n  white-space: nowrap;\r\n  position: relative;\r\n  height: 60rpx;\r\n  padding: 32rpx;\r\n  border-top: 1rpx solid #dcdfe6;\r\n  border-bottom: 1rpx solid #dcdfe6;\r\n  .nav-item {\r\n    display: inline-block;\r\n    margin: 0 16rpx;\r\n    text-align: center;\r\n    transition: color 0.3s ease;\r\n    position: relative;\r\n  }\r\n  .nav-item:first-child {\r\n    margin-left: 0;\r\n  }\r\n  .nav-line {\r\n    position: absolute;\r\n    bottom: -24rpx;\r\n    // width: v-bind(result);\r\n    width: 60rpx;\r\n    height: 4rpx;\r\n    border-radius: 10rpx;\r\n    background-color: pink;\r\n    transition: left 0.3s ease;\r\n  }\r\n}\r\n.nav-item-act {\r\n  color: pink;\r\n  font-weight: bolder;\r\n}\r\n.swiper {\r\n  height: calc(100vh - 80upx);\r\n  padding: 32rpx;\r\n  background: #fdfdfd;\r\n}\r\n.swiper-scroll {\r\n  height: 100%;\r\n  .content-item {\r\n    .hint {\r\n      font-size: 14px;\r\n      font-family: Arial, Helvetica, sans-serif;\r\n      color: #999999;\r\n      margin-bottom: 10rpx;\r\n      text:first-child {\r\n        margin-right: 20rpx;\r\n      }\r\n    }\r\n    .hint-title {\r\n      color: #014073;\r\n      margin-right: 20rpx;\r\n    }\r\n    .hint-date {\r\n      // margin-left: 20rpx;\r\n    }\r\n    .content-body {\r\n      .title-wraper {\r\n        display: inline-block;\r\n        text-align: left;\r\n        .title {\r\n          // display: inline-block;\r\n          font-size: 40rpx;\r\n          font-family: \"Times New Roman\", Times, serif;\r\n          color: #000;\r\n        }\r\n        .video {\r\n          display: inline-block;\r\n          color: #999999;\r\n          font-size: 16rpx;\r\n        }\r\n      }\r\n      .description {\r\n        // text-align: left;\r\n        // margin-top: 10rpx;\r\n        // color: #666;\r\n        // font-size: 32rpx;\r\n        // font-family: Arial, Helvetica, sans-serif;\r\n        color: #666;\r\n        font-size: 32rpx;\r\n        font-family: Arial, Helvetica, sans-serif;\r\n        margin-top: 10rpx;\r\n        line-height: 40rpx;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2021-12-17 17:33:16\r\n * @LastEditTime: 2022-07-01 16:57:21\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <view class=\"content\">\r\n    <McTabs> </McTabs>\r\n    <!-- <button @click=\"open\">打开弹窗</button> -->\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { onMounted, computed } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\nimport { imRegister, imLogin } from \"@/api/im.js\";\r\nimport { setIMToken } from \"../../utils/auth.js\";\r\nimport McTabs from \"./McTabs.vue\";\r\nimport { getTotalIM } from \"@/utils/storage.js\";\r\nexport default {\r\n  onShow: function() {\r\n    if (getTotalIM() > 0) {\r\n      uni.setTabBarBadge({\r\n        index: 2,\r\n        text: \"···\",\r\n      });\r\n    } else {\r\n      //#ifdef APP-PLUS || H5\r\n      // uni.removeTabBarBadge({\r\n      //   index: 2,\r\n      // });\r\n      //#endif\r\n      uni.removeTabBarBadge({\r\n        index: 2,\r\n      });\r\n    }\r\n  },\r\n  components: {\r\n    McTabs,\r\n  },\r\n  setup() {\r\n    const store = useStore();\r\n    const userInfo = computed(() => store.state.user.userInfo).value;\r\n    const register = () => {\r\n      const params = {\r\n        secret: \"tuoyun\",\r\n        platform: 5,\r\n        operationID: Date.now() + \"\",\r\n      };\r\n      imRegister(params).then((res) => {\r\n        console.log(\"res========\", res);\r\n        if (res.statusCode === 200) {\r\n          console.log(\"res.data.token====\", res.data.token);\r\n          setIMToken(res.data.token);\r\n          // connectIM(res.data.data.userID, res.data.data.token);\r\n        }\r\n      });\r\n    };\r\n    const login = () => {\r\n      const params = {\r\n        userID: userInfo.phone,\r\n        secret: \"tuoyun\",\r\n        platform: 5,\r\n        operationID: Date.now() + \"\",\r\n      };\r\n      imLogin(params).then((res) => {\r\n        console.log(\"res========\", res);\r\n        if (res.statusCode === 200) {\r\n          if (res.data.errCode !== 0) {\r\n            register();\r\n            return;\r\n          }\r\n          if (res.data.data.token) {\r\n            console.log(\"res.data.token=\", res.data.token);\r\n            setIMToken(res.data.data.token);\r\n          }\r\n          // connectIM(res.data.data.userID, res.data.data.token);\r\n        }\r\n      });\r\n    };\r\n    onMounted(() => {\r\n      // connectIM(userID, token);\r\n      // login();\r\n      // resiger()\r\n      // console.log('userInfo=========================', userInfo.phone)\r\n    });\r\n    return {\r\n      title: \"蔓草\",\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n.content {\r\n  /* display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center; */\r\n  /* background: #fdfdfd; */\r\n  /* padding: 0 32rpx; */\r\n}\r\n\r\n.logo {\r\n  height: 200rpx;\r\n  width: 200rpx;\r\n  margin-top: 200rpx;\r\n  margin-left: auto;\r\n  margin-right: auto;\r\n  margin-bottom: 50rpx;\r\n}\r\n\r\n.text-area {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.title {\r\n  font-size: 36rpx;\r\n  color: #8f8f94;\r\n}\r\n.change-gender {\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n}\r\n</style>\r\n"],"names":["name","waterfallList","ref","waterfallImageWidth","waterfallImageCol","waterfallImageRight","waterfallImageBottom","waterfallDeviationHeight","hobbyTitle","waterfall","initWaterfall","value","Array","i","length","imagePreLoading","async","props","list","image","Image","src","url","log","img","Promise","resolve","onload","e","imageData","height","width","id","title","avatar","username","likes","fileType","push","rankImage","min","Math","apply","minIndex","indexOf","top","left","like","item","likeIds","uni.getStorageSync","includes","splice","likeFlag","unshift","params","hobby","activeIndex","hobbyId","then","data","getLikes","code","ids","map","hobby_id","navigateTo","mounted","this","content","swiperIndex","navItemWidth","navItems","reactive","strateies","hobby0","obj","getEnglishVideos","hobby1","getWerewolf","hobby2","getScriptKill","hobby3","getMountaineers","hobby4","getTravel","hobby5","getvideoList","handleScroll","detail","current","swiperChange","pageNum","pageSize","items","document","querySelectorAll","forEach","offsetWidth","result","computed","videos","total","concat","onScrolltolower","ceil","goDetail","mountaineers","mountaineersTotal","werewolfs","werewolfsTotal","scriptKills","scriptKillsTotal","travels","travelsTotal","videoList","videoListTotal","index2","onShow","getTotalIM","index","text","components","McTabs","setup","store","useStore","state","user","userInfo","_createBlock","_component_v_uni_view","class","_createVNode","_component_McTabs","_createCommentVNode"],"mappings":"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"}