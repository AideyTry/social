{"version":3,"file":"pages-index-HobbyDetailMountain.0bd8b1cf.js","sources":["../../../../src/pages/index/HobbyDetailMountain.vue"],"sourcesContent":["<!--\r\n * @Author: Aiden(戴林波)\r\n * @Date: 2022-02-25 14:59:08\r\n * @LastEditTime: 2022-06-28 12:22:20\r\n * @LastEditors: Aiden(戴林波)\r\n * @Description: \r\n * @Email: jason_dlb@sina.cn\r\n-->\r\n<template>\r\n  <div class=\"hobby-detail\">\r\n    <view class=\"swiper-box\" v-if=\"hobbyInfo.fileType === 0\">\r\n      <swiper class=\"swiper-box\" :indicator-dots=\"hobbyInfo.photos.length > 1\">\r\n        <swiper-item v-for=\"(item, index) in hobbyInfo.photos\" :key=\"index\">\r\n          <view class=\"swiper-item\">\r\n            <image :src=\"item\" class=\"image\" mode=\"aspectFit\"></image>\r\n          </view>\r\n        </swiper-item>\r\n      </swiper>\r\n    </view>\r\n    <view class=\"swiper-box\" v-if=\"hobbyInfo.fileType === 1\">\r\n      <view class=\"swiper-item\">\r\n        <VideoPlayer\r\n          :options=\"{ src: hobbyInfo.video_url, poster: hobbyInfo.url }\"\r\n          :key=\"hobbyInfo.id\"\r\n        ></VideoPlayer>\r\n      </view>\r\n    </view>\r\n    <view class=\"author-wraper\">\r\n      <view class=\"author\">\r\n        <view class=\"author-info\">\r\n          <image\r\n            class=\"avatar\"\r\n            mode=\"aspectFit\"\r\n            :src=\"hobbyInfo.avatar || ''\"\r\n          ></image>\r\n          <text>{{ hobbyInfo.username || \"\" }}</text>\r\n        </view>\r\n        <view\r\n          :class=\"{ follow: !isFlollow, active: isFlollow }\"\r\n          @click=\"following\"\r\n        >\r\n          <text>{{ followText }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view class=\"content-wraper\">\r\n      <view class=\"content\">\r\n        <view class=\"title\">\r\n          {{ hobbyInfo.title }}\r\n        </view>\r\n        <view class=\"main\">\r\n          {{ hobbyInfo.content }}\r\n        </view>\r\n        <view class=\"publish-date\"\r\n          ><text>发布于: </text><text>{{ publishDate }}</text></view\r\n        >\r\n      </view>\r\n    </view>\r\n    <view class=\"comment-wraper\">\r\n      <Comment v-if=\"hobbyInfo.id\" :hobbyInfo=\"hobbyInfo\" :key=\"hobbyInfo.id\" />\r\n    </view>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, onMounted, computed } from \"vue\";\r\nimport { useStore } from \"vuex\";\r\n\r\nimport { getHobbyDetail } from \"@/api/hobby.js\";\r\nimport { setFollow, getFollow, deleteFollow } from \"@/api/communication.js\";\r\nimport Comment from \"@/pages/components/Comment.vue\";\r\nimport VideoPlayer from \"@/pages/components/VideoPlayer.vue\";\r\n\r\nimport { formatDate } from \"@/utils/util.js\";\r\n\r\nexport default {\r\n  components: {\r\n    Comment,\r\n    VideoPlayer,\r\n  },\r\n  onLoad: function (options) {\r\n    console.log(\"options===\", options);\r\n    this.propsOptions = options\r\n  },\r\n  onReady: function () {},\r\n  setup(props, context) {\r\n    console.log(\"props=\", props);\r\n    console.log('context==========', context)\r\n    const store = useStore();\r\n    const userInfo = computed(() => store.state.user.userInfo).value;\r\n\r\n    const options = reactive({\r\n      poster: \"\",\r\n      src: \"\", //视频源\r\n    });\r\n\r\n    let propsOptions = ref(null)\r\n\r\n    let info = ref([\r\n      {\r\n        content:\r\n          \"https://social-1308251497.cos.ap-guangzhou.myqcloud.com/images/4.jfif\",\r\n      },\r\n    ]);\r\n\r\n    let hobbyInfo = ref({});\r\n    const initGetHobbyDetail = (obj) => {\r\n      const { id, hobby } = obj;\r\n      const params = { id, hobby };\r\n      getHobbyDetail(params).then((data) => {\r\n        console.log(\"data===\", data);\r\n        if (data.data.code === 200) {\r\n          hobbyInfo.value = data.data.data;\r\n          publishDate.value = formatDate(data.data.data.create_time);\r\n          console.log(\"hobbyInfo.value===\", hobbyInfo.value);\r\n          console.log(\"data.data.data.url===\", data.data.data.url);\r\n          options.poster = data.data.data.url;\r\n          options.src = data.data.data.video_url;\r\n          initFlow();\r\n        }\r\n      });\r\n    };\r\n\r\n    // 关注\r\n    let isFlollow = ref(false);\r\n    let followText = ref(\"关注\");\r\n    const following = () => {\r\n      if (isFlollow.value) {\r\n        uni.showModal({\r\n          content: \"确认不再关注？\",\r\n          success: function (res) {\r\n            if (res.confirm) {\r\n              let params = { followId: hobbyInfo.value.user_id };\r\n              deleteFollow(params).then((data) => {\r\n                if (data.data.code === 200) {\r\n                  followText.value = \"关注\";\r\n                  isFlollow.value = false;\r\n                }\r\n              });\r\n            } else if (res.cancel) {\r\n              console.log(\"用户点击取消\");\r\n            }\r\n          },\r\n        });\r\n        return;\r\n      }\r\n      console.log(\"userInfo===\", userInfo);\r\n      let params = { followId: hobbyInfo.value.user_id };\r\n      setFollow(params).then((data) => {\r\n        console.log(\"data===\", data);\r\n        if (data.data.code === 200) {\r\n          followText.value = \"已关注\";\r\n          isFlollow.value = true;\r\n        } else if (data.data.code === 400) {\r\n          uni.showToast({\r\n            title: data.data.msg,\r\n            icon: \"none\",\r\n            duration: 2000,\r\n          });\r\n        }\r\n      });\r\n    };\r\n\r\n    // 发布\r\n    let publishDate = ref(null);\r\n\r\n    const initFlow = () => {\r\n      let params = { followId: hobbyInfo.value.user_id };\r\n      console.log(\"params===\", params);\r\n      getFollow(params).then((data) => {\r\n        console.log(\"data1===\", data);\r\n        if (data.data.code === 200) {\r\n          isFlollow.value = data.data.isFollow;\r\n          data.data.isFollow\r\n            ? (followText.value = \"已关注\")\r\n            : (followText.value = \"关注\");\r\n        }\r\n      });\r\n    };\r\n\r\n    // 导航标题\r\n    const onNavTitle = (obj) => {\r\n      console.log(\r\n        \"obj===================================================================================\",\r\n        obj\r\n      );\r\n      const { hobby } = obj;\r\n      //#ifdef H5\r\n      const strateies = {\r\n        hobby2: () =>\r\n          uni.setNavigationBarTitle({\r\n            title: \"狼人杀\",\r\n          }),\r\n        hobby3: () =>\r\n          uni.setNavigationBarTitle({\r\n            title: \"剧本杀\",\r\n          }),\r\n        hobby4: () =>\r\n          uni.setNavigationBarTitle({\r\n            title: \"登山\",\r\n          }),\r\n        hobby5: () =>\r\n          uni.setNavigationBarTitle({\r\n            title: \"旅游\",\r\n          }),\r\n        hobby6: () =>\r\n          uni.setNavigationBarTitle({\r\n            title: \"视频\",\r\n          }),\r\n        hobby7: () =>\r\n          uni.setNavigationBarTitle({\r\n            title: \"电影\",\r\n          }),\r\n      };\r\n      strateies[`hobby${hobby}`]();\r\n      //#endif\r\n\r\n      //#ifdef APP-PLUS || MP-WEIXIN\r\n      switch (Number(hobby)) {\r\n        case 2:\r\n          uni.setNavigationBarTitle({\r\n            title: \"狼人杀\",\r\n          });\r\n          break;\r\n        case 3:\r\n          uni.setNavigationBarTitle({\r\n            title: \"剧本杀\",\r\n          });\r\n          break;\r\n        case 4:\r\n          uni.setNavigationBarTitle({\r\n            title: \"登山\",\r\n          });\r\n          break;\r\n        case 5:\r\n          uni.setNavigationBarTitle({\r\n            title: \"旅游\",\r\n          });\r\n          break;\r\n        case 6:\r\n          uni.setNavigationBarTitle({\r\n            title: \"视频\",\r\n          });\r\n          break;\r\n        case 7:\r\n          uni.setNavigationBarTitle({\r\n            title: \"电影\",\r\n          });\r\n          break;\r\n        default:\r\n          uni.setNavigationBarTitle({\r\n            title: \"狼人杀\",\r\n          });\r\n      }\r\n      //#endif\r\n    };\r\n\r\n    onMounted(() => {\r\n      console.log(\"userInfo===\", userInfo);\r\n      console.log('propsOptions===========', propsOptions)\r\n      onNavTitle(propsOptions.value);\r\n      initGetHobbyDetail({ id: propsOptions.value.id, hobby: propsOptions.value.hobby });\r\n    });\r\n    return {\r\n      followText,\r\n      isFlollow,\r\n      following,\r\n      hobbyInfo,\r\n      info,\r\n      publishDate,\r\n      options,\r\n      propsOptions\r\n    };\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.hobby-detail {\r\n}\r\n.swiper-box {\r\n  width: 100%;\r\n  height: 554rpx;\r\n  .swiper-item {\r\n    width: 100%;\r\n    height: 100%;\r\n    .image {\r\n      width: inherit;\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n\r\n.author-wraper {\r\n  margin-top: 32rpx;\r\n  padding: 0 32rpx;\r\n}\r\n.author {\r\n  padding-bottom: 32rpx;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  border-bottom: 1px solid #e6e6e6;\r\n  .author-info {\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n  .avatar {\r\n    width: 52rpx;\r\n    height: 52rpx;\r\n    border-radius: 50%;\r\n    background-color: #ccc;\r\n    margin-right: 20rpx;\r\n  }\r\n  .follow {\r\n    border: 1rpx solid #ff2442;\r\n    border-radius: 8rpx;\r\n    color: #ff2442;\r\n    padding: 10rpx 20rpx;\r\n    font-size: 24rpx;\r\n  }\r\n  .active {\r\n    border: 1rpx solid #ccc;\r\n    border-radius: 8rpx;\r\n    color: #ccc;\r\n    padding: 10rpx 20rpx;\r\n    font-size: 24rpx;\r\n  }\r\n}\r\n.content-wraper {\r\n  margin-top: 32rpx;\r\n  padding: 0 32rpx;\r\n  .content {\r\n    padding-bottom: 32rpx;\r\n    border-bottom: 1px solid #e6e6e6;\r\n    .title {\r\n      font-size: 32rpx;\r\n      font-weight: 700;\r\n    }\r\n    .main {\r\n      margin-top: 20rpx;\r\n      color: #555;\r\n      letter-spacing: 6rpx;\r\n      text-indent: 2em;\r\n    }\r\n    .publish-date {\r\n      margin-top: 20rpx;\r\n      color: #999;\r\n      font-size: 24rpx;\r\n    }\r\n  }\r\n}\r\n.comment-wraper {\r\n  margin-top: 32rpx;\r\n  padding: 0 32rpx;\r\n}\r\n</style>\r\n"],"names":["components","Comment","VideoPlayer","onLoad","options","log","propsOptions","onReady","setup","props","context","store","useStore","userInfo","computed","state","user","value","reactive","poster","src","ref","info","content","hobbyInfo","isFlollow","followText","publishDate","initFlow","params","followId","user_id","then","data","code","isFollow","obj","hobby","hobby2","uni.setNavigationBarTitle","title","hobby3","hobby4","hobby5","hobby6","hobby7","id","formatDate","create_time","url","video_url","following","success","res","confirm","params2","cancel","msg","icon","duration","_createElementBlock","class","$setup","fileType","_createBlock","_component_v_uni_view","_createVNode","_component_v_uni_swiper","photos","length","_Fragment","item","index","_component_v_uni_swiper_item","key","_component_v_uni_image","mode","_component_VideoPlayer","avatar","_component_v_uni_text","username","onClick","_component_Comment"],"mappings":"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"}