import{Z as a,T as e,z as s,A as o,o as t,c as l,w as n,D as r,E as c,M as u,N as d,ak as g,al as i,P as f,e as m,J as p,K as h,I as v,O as _,Q as C}from"./vendor.ada0ecfb.js";import{o as I}from"./openIM.fd559ab0.js";import{g as N}from"./index.a2877f4e.js";import{C as w}from"./ChatContent.b6858d8c.js";import{_ as D}from"./plugin-vue_export-helper.21dcd24c.js";var M=D({components:{ChatContent:w},onShow(){console.log("show======"),this.getAllConversationList()},setup(){const t=a(),l=e((()=>t.state.user.userInfo)).value;let n=s(null);const r=s([]),c=()=>{I.getAllConversationList().then((({data:a})=>{console.log("data====",JSON.parse(a)),r.value=JSON.parse(a),m()})).catch((a=>{console.log("err=",a)}))},u=(a,e)=>{console.log("userID, token=====================",a,e);const s={userID:a,token:e,url:"wss://mancao.social:20038",platformID:5};I.login(s).then((a=>{console.log("login suc...",a),0===a.errCode&&(c(),I.on("OnTotalUnreadMessageCountChanged",(a=>{console.log("data unredd=================",a)}))),n.value=a.operationID})).catch((a=>{console.log("login failed...",a)}))};let f=s("");const m=()=>{I.getTotalUnreadMsgCount().then((({data:a})=>{console.log("data===",a),console.log("Number(data)=",Number(a)),f.value=Number(a),Number(a)>0?g({index:2,text:"···"}):i({index:2})})).catch((a=>{console.log("err=",a)}))};return o((()=>{u(l.phone,N()),I.on("OnRecvNewMessage",(a=>{101===JSON.parse(a.data).contentType&&c()}))})),{defaultAvatar:"/static/images/default_avatar.png",operationID:n,convers:r,unReadTotal:f,goChat:a=>{console.log("item=",a),d({url:`/pages/message/Chat?userID=${a.userID}&title=${a.showName}`})},showLastMessage:a=>JSON.parse(a).content,getAllConversationList:c}}},[["render",function(a,e,s,o,d,g){const i=_,I=C,N=f;return t(),l(N,null,{default:n((()=>[(t(!0),r(u,null,c(o.convers,(e=>(t(),l(N,{key:e.userID,class:"conver",onClick:a=>o.goChat(e)},{default:n((()=>[m(N,{class:"conver-msg"},{default:n((()=>[m(N,{class:"chat_bg_msg_icon-wraper"},{default:n((()=>[m(i,{src:e.faceURL&&e.faceURL.includes("https://")?e.faceURL:o.defaultAvatar,class:"chat_bg_msg_icon"},null,8,["src"]),o.unReadTotal?(t(),l(N,{key:0,class:"unread-total"},{default:n((()=>[m(I,null,{default:n((()=>[p(h(o.unReadTotal),1)])),_:1})])),_:1})):v("v-if",!0)])),_:2},1024),m(N,{class:"content-wraper"},{default:n((()=>[m(I,null,{default:n((()=>[p(h(e.showName),1)])),_:2},1024),m(I,null,{default:n((()=>[p(h(o.showLastMessage(e.latestMsg)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),m(I,{class:"conver-time"},{default:n((()=>[p(h(a.$filters.formatMsgDate(e.latestMsgSendTime)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-0c55aa80"]]);export{M as default};
//# sourceMappingURL=pages-message-index.2dcbdcfb.js.map
