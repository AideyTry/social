import{l as e,k as o,ai as a,am as t,r as l,W as s,c as n,d as r,e as c,f as i,i as d,t as u,u as m,q as p,g as f,h,F as g,E as v,an as C,s as _,ao as y,y as b,m as x,x as w,v as j,S as k,U as I,ak as F,Z as N,a2 as P,a5 as V}from"./index.caabeb3a.js";import{_ as D,a as M}from"./uni-forms.6adea248.js";import{r as U}from"./uni-app.es.84be360c.js";import{_ as Y}from"./PickerRegion.06ca468d.js";import{_ as $}from"./plugin-vue_export-helper.21dcd24c.js";var R=$({setup($){const R=v();let S=e((()=>R.state.user.userInfo)).value,q=o({avatar:S.avatar,username:S.username,gender:S.gender,birthday:a(S.birthday).format("YYYY-MM-DD"),location:{provinceCode:S.location&&S.location.provinceCode,cityCode:S.location&&S.location.cityCode},hometown:{provinceCode:S.hometown&&S.hometown.provinceCode,cityCode:S.hometown&&S.hometown.cityCode},schoolName:S.schoolName,job:S.job,motto:S.motto,photos:S.photos}),G={username:{rules:[{required:!0,errorMessage:"请输入昵称"}]}};t("schoolUpdate",(function(e){q.schoolName=e.schoolName}));const L=l(null),E=e=>{console.log("form=e==",e),L.value.validate().then((e=>{console.log("表单数据信息：",e);const o={form:{...e,photos:O}};C(o).then((e=>{console.log("data======",e),R.dispatch("user/GetUserInfo").then((()=>{_({url:"/pages/user/info/index"})}))}))})).catch((e=>{console.log("表单错误信息：",e)}))},J="/static/images/default_avatar.png";let O=o(S.photos);s(O,((e,o)=>{console.log("images",e),q.photos=e}));console.log("images===",O);const T=l(S.avatar);s(T,((e,o)=>{q.avatar=e}));const W=e=>{P({success:o=>{console.log("chooseImageRes===",o);const{tempFilePaths:a,tempFiles:t}=o;console.log("tempFilePaths[0]===",a[0]),((e,o)=>{V({url:"https://mancao.social/prod/users/uploadFile",filePath:o,name:"file",formData:{user:"test"},success:o=>{console.log("uploadFileRes===",o);const{data:a}=o,t=JSON.parse(a);console.log("imgData=",t),O[e]=t.url,console.log("index===",e),0===e&&(T.value=t.url)}})})(e,a[0])}})},Z=e=>{const o=new Date;let a=o.getFullYear(),t=o.getMonth()+1,l=o.getDate();return"start"===e?a-=60:"end"===e&&(a+=2),t=t>9?t:"0"+t,l=l>9?l:"0"+l,`${a}-${t}-${l}`},z=Z({format:!0});console.log("currentDate===",z);let A=Z("start"),B=Z("end");const H=e=>{q.birthday=e.detail.value},K=()=>{y({itemList:["男","女"],success:function(e){console.log("选中了第"+(e.tapIndex+1)+"个按钮")},fail:function(e){console.log(e.errMsg)}})},Q=e=>{console.log("obj=====",e);const{provinceCode:o,cityCode:a}=e;q.location.provinceCode=o,q.location.cityCode=a},X=e=>{console.log("obj.home=====",e);const{provinceCode:o,cityCode:a}=e;q.hometown.provinceCode=o,q.hometown.cityCode=a},ee=()=>{_({url:"/pages/user/info/School"})};let oe=l(["IT/互联网/通信","金融","工业制造业","教育/科研","公共事业单位","医药/健康","媒体/公关","影视/娱乐","零售","餐饮/酒店","其他"]),ae=l(0);const te=e=>{const{detail:{value:o}}=e;ae.value=o,q.job=oe.value[o]};return(e,o)=>{const a=b,t=U(x("uni-forms-item"),D),l=w,s=j,v=k,C=I,_=F,P=U(x("uni-forms"),M),V=N;return n(),r(l,{class:"userinfo-wraper"},{default:c((()=>[i(P,{ref_key:"form",ref:L,modelValue:m(q),rules:m(G)},{default:c((()=>[i(l,{class:"userinfo"},{default:c((()=>[i(t,{name:"avatar"},{default:c((()=>[i(a,{src:T.value?T.value:J,class:"avatar"},null,8,["src"])])),_:1})])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("个人照片")])),_:1}),i(s,null,{default:c((()=>{return[d("("+u((e=m(O),e.filter((e=>e)).length))+"/"+u(m(O).length)+")",1)];var e})),_:1})])),_:1}),p(' <uni-forms-item name="photos"> '),i(v,{"scroll-x":"true",class:"photos"},{default:c((()=>[i(l,{class:"photos"},{default:c((()=>[(n(!0),f(g,null,h(m(O),((e,o)=>(n(),r(l,{class:"photo-wraper",onClick:a=>((e,o)=>{if(console.log("item, index===",e,o),e){let a=["编辑"];return o>0&&(a=["设为头像","编辑","删除"]),void y({itemList:a,success:function(a){if(console.log("选中了第"+(a.tapIndex+1)+"个按钮"),0===a.tapIndex)return O[o]=O[0],O[0]=e,void(T.value=e);1!==a.tapIndex?2===a.tapIndex&&O.splice(o,1):W(o)},fail:function(e){console.log(e.errMsg)}})}W(o)})(e,o),key:o},{default:c((()=>[i(a,{mode:"aspectFill",src:e||J,class:"photo"},null,8,["src"]),!e&&m(O)[o-1]||0===o&&!m(O)[0]?(n(),r(s,{key:0,class:"photo-add"},{default:c((()=>[d("+")])),_:1})):p("v-if",!0)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1}),p(" </uni-forms-item> ")])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("个人签名")])),_:1})])),_:1}),i(t,{name:"motto"},{default:c((()=>[i(C,{modelValue:m(q).motto,"onUpdate:modelValue":o[0]||(o[0]=e=>m(q).motto=e),type:"text",placeholder:"请输入个人签名"},null,8,["modelValue"])])),_:1})])),_:1}),i(l,{class:"info-item"},{default:c((()=>[i(l,{class:"title-wraper"},{default:c((()=>[i(s,{class:"title"},{default:c((()=>[d("基础信息")])),_:1})])),_:1}),p(' <view class="base-item">\r\n        <text>昵称</text>\r\n        <input type="text" placeholder="请输入昵称" />\r\n      </view> '),i(t,{label:"昵称",name:"username"},{default:c((()=>[i(C,{class:"input",modelValue:m(q).username,"onUpdate:modelValue":o[1]||(o[1]=e=>m(q).username=e),type:"text",placeholder:"请输入昵称"},null,8,["modelValue"])])),_:1}),i(t,{label:"性别",name:"gender"},{default:c((()=>[p(" <text>性别</text> "),i(l,{onClick:K},{default:c((()=>[d(u(e.$filters.filterGender(m(S).gender)),1)])),_:1})])),_:1}),i(t,{label:"出生日期",name:"birthday"},{default:c((()=>[i(_,{mode:"date",value:m(q).birthday,start:m(A),end:m(B),onChange:H},{default:c((()=>[i(l,{class:"uni-input"},{default:c((()=>[d(u(m(q).birthday),1)])),_:1})])),_:1},8,["value","start","end"])])),_:1}),i(t,{label:"所在地",name:"location"},{default:c((()=>[i(Y,{propsProvinceCode:m(q).location.provinceCode,propsCityCode:m(q).location.cityCode,onChange:Q},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),i(t,{label:"家乡",name:"hometown"},{default:c((()=>[i(Y,{propsProvinceCode:m(q).hometown.provinceCode,propsCityCode:m(q).hometown.cityCode,onChange:X},null,8,["propsProvinceCode","propsCityCode"])])),_:1}),i(t,{label:"学校",name:"schoolName"},{default:c((()=>[i(l,{onClick:ee},{default:c((()=>[d(u(m(q).schoolName?m(q).schoolName:"请选择学校"),1)])),_:1})])),_:1}),i(t,{label:"职业",name:"job"},{default:c((()=>[i(_,{range:m(oe),value:m(ae),onChange:te},{default:c((()=>[i(l,{class:"uni-input"},{default:c((()=>[d(u(m(q).job?m(q).job:"请选择职业"),1)])),_:1})])),_:1},8,["range","value"])])),_:1})])),_:1})])),_:1},8,["modelValue","rules"]),i(V,{onClick:E},{default:c((()=>[d("保存")])),_:1}),p(" end ")])),_:1})}}},[["__scopeId","data-v-259039da"]]);export{R as default};
//# sourceMappingURL=pages-user-info-Editor.065cb883.js.map
